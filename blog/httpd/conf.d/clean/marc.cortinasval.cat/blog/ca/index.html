<!DOCTYPE html>
<html lang="ca">
<head>
<title>El blog d&#039;en Marc | Tal com raja&#8230;.</title>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script type='text/javascript'>window.mod_pagespeed_start = Number(new Date());</script><link rel="profile" href="http://gmpg.org/xfn/11"/>
<link rel="pingback" href="https://marc.cortinasval.cat/blog/xmlrpc.php"/>
<!--[if lt IE 9]>
		<script src="https://marc.cortinasval.cat/blog/wp-content/themes/franklin/js/html5.js"></script>
	<![endif]-->
<link rel="alternate" type="application/rss+xml" title="El blog d&#039;en Marc &raquo; Feed" href="https://marc.cortinasval.cat/blog/ca/feed/"/>
<link rel="alternate" type="application/rss+xml" title="El blog d&#039;en Marc &raquo; Comments Feed" href="https://marc.cortinasval.cat/blog/ca/comments/feed/"/>
<script>//<![CDATA[
var _gaq=_gaq||[];_gaq.push(['_setAccount','UA-26821552-3']);_gaq.push(['_trackPageview']);(function(){var ga=document.createElement('script');ga.type='text/javascript';ga.async=true;ga.src=('https:'==document.location.protocol?'https://ssl':'http://www')+'.google-analytics.com/ga.js';var s=document.getElementsByTagName('script')[0];s.parentNode.insertBefore(ga,s);})();
//]]></script>
<link rel='stylesheet' id='gsc_style-css' href='https://marc.cortinasval.cat/blog/wp-content/plugins/google-custom-search/css/smoothness/jquery-ui-1.7.3.custom.css?ver=3.7.3' type='text/css' media='all'/>
<link rel='stylesheet' id='gsc_style_search_bar-css' href='https://www.google.com/cse/style/look/minimalist.css?ver=3.7.3' type='text/css' media='all'/>
<link rel='stylesheet' id='gsc_style_search_bar_more-css' href='https://marc.cortinasval.cat/blog/wp-content/plugins/google-custom-search/css/gsc.css?ver=3.7.3' type='text/css' media='all'/>
<link rel='stylesheet' id='franklin_source_sans-css' href='//fonts.googleapis.com/css?family=Source+Sans+Pro%3A400%2C700%2C900&#038;ver=3.7.3' type='text/css' media='all'/>
<link rel='stylesheet' id='franklin_open_sans-css' href='//fonts.googleapis.com/css?family=Open+Sans%3A400%2C600&#038;ver=3.7.3' type='text/css' media='all'/>
<link rel='stylesheet' id='franklin_bootstrap_css-css' href='https://marc.cortinasval.cat/blog/wp-content/themes/franklin/assets/css/bootstrap.min.css?ver=3.7.3' type='text/css' media='all'/>
<link rel='stylesheet' id='franklin_style-css' href='https://marc.cortinasval.cat/blog/wp-content/themes/franklin/style.css?ver=3.7.3' type='text/css' media='all'/>
<link rel='stylesheet' id='custom-style-css' href='https://marc.cortinasval.cat/blog/wp-content/themes/franklin/assets/css/custom.css?ver=3.7.3' type='text/css' media='all'/>
<style>header,.widget_tag_cloud a:hover,.sticky-img,#primary-menu li ul li{background-color:#20b2aa}a:hover,#primary-menu li:hover a{color:#20b2aa}</style>
<script src='https://marc.cortinasval.cat/blog/wp-includes/js/jquery/jquery.js?ver=1.10.2'></script>
<script src='https://marc.cortinasval.cat/blog/wp-includes/js/jquery/jquery-migrate.min.js?ver=1.2.1'></script>
<script src='https://marc.cortinasval.cat/blog/wp-content/plugins/google-custom-search/js/gsc.js?ver=3.7.3'></script>
<script src='https://www.google.com/jsapi?ver=3.7.3'></script>
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="https://marc.cortinasval.cat/blog/xmlrpc.php?rsd"/>
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="https://marc.cortinasval.cat/blog/wp-includes/wlwmanifest.xml"/>
<meta name="generator" content="WordPress 3.7.3"/>
<script>var _gaq=_gaq||[];_gaq.push(['_setAccount','UA-0000000-0']);_gaq.push(['_trackPageview']);(function(){var ga=document.createElement('script');ga.type='text/javascript';ga.async=true;ga.src=('https:'==document.location.protocol?'https://ssl':'http://www')+'.google-analytics.com/ga.js';var s=document.getElementsByTagName('script')[0];s.parentNode.insertBefore(ga,s);})();</script>
<link rel="stylesheet" href="https://marc.cortinasval.cat/blog/wp-content/plugins/multi-column-tag-map/mctagmap.css?mctm_ver=12.0.4" type="text/css" media="screen"/>
<link rel="alternate" href="https://marc.cortinasval.cat/blog/ca/" hreflang="ca"/>
<link rel="alternate" href="https://marc.cortinasval.cat/blog/en/" hreflang="en"/>
<style id="syntaxhighlighteranchor"></style>
<script pagespeed_no_defer="">//<![CDATA[
(function(){var c=encodeURIComponent,g=window,h="performance";g.pagespeed=g.pagespeed||{};var l=g.pagespeed,m=function(f,a,d,b){this.c=f;this.a=a;this.b=d;this.d=b};l.beaconUrl="";
var n=function(f){var a=f.c,d=g.mod_pagespeed_start,b=Number(new Date)-d,a=a+(-1==a.indexOf("?")?"?":"&"),a=a+"ets="+("load"==f.a?"load:":"unload:"),a=a+b;if("beforeunload"!=f.a||!g.mod_pagespeed_loaded){a+="&r"+f.a+"=";if(g[h]){var b=g[h].timing,e=b.navigationStart,k=b.requestStart,a=a+(b[f.a+"EventStart"]-e),a=a+("&nav="+(b.fetchStart-e)),a=a+("&dns="+(b.domainLookupEnd-b.domainLookupStart)),a=a+("&connect="+(b.connectEnd-b.connectStart)),a=a+("&req_start="+(k-e)),a=a+("&ttfb="+(b.responseStart-
k)),a=a+("&dwld="+(b.responseEnd-b.responseStart)),a=a+("&dom_c="+(b.domContentLoadedEventStart-e));g[h].navigation&&(a+="&nt="+g[h].navigation.type);e=-1;b.msFirstPaint?e=b.msFirstPaint:g.chrome&&g.chrome.loadTimes&&(e=Math.floor(1E3*g.chrome.loadTimes().firstPaintTime));e=e-k;0<=e&&(a+="&fp="+e)}else a+=b;l.getResourceTimingData&&g.parent==g&&(a+=l.getResourceTimingData());a+=g.parent!=g?"&ifr=1":"&ifr=0";"load"==f.a&&(g.mod_pagespeed_loaded=!0,(b=g.mod_pagespeed_num_resources_prefetched)&&(a+=
"&nrp="+b),(b=g.mod_pagespeed_prefetch_start)&&(a+="&htmlAt="+(d-b)));l.panelLoader&&(d=l.panelLoader.getCsiTimingsString(),""!=d&&(a+="&b_csi="+d));l.criticalCss&&(d=l.criticalCss,a+="&ccis="+d.total_critical_inlined_size+"&cces="+d.total_original_external_size+"&ccos="+d.total_overhead_size+"&ccrl="+d.num_replaced_links+"&ccul="+d.num_unreplaced_links);""!=f.b&&(a+=f.b);document.referrer&&(a+="&ref="+c(document.referrer));a+="&url="+c(f.d);l.beaconUrl=a;(new Image).src=a}};
l.e=function(f,a,d,b){var e=new m(f,a,d,b);g.addEventListener?g.addEventListener(a,function(){n(e)},!1):g.attachEvent("on"+a,function(){n(e)})};l.addInstrumentationInit=l.e;})();

pagespeed.addInstrumentationInit('/mod_pagespeed_beacon', 'beforeunload', '', 'http://marc.cortinasval.cat/blog/ca/');
//]]></script></head>
<body class="blog">
<header role="banner">
<div id="top-bar" role="navigation">
<div class="container">
<div class="row">
<div id="site-description" class="col-xs-12 col-sm-12 col-md-12 col-lg-6">
<p>Tal com raja&#8230;.</p>
</div>
<div class="col-sm-12 col-md-12 col-lg-6">
<form id="header-search" role="search" class="search-form form-inline" action="https://marc.cortinasval.cat/blog/ca/">
<input type="search" class="search-field" value="" name="s"/>
<button type="submit"><span class="glyphicon glyphicon-search"></span></button>
</form>
</div>
</div>
</div>
</div>
<div id="bot-bar" class="container">
<div class="row">
<div id="logo" class="col-md-12 col-lg-3">
<button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
<span class="sr-only">Toggle navigation</span>
<span class="icon-bar"></span>
<span class="icon-bar"></span>
<span class="icon-bar"></span>
</button>
<a href="https://marc.cortinasval.cat/blog/ca/" rel="home">El blog d&#039;en Marc</a>
</div>
<div id="primary-menu" class="col-md-12 col-lg-9" role="navigation">
<div class="collapse navbar-collapse">
<ul id="menu-principal" class="menu"><li id="menu-item-10" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-10"><a href="https://marc.cortinasval.cat/blog/category/sysadmin/">SysAdmin</a></li>
<li id="menu-item-11" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-11"><a href="https://marc.cortinasval.cat/blog/category/tecno/">Tecnologia</a></li>
<li id="menu-item-12" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-12"><a href="https://marc.cortinasval.cat/blog/category/varis/">Varis</a></li>
<li id="menu-item-239-en" class="lang-item lang-item-64 lang-item-en menu-item menu-item-type-custom menu-item-object-custom menu-item-239-en"><a href="https://marc.cortinasval.cat/blog/en/" hreflang="en"><img src="https://marc.cortinasval.cat/blog/wp-content/plugins/polylang/flags/en_US.png" title="English" alt="English"/>&nbsp;English</a></li>
</ul>	</div>
</div>
</div>
</div>
</header>
<div id="content" class="container"><div class="row" role="main">
<div class="col-md-8">
<article id="post-25" class="post-25 post type-post status-publish format-standard sticky hentry category-sysadmin category-tecno tag-balance tag-centos tag-corosync tag-ha tag-haproxy tag-http tag-https tag-nginx tag-pacemaker tag-vmware">
<div class="sticky-txt "><span class="glyphicon glyphicon-star"></span> Featured Post</div>
<h3 class="post-title"><a href="https://marc.cortinasval.cat/blog/2013/12/04/balancejador-https-economic-nginxhaproxypacemaker/" rel="bookmark">Balancejador HTTP/S econòmic: Nginx+Haproxy+Pacemaker</a></h3><p>Seguidament us explicaré com es pot montar un balancejador httpS molt econòmic i molt eficient, el qual s&#8217;ha implementat tan en entorns productius com no productius, la motivació inicial del qual va ser centralitzar el balanceig dels diferents entorns d&#8217;integració continua d&#8217;una aplicació web. En entorns productius també l&#8217;he implementat després de fer varies probes de rendiment amb el &#8220;ab&#8221; i el &#8220;siege&#8221; .</p>
<p>L&#8217;únic requeriment que hem d&#8217;asumir és allotjar tot tràfic dels diferents entorns en subdominis d&#8217;un domini (p.e.example.com), on podem tenir int01.example.com, int02.example.com, test01.example.com, test02.example.com, pre.example.com, etc..</p>
<p>Anàlogament, en els entorns de producció, podem fer la mateixa discriminació diferenciant el tràfic pels paisos(es.example.com,fr.example.com), plataformes(m.example.com), tipus de contingut(static.example.com).</p>
<p>Els objectius que em vaig marcar van ser:</p>
<li>Baix cost econòmic: utilitzarem programari de codi obert des dels operatius fins als dimonis: CentOS, Nginx, Haproxy, Pacemaker, Corosync.</li>
<li>Alta disponibilitat de maquinari i programari: a nivell de maquinari ho montarem en una infraestructura virtualitzada amb varis nodes físics i implemtarem el pacemaker+corosync per a tenir alta disponibilitat en els dimonis.</li>
<li>Centralitzar la negociació SSL de tota la plataforma en un punt inicial i alliberar càrrega SSL del reste de la plataforma.</li>
<li>Permetre més flexibilitat i control en els balancejos de cadascún dels entorns: haproxy permet fa possible controlar en un pool de balanceig si un frontal hi està activat segons el seu nivell de càrrega o si te connexió contra la base de dades, per exemple.</li>
<li>Tenir una plataforma securitzada, requeriment essencial sobretot en entorns productius.</li>
<p>Els dimonis que utilitzarem serà Nginx, Haproxy, Pacemaker i Corosync, tot programari lliure on abarata el cost considerablement.</p>
<p>En el següent esquema es veu clarament l&#8217;arquitectura de tot el montatge.</p>
<p><a href="https://marc.cortinasval.cat/blog/wp-content/uploads/2013/03/fisicalLB.png"><img class="size-medium wp-image-64 aligncenter" alt="fisicalLB" src="https://marc.cortinasval.cat/blog/wp-content/uploads/2013/03/fisicalLB-300x203.png" width="300" height="203"/></a></p>
<p>El comento breument, no entraré en detall en tot, em centro en lo important d&#8217;aquest post. Els navegadors dels usuaris fan les peticions a les empreses que fan de CDN, després aquestes peticions van a parar en la nostra plataforma on filtrarem el tràfic amb un firewall. Un cop les peticions són filtrades van a parar un nginx. La finalitat del nginx es discriminar el tràfic segons el entorn i centralitzar totes les negociacions SSL del tràfic HTTPS. Seguidament, les peticions passen a un haproxy on aquest balanceja entre els diferents frontals de cadascun dels entorns.</p>
<p>Per tal de securitzar-ho tot, definirem 3 VLAN&#8217;s, dmz, frontend i backend. Tot el tràfic és filtrat pel firewall, el tràfic sortint, el entrant i el tràfic entre zones. En la DMZ posarem 2 maquines virtuals CentOs on tindrem els serveis de Nginx i Haproxy en actiu-passiu utlitzant pacemaker-corosync. En el frontend tenim els frontals de cadascun dels entorns i en el backend tenim les dades, mysql, cassandras, mongos, nfs, cifs, etc&#8230;.</p>
<p>Per exemplificar-ho millor, ens centrarem només en un entorn, int01.example.com.</p>
<p>Primerament en la DMZ montarem una 2 màquines virtuals on hi tindrem 2 ip flotants, una per el nginx i l&#8217;altre pel haproxy. Jo ho he implemetat en una infraestructura virtualitzada vmware però també es poden montar solucions més econòmiques com XenServer, KVM, etc&#8230; Evidentment, sigui quina sigui la solució de virtualització, hem d&#8217;assegurar-nos que les màquines virtuales sempre estàn corrent en màquines físiques diferents.</p>
<p>Les peticions entraran en la ip flotant del nginx, el nginx té dues funcions, centralitzar la negociació SSL i discriminar el tràfic per entorns. En el tràfic HTTPS afegirem una capçalera HTTP &#8220;X-forwarded-proto: https&#8221;, on l&#8217;apache la recollirà i activarà la variable HTTPS emmascarant-li a la aplicació. El tipus de certificat que afegirem en el nginx serà un certificat signat per una entitat certificadora oficial on el Common-Name que utilitzarem serà de tipus wildcard, es a dir, per aquest exemple, &#8220;*.example.com&#8221;, això ens facilitza molt la gestió del certificats i ens dona molta facilitat de gestió. En entorns de producció ho dimensionem assignant els valors correctes de <a href="http://wiki.nginx.org/CoreModule#worker_processes" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','http://wiki.nginx.org']);">worker_processes</a><strong> </strong>i <a href="http://wiki.nginx.org/EventsModule#worker_connections" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','http://wiki.nginx.org']);">worker_connections</a> tenint en compte la formula: max clients = worker_processes * worker_connections/4.</p>
<p>Seguidament les peticions passen al haproxy on aquest balanceja entre els diferents frontals de cadascun del entorn. El haproxy ens permet estriar l&#8217;algorisme de balanceig, jo acostumo a utilitzar Round Robin. A més, podem prefixar els rangs de IPs dels frontals que hi hauran en cadascun dels entorns, així podem desplegar més frontals en el cas que sigui necessari sense haber de reinicilitzar el dimoni.<br/>
Haproxy fara una petició a un php que hi ha en cadascun dels frontals on retorna un &#8220;OK&#8221; si no està swapejant, no té molta càrrega i té conectivitat en les bases de dades. Cal remarcar que haproxy també ens permet realitzar balancejos &#8220;sticky&#8221; tan en aplicacions JAVA com PHP, depenentment d&#8217;una capçalara HTTP, habitualment les capçaleres JSESSIONID i PHPSESSID respectivament. (en apps ASP teniem ASPSESSIONID). <a href="http://code.google.com/p/haproxy-docs/wiki/maxconn" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','http://code.google.com']);">En entorns de producció fixarem la variable maxconn tenim en compte que cada petició consumeix 17kb.</a></p>
<p>Finalment les peticions arriben als frontals on primerament passen pel varnish i les peticions que no siguin cachejables arribaran finalment al apache, crec que aquests dos dimonis es mereixen un post especial per ells dos, que ja tinc en el backlog del blog.</p>
<p>En el següent diagrama clarifica tota l&#8217;arquitectura:</p>
<div id="attachment_68" style="width: 310px" class="wp-caption aligncenter"><a href="https://marc.cortinasval.cat/blog/wp-content/uploads/2013/03/funcional.png" target="_blank"><img class="size-medium wp-image-68 " title="Diagrama Lògic" alt="Diagrama Lògic" src="https://marc.cortinasval.cat/blog/wp-content/uploads/2013/03/funcional-300x179.png" width="300" height="179"/></a><p class="wp-caption-text">Diagrama Lògic</p></div>
<p>Seguidament posaré les configuracions més importants, Nginx, Haproxy, Pacemaker:</p>
<p>Parametres del Nginx</p>
<pre class="brush: plain; title: ; notranslate" title="">
....
upstream http-example-int01 {
    server lb2-vip.example.com:8080;
    keepalive 16;
}
server {
        listen lb1-vip.example.com:80;
    server_name int01.example.com ~^.*-int01\.example\.com$;

        location / {
                proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
                proxy_set_header Host $host;
                proxy_pass http://http-example-int01/;
                proxy_redirect off;
        }
}
server {
        listen lb1-vip.example.com:443 ssl;
    server_name int01.example.com ~^.*-int01\.example\.com$;

        ssl on;
        ssl_certificate /etc/nginx/ssl/crt/concat.pem;
        ssl_certificate_key /etc/nginx/ssl/key/example.key;

        location / {
                proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
                proxy_set_header X-Forwarded-Proto https;
                proxy_set_header Host $host;
                proxy_pass http://http-example-int01/;
                proxy_redirect off;
        }
}
....
</pre>
<p>Parametres del Haproxy</p>
<pre class="brush: plain; title: ; notranslate" title="">
...
frontend example-int01 lb2-vip.grpprod.com:8080
    default_backend example-int01
backend  example-int01
        option forwardfor
        option httpchk GET /healthcheck.php
        http-check expect string OK
        server  web01 x.y.z.w:80 check inter 2000 fall 3
        server  web02 x.y.z.w:80 check inter 2000 fall 3
        server  web03 x.y.z.w:80 check inter 2000 fall 3
        server  web04 x.y.z.w:80 check inter 2000 fall 3
        server  web05 x.y.z.w:80 check inter 2000 fall 3
...
</pre>
<p>Parametres del Apache</p>
<pre class="brush: plain; title: ; notranslate" title="">

 ServerName int01.example.com
    DocumentRoot &quot;/srv/www/example/fa-front/public&quot;

   &lt;Directory &quot;/srv/www/example/fa-front/public&quot;&gt;
      Options -Indexes FollowSymLinks
      AllowOverride None
      Allow from All
      Order Allow,Deny
      RewriteEngine On
      RewriteCond %{HTTP:X-Forwarded-Proto} https
      RewriteRule .* - [E=HTTPS:on]

      RewriteCond %{REQUEST_FILENAME} -s [OR]
      RewriteCond %{REQUEST_FILENAME} -l [OR]
      RewriteCond %{REQUEST_FILENAME} -d
      RewriteRule ^.*$ - [NC,L]
      RewriteRule ^.*$ index.php [NC,L]

   SetEnv APPLICATION_ENV int01
   DirectoryIndex index.php

   LogFormat &quot;%v %{Host}i %h %l %u %t \&quot;%r\&quot; %&gt;s %b %{User-agent}i&quot; marc.int01
   CustomLog /var/log/httpd/cloud-example-front.log example

</pre>
<p>Parametres del Pacemaker</p>
<pre class="brush: plain; title: ; notranslate" title="">
node balance01
node balance02
primitive nginx lsb:nginx \
        op monitor interval=&quot;1s&quot; \
        meta target-role=&quot;Started
primitive haproxy lsb:haproxy \
        op monitor interval=&quot;1s&quot; \
        meta target-role=&quot;Started&quot;
primitive lb1-vip ocf:heartbeat:IPaddr2 \
        params ip=&quot;x.x.x.x&quot; iflabel=&quot;nginx-vip&quot; cidr_netmask=&quot;32&quot; \
        op monitor interval=&quot;1s&quot;
primitive lb2-vip ocf:heartbeat:IPaddr2 \
        params ip=&quot;y.y.y.y&quot; iflabel=&quot;haproxy-vip&quot; cidr_netmask=&quot;32&quot; \
        op monitor interval=&quot;1s&quot;
group haproxy_cluster lb2-vip haproxy \
        meta target-role=&quot;Started&quot;
group nginx_cluster lb1-vip  nginx \
        meta target-role=&quot;Started&quot;
property $id=&quot;cib-bootstrap-options&quot; \
        dc-version=&quot;1.1.7-6.el6-148fccfd5985c5590cc601123c6c16e966b85d14&quot; \
        cluster-infrastructure=&quot;openais&quot; \
        expected-quorum-votes=&quot;2&quot; \
        stonith-enabled=&quot;false&quot; \
        last-lrm-refresh=&quot;1355137974&quot; \
        no-quorum-policy=&quot;ignore&quot;
rsc_defaults $id=&quot;rsc-options&quot; \
        resource-stickiness=&quot;100&quot;
</pre>
<div class="post-meta clearfix post-meta-list">
<p class="author-date">
<span class="glyphicon glyphicon-user"></span> mcortinas
<span class="glyphicon glyphicon-calendar"></span> Desembre 4, 2013
</p>
<p class="post-tags"><span class="glyphicon glyphicon-tags"></span><a href="https://marc.cortinasval.cat/blog/tag/balance/">balance</a> <span class="slash"> / </span><a href="https://marc.cortinasval.cat/blog/tag/centos/">centos</a> <span class="slash"> / </span><a href="https://marc.cortinasval.cat/blog/tag/corosync/">corosync</a> <span class="slash"> / </span><a href="https://marc.cortinasval.cat/blog/tag/ha/">ha</a> <span class="slash"> / </span><a href="https://marc.cortinasval.cat/blog/tag/haproxy/">haproxy</a> <span class="slash"> / </span><a href="https://marc.cortinasval.cat/blog/tag/http/">http</a> <span class="slash"> / </span><a href="https://marc.cortinasval.cat/blog/tag/https/">https</a> <span class="slash"> / </span><a href="https://marc.cortinasval.cat/blog/tag/nginx/">nginx</a> <span class="slash"> / </span><a href="https://marc.cortinasval.cat/blog/tag/pacemaker/">pacemaker</a> <span class="slash"> / </span><a href="https://marc.cortinasval.cat/blog/tag/vmware/">vmware</a> <span class="slash"> / </span></p>
</div>
</article>
<hr class="post-divider"><article id="post-522" class="post-522 post type-post status-publish format-standard hentry category-varis">
<h3 class="post-title"><a href="https://marc.cortinasval.cat/blog/2015/01/12/elk-en-centos7/" rel="bookmark">ELK en CentOs7</a></h3><p>Aprofitant els dies lliures de vacances i amb el propòsit de conèixer les novetats de ELK, m&#8217;he decidit a instalar-ho en una màquina virtual vBox amb l&#8217;objectiu conèixer i practicar l&#8217;indexació de logs implementant-ho en un CentOs7. Alhora, tinc un bon amic que ho vol implementar i m&#8217;agradaria que serveixi de recull de comandes i una petita guia d&#8217;implementació.</p>
<p>En aquest post va dirigit a tots els usuaris que coneixen ELK (Elasticsearch+Logstash+kibana), no vull pas explicar que és cada component sinó únicament recopilar totes les configuracions i joc de proves utilitzades en el montatge del següent diagrama.</p>
<p>En aquest diagrama recullo la foto de totes les eines que he utilitzat en la màquina virtual, alhora, <a href="https://github.com/mcortinas/mcortinas/tree/master/elk" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','http://github.com']);"> he pujat les diferents configuracions, VagrantFile i passwords al GitHub</a> i <a href="https://mega.co.nz/#!tkI3kKJA!FUbJDaRL17HfL12bjU3OdKmEbRpsYbT0nrmPv1nBJI0" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','http://mega.co.nz']);"> la màquina virtual en el MEGA, pesa 1.5GB </a>, deixo aquí els links per si algú la vol descarregar.</p>
<p><a href="https://marc.cortinasval.cat/blog/wp-content/uploads/2015/01/Elk-CentoOs7-2.png"><img class="align center size-full wp-image-539" alt="Elk-CentoOs7" src="https://marc.cortinasval.cat/blog/wp-content/uploads/2015/01/Elk-CentoOs7-2.png" width="1441" height="728"/></a></p>
<p>Bàsicament veiem com utilitzem logstash per agafar els logs de APACHE, SYSLOG, ELASTICSEARCH i CARBON, on enviem els logs filtrats amb els camps ja splittejats a 4 cues diferents de Redis, on tindrem una altra instancia de logstash que va agafant les dades d&#8217;aquestes 4 cues i les va insertant al Elasticsearch. A través de la interficie Kibana podem crear dashboard i interpretar les dades (els logs) recopilats.</p>
<p>Si ens centrem com he utilitzat logstash per a tal de recollir els logs:<br/>
- Apache: la instancia de logstash va recollint les traces dels fitxers de logs del apaches, les filtra i les envia al redis.<br/>
- Carbon-cache: una instancia de logstash va recollint les traces dels fitxers de logs del carbon-cache, aplica un filtre i ho envia al redis<br/>
- Syslog: Hem afegit en el Rsyslog de Centos7 l&#8217;enviem dels logs del SYSLOG al port 514/tcp, on tenim una instancia de logstash que agafa els logs, els filtra i els envia a Redis.<br/>
- Elasticsearch: molt semblant al anterior, es a dir, modifiquem el logging de ES per a escriure els logs al port 9300/tcp, on tindrem una instancia de logstash que anirà recollint els logs, filtrant i enviant-ho al Redis.</p>
<p>Alhora, hem instalat un graphite+carbon que va recollint les dades del OS i dels serveis Redis i Elasticsearch a través de &#8220;diamond&#8221;, un python script molt complert per recollir dades al graphite. En aquest cas, la interficie de Grafana i Graphite ens permetrà graficar.</p>
<pre class="brush: plain; collapse: true; light: false; title: Installation commands for Graphite and Carbon-Cache; toolbar: true; notranslate" title="Installation commands for Graphite and Carbon-Cache">
yum -y update
yum install -y httpd net-snmp perl pycairo mod_wsgi python-devel git gcc-c++
yum install -y python-pip node npm
pip install 'django&amp;lt;1.6'
pip install 'Twisted&amp;lt;12'
pip install django-tagging
pip install whisper
pip install graphite-web
pip install carbon
yum install collectd collectd-snmp
cp /opt/graphite/examples/example-graphite-vhost.conf /etc/httpd/conf.d/graphite.conf
cp /opt/graphite/conf/storage-schemas.conf.example /opt/graphite/conf/storage-schemas.conf
cp /opt/graphite/conf/storage-aggregation.conf.example /opt/graphite/conf/storage-aggregation.conf
cp /opt/graphite/conf/graphite.wsgi.example /opt/graphite/conf/graphite.wsgi
cp /opt/graphite/conf/graphTemplates.conf.example /opt/graphite/conf/graphTemplates.conf
cp /opt/graphite/conf/carbon.conf.example /opt/graphite/conf/carbon.conf
chown -R apache:apache /opt/graphite/storage/
vi /opt/graphite/conf/storage-schemas.conf #set granularity and retention data on whisper files
cd /opt/graphite/webapp/graphite
sudo python manage.py syncdb
systemctl enable httpd
systemctl start httpd
/opt/graphite/bin/carbon-cache.py start
#/opt/graphite/bin/run-graphite-devel-server.py /opt/graphite/ #developer mode
chmod 777 /opt/graphite/storage/log/webapp/
# Be ware fix permissions for sqlite database
chmod 777 /opt/graphite/storage/graphite.db
vi /etc/systemd/system/carbon-cache-a.service
 [Unit]
 Description=carbon-cache instance A (graphite)

 [Service]
 User=root
 Group=root
 ExecStartPre=/bin/rm -f /opt/graphite/storage/carbon-cache-a.pid
 ExecStart=/opt/graphite/bin/carbon-cache.py --instance=a start
 Type=forking
 PIDFile=/opt/graphite/storage/carbon-cache-a.pid
 LimitNOFILE=128000

 [Install]
 WantedBy=multi-user.target
systemctl enable carbon-cache-a.service
</pre>
<pre class="brush: plain; collapse: true; light: false; title: Installation Elasticsearch commands; toolbar: true; notranslate" title="Installation Elasticsearch commands">
yum -y install java-1.7.0-openjdk
rpm --import http://packages.elasticsearch.org/GPG-KEY-elasticsearch
vi /etc/yum.repos.d/elasticsearch.repo #add follow lines
 [elasticsearch-1.1]
 name=Elasticsearch repository for 1.1.x packages
 baseurl=http://packages.elasticsearch.org/elasticsearch/1.1/centos
 gpgcheck=1
 gpgkey=http://packages.elasticsearch.org/GPG-KEY-elasticsearch
 enabled=1
yum -y install elasticsearch-1.1.1
vi /etc/elasticsearch/elasticsearch.yml #modify next parameters if it is necessary
 script.disable_dynamic: true
 discovery.zen.ping.multicast.enabled: false
systemctl start elasticsearch.service
systemctl enable elasticsearch.service
#Enable kopek and head elastic search pluging
/usr/share/elasticsearch/bin/plugin --install mobz/elasticsearch-head
/usr/share/elasticsearch/bin/plugin --install lmenezes/elasticsearch-kopf
</pre>
<pre class="brush: plain; collapse: true; light: false; title: Installation kibana commands; toolbar: true; notranslate" title="Installation kibana commands">
mkdir -p /opt/www/kibana
cd !$; curl -s -L https://download.elasticsearch.org/kibana/kibana/kibana-3.0.1.tar.gz | tar xz
mv kibana-3.0.1/* . &amp;amp;&amp;amp; rmdir kibana-3.0.1
vi ~/kibana-3.0.1/config.js #modify next parameters if it is necessary
 elasticsearch: &amp;quot;http://&amp;quot;+window.location.hostname+&amp;quot;:80&amp;quot;,
vi /etc/httpd/conf.d/kibana3.conf #modify next parameters if it is necessary

  ServerName kibana

  DocumentRoot /opt/www/kibana

    Allow from all
    Options -Multiviews


  LogLevel debug
  ErrorLog /var/log/httpd/kibana_error_log
  CustomLog /var/log/httpd/kibana_access_log combined

  # Set global proxy timeouts
  
    ProxySet connectiontimeout=5 timeout=90


  # Proxy for _aliases and .*/_search
  &amp;lt;LocationMatch &amp;quot;^/(_nodes|_aliases|.*/_aliases|_search|.*/_search|_mapping|.*/_mapping)$&amp;quot;&amp;gt;
    ProxyPassMatch http://127.0.0.1:9200/$1
    ProxyPassReverse http://127.0.0.1:9200/$1


  # Proxy for kibana-int/{dashboard,temp} stuff (if you don't want auth on /, then you will want these to be  protected)
  &amp;lt;LocationMatch &amp;quot;^/(kibana-int/dashboard/|kibana-int/temp)(.*)$&amp;quot;&amp;gt;
    ProxyPassMatch http://127.0.0.1:9200/$1$2
    ProxyPassReverse http://127.0.0.1:9200/$1$2


systemctl start httpd.service
systemctl enable httpd.service
</pre>
<pre class="brush: plain; collapse: true; light: false; title: Installation Logstash commands; toolbar: true; notranslate" title="Installation Logstash commands">
vi /etc/yum.repos.d/logstash.repo #add follow lines
 [logstash-1.4]
 name=logstash repository for 1.4.x packages
 baseurl=http://packages.elasticsearch.org/logstash/1.4/centos
 gpgcheck=1
 gpgkey=http://packages.elasticsearch.org/GPG-KEY-elasticsearch
 enabled=1
yum -y install logstash-1.4.2
</pre>
<pre class="brush: plain; collapse: true; light: false; title: Installation Grafana commands; toolbar: true; notranslate" title="Installation Grafana commands">
mkdir -p /opt/www/grafana
cd !$; curl -s -L http://grafanarel.s3.amazonaws.com/grafana-1.9.0.tar.gz | tar xz
mv grafana-1.9.0/* .
rmdir grafana-1.9.0
cp config.sample.js config.js
vi config.js #be sure these lines are enabled
      datasources: {
        graphite: {
          type: 'graphite',
          url: &amp;quot;http://graphite:80&amp;quot;,
        },
        elasticsearch: {
          type: 'elasticsearch',
          url: &amp;quot;http://127.0.0.1:9200&amp;quot;,
          index: 'grafana-dash',
          grafanaDB: true,
        }
vi /etc/httpd/conf.d/grafana.conf #add these configuration lines

  ServerName grafana

  DocumentRoot /opt/www/grafana

    Allow from all
    Options -Multiviews


  LogLevel debug
  ErrorLog /var/log/httpd/grafana_error_log
  CustomLog /var/log/httpd/grafana_access_log combined

systemctl start httpd.service
systemctl enable httpd.service
</pre>
<pre class="brush: plain; collapse: true; light: false; title: Installation Redis commands; toolbar: true; notranslate" title="Installation Redis commands">
#we need Epel repository enabled
yum install redis
systemctl start redis.service
systemctl status redis.service
systemctl enable redis.service
redis-cli ping
</pre>
<pre class="brush: plain; collapse: true; light: false; title: Modify HOSTFILE in vBox and physical node,disable SELinux and Firewalld in vBox; toolbar: true; notranslate" title="Modify HOSTFILE in vBox and physical node,disable SELinux and Firewalld in vBox">
echo &amp;quot;127.0.0.1 kibana grafana graphite redis-commander&amp;quot; &amp;gt; /etc/hosts
systemctl stop firewalld
systemctl disable firewalld
vi /etc/selinux/config #Be ware is disabled instead of enforced in the next config line
 SELINUX=disabled
reboot
</pre>
<pre class="brush: plain; collapse: true; light: false; title: Apache fix; toolbar: true; notranslate" title="Apache fix">
#Add &amp;quot;Require all granted&amp;quot; in any vhost applied in this lab
#more info: http://httpd.apache.org/docs/2.4/upgrading.html
 Require all granted
</pre>
<p style="text-align: center;">Aquestes són les eines implementades:<br/>
-Elasticsearch, prices java on tenim indexat les diferents tipus de traces, com podem veure:<br/>
<a href="https://marc.cortinasval.cat/blog/wp-content/uploads/2015/01/Captura-de-pantalla-2015-01-12-a-les-1.24.07.png"><img class="wp-image-549 alignnone" alt="Captura de pantalla 2015-01-12 a les 1.24.07" src="https://marc.cortinasval.cat/blog/wp-content/uploads/2015/01/Captura-de-pantalla-2015-01-12-a-les-1.24.07.png" width="353" height="356"/></a><br/>
-Kibana, aplicació javascript que permet fer consultes, dashboards per interpretar els logs indexats en el ES.<br/>
<a href="https://marc.cortinasval.cat/blog/wp-content/uploads/2015/01/Kibana_3_-_BasicELK1_-_2015-01-12_01.33.44.png"><img class="aligncenter  wp-image-553" alt="Kibana_3_-_BasicELK1_-_2015-01-12_01.33.44" src="https://marc.cortinasval.cat/blog/wp-content/uploads/2015/01/Kibana_3_-_BasicELK1_-_2015-01-12_01.33.44.png" width="820" height="3397"/></a><br/>
-Logstash, aplicació java que recull els logs, el filtra i categoritza i els indexa al ES, utilitzant Redis com a memoria intermedia.<br/>
-Grafana, aplicació Javascript que permet fer consultes, dashboards de les dades de graphite.<br/>
<a href="https://marc.cortinasval.cat/blog/wp-content/uploads/2015/01/Grafana_-_ELK-1_-_2015-01-10_18.15.38.png"><img class="aligncenter  wp-image-550" alt="Grafana_-_ELK-1_-_2015-01-10_18.15.38" src="https://marc.cortinasval.cat/blog/wp-content/uploads/2015/01/Grafana_-_ELK-1_-_2015-01-10_18.15.38.png" width="768" height="719"/></a><br/>
-Graphite+Carbon-Cache+Diamond, aplicació en python que recull estat dels serveis i els introdueix al carbon. Aquí veiem com ho podem consultar a través de la webapp de graphite.<br/>
<a href="https://marc.cortinasval.cat/blog/wp-content/uploads/2015/01/Captura-de-pantalla-2015-01-12-a-les-1.28.00.png"><img class="aligncenter  wp-image-551" alt="Captura de pantalla 2015-01-12 a les 1.28.00" src="https://marc.cortinasval.cat/blog/wp-content/uploads/2015/01/Captura-de-pantalla-2015-01-12-a-les-1.28.00.png" width="364" height="506"/></a><br/>
-Redis + Redis-Commander, memoria intermedia on logstash va guardant els logs ja filtrats. Redis-Commander es una aplicació en nodeJS que permet monitorar l&#8217;estat de les 4 cues que utlitzem de Redis.<br/>
<a href="https://marc.cortinasval.cat/blog/wp-content/uploads/2015/01/Captura-de-pantalla-2015-01-11-a-les-20.11.09.png"><img class="aligncenter size-full wp-image-548" alt="Captura de pantalla 2015-01-11 a les 20.11.09" src="https://marc.cortinasval.cat/blog/wp-content/uploads/2015/01/Captura-de-pantalla-2015-01-11-a-les-20.11.09.png" width="2560" height="1288"/></a></p>
<p>Si us baixeu la maquina virtual vBox i la inicieu amb Vagrant <a href="https://github.com/mcortinas/mcortinas/blob/master/elk/Vagrantfile" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','http://github.com']);"> (utilitzant aquest VagrantFile que linko aquí)</a>, aquestes serán les URLs de les aplicacions implementades:<br/>
- <a href="http://127.0.0.1:39200" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','']);">URL ES: http://127.0.0.1:39200</a><br/>
- <a href="http://127.0.0.1:39200/_plugin/head/" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','']);">Pluguin Head ES, http://127.0.0.1:39200/_plugin/head/</a><br/>
- <a href="http://kibana:3080/"> Kibana GUI, http://kibana:3080</a><br/>
- <a href="http://grafana:3080/"> Grafana GUI, http://grafana:3080/ </a><br/>
- <a href="http://graphite:3080/"> Graphite GUI, http://graphite:3080/ </a><br/>
- <a href="http://redis-commander:3080/"> Redis Commander GUI, http://redis-commander:3080/ </a></p>
<p>També recopilo les fonts que he seguit per instalar-ho i configurar-ho.<br/>
- <a href="http://sourceforge.net/projects/mustsyslog/?source=typ_redirect" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','http://sourceforge.net']);">http://sourceforge.net/projects/mustsyslog/?source=typ_redirec </a><br/>
- <a href="http://kartar.net/2014/09/when-logstash-and-syslog-go-wrong/" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','http://kartar.net']);">http://kartar.net/2014/09/when-logstash-and-syslog-go-wrong/ </a><br/>
- <a href="http://www.ozmonet.com/projects/graphite.html" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','http://www.ozmonet.com']);">http://www.ozmonet.com/projects/graphite.html </a><br/>
- <a href="https://www.digitalocean.com/community/tutorials/how-to-use-logstash-and-kibana-to-centralize-logs-on-centos-7" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','http://www.digitalocean.com']);">https://www.digitalocean.com/community/tutorials/how-to-use-logstash-and-kibana-to-centralize-logs-on-centos-7 </a><br/>
- <a href="http://www.rsyslog.com/doc/rsyslog_reliable_forwarding.html" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','http://www.rsyslog.com']);">http://www.rsyslog.com/doc/rsyslog_reliable_forwarding.html </a></p>
<div class="post-meta clearfix post-meta-list">
<p class="author-date">
<span class="glyphicon glyphicon-user"></span> mcortinas
<span class="glyphicon glyphicon-calendar"></span> Gener 12, 2015
</p>
</div>
</article>
<hr class="post-divider"><article id="post-472" class="post-472 post type-post status-publish format-standard hentry category-sysadmin category-tecno tag-carbon tag-graphite tag-monitor tag-systems tag-whisper">
<h3 class="post-title"><a href="https://marc.cortinasval.cat/blog/2014/04/29/graphite-gran-recurs-per-graficar-sistemes/" rel="bookmark">Graphite: gran recurs per gràficar sistemes</a></h3><p>després de un parell de caps de setmana aprenent el potencial del Grpahite i aprofitant que he descobert el Omnigraffle també m&#8217;he animat a fer uns dibuixets. </p>
<p>En aquest post recopilaré les comandes i configuracions aplicades per montar un lab en el macbook, on l&#8217;objectiu ha estat conèixer cadascun dels components que ens proporciona el Grpahite per a tal d&#8217;escalar-ho i també d&#8217;aconseguir una mica de alta disponibilitat.</p>
<p>Mostraré 3 escenaris i comentaré les configuracions, on anirà creixent la complexitat alhora que tindrem el montatge preparat per recollir/graficar més quantitat de dades de forma més segura, ja enfoncant-ho per entorns de producció. </p>
<p>Les eines que he fet servir han estat Vagrant+VirtualBox per a virtualizat i Ubuntu 13.04 LTS en cadascun dels nodes virtualitzats.</p>
<p>Evidentment, tot el que he practicat i après ha estat llegint les següents fonts:<br/>
- <a href="https://launchpad.net/graphite" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','http://launchpad.net']);" title="https://launchpad.net/graphite" target="_blank">https://launchpad.net/graphite</a><br/>
- <a href="http://graphite.wikidot.com/installation" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','http://graphite.wikidot.com']);" title="http://graphite.wikidot.com/installation" target="_blank">http://graphite.wikidot.com/installation</a><br/>
- <a href="http://bitprophet.org/blog/2013/03/07/graphite/" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','http://bitprophet.org']);" title="http://bitprophet.org/blog/2013/03/07/graphite/" target="_blank">http://bitprophet.org/blog/2013/03/07/graphite/</a></p>
<p>Comencem per el escenari més sencill, on montem una maquina virtual Ubuntu a sobre el virtual Box amb Vagrant, on us pasaré les comandes utilitzades per a la instalació base.</p>
<pre class="brush: plain; title: ; notranslate" title="">	
wget https://launchpad.net/graphite/0.9/0.9.10/+download/check-dependencies.py
python check-dependencies.py
apt-get update
apt-get upgrade
apt-get update
apt-get -y install python-cairo python-django python-django-tagging python-memcache python-ldap python-zope python-twisted python-txamqp
python check-dependencies.py
apt-get -y install git vim 

wget https://launchpad.net/graphite/0.9/0.9.10/+download/whisper-0.9.10.tar.gz
tar xvfz whisper-0.9.10.tar.gz
cd whisper-0.9.10/
python setup.py install
cd ..
wget https://launchpad.net/graphite/0.9/0.9.10/+download/carbon-0.9.10.tar.gz
tar xvfz carbon-0.9.10.tar.gz
cd carbon-0.9.10/
python setup.py install
cd ..
wget https://launchpad.net/graphite/0.9/0.9.10/+download/graphite-web-0.9.10.tar.gz
tar xvfz graphite-web-0.9.10.tar.gz
cd graphite-web-0.9.10/
python setup.py install
cd ..

apt-get install libapache2-mod-wsgi
cd /opt/graphite/conf
cp carbon.conf.example carbon.conf
vim carbon.conf
cp storage-schemas.conf.example storage-schemas.conf
vim storage-schemas.conf
/opt/graphite/bin/carbon-cache.py start
cp /opt/graphite/webapp/graphite/local_settings.py.example /opt/graphite/webapp/graphite/local_settings.py
vim /opt/graphite/webapp/graphite/local_settings.py
rm /etc/apache2/sites-enabled/000-default
cd /opt/graphite
cp ./examples/example-graphite-vhost.conf /etc/apache2/sites-enabled/
chown -R www-data webapp
chgrp www-data storage
chmod g+w storage
su - www-data
 cd /opt/graphite
 PYTHONPATH=`pwd`/webapp:`pwd`/whisper python ./webapp/graphite/manage.py syncdb
cp /opt/graphite/conf/graphite.wsgi.example /opt/graphite/conf/graphite.wsgi
chgrp www-data /opt/graphite/storage/log/webapp
chmod g+w /opt/graphite/storage/log/webapp
/etc/init.d/apache2 restart
</pre>
<p>L&#8217;escenari que obtenir és el segment i detallem per sobre cadascuna de les peces:<br/>
<a href="https://marc.cortinasval.cat/blog/wp-content/uploads/2014/04/scenari1.png"><img src="https://marc.cortinasval.cat/blog/wp-content/uploads/2014/04/scenari1.png" alt="scenari1" width="392" height="298" class="alignleft size-full wp-image-475"/></a></p>
<p>- <a> diamon.py: </a> Python script que recull dades del sistema que volem graficar. Més info a <a href="http://docs.brightcove.com/en/video-cloud/open-source/" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','http://docs.brightcove.com']);" title="http://docs.brightcove.com/en/video-cloud/open-source/" target="_blank">aquí</a>. Aquest dimoni enviará les dades en format plà al port 2003/tcp del carbon-cache.py amb el format: &#8220;NOM_DADE VALOR_DADA TIMESTAMP&#8221;. També ho pot enviar al port 2004/tcp si volem optimitzar l&#8217;enviament.<br/>
- <a> carbon-cache.py: </a> Python Script que recull les dades tcp o udp, va emmagatzemant les dades en RAM i va volcant les dades al filesystem. La granularitat i la retenció de dades són definides a aquí.<br/>
- <a> Fitxer de dades WHISPER: </a>En el sistema de fitxers tindrem un fitxer per a cada tipu de dada, amb extensió WSP<br/>
- <a> Una webapp python </a> serà la encarregada de partir dels fitxers WHISPER permetré graficar-los i obetnir els reports. </p>
<p>El carbon-cache.py és el component més important, per una banda, a ell li direm com guardarem les dades i per una altra també defineix com s&#8217;escala tota la solució, ja que si volem més capacitat haurem de posar més carbon-cache.py (1 per vCPU) i un carbon-relay.py per sobre que vagi distribuint l&#8217;entrada de dades.<br/>
TIP: En el cas de voler fer sharding de dades, ho hauriem de definir a aquí.</p>
<p>A l&#8217;hore de agregar dades, ho tenim en 3 formes diferents:<br/>
&#8211; Les guardem totes les dades granulades en els fitxers WSP i en la webapp graphite serà on les pintem agregades utilitzant funcions i el gran amic wilcard &#8220;*&#8221;.<br/>
&#8211; Fem un agregat de dades en el carbon-cache.py a l&#8217;hora de emmagatzemar-ho a disc en el fitxer WSP, per defecte, quant tenim varies dades per a un mateix &#8220;instant&#8221; de temps, carbon-cache utilitza la funció de mitjana amb les dades entrants i només guarda un resultat. Podem canviar la funció de agregació i jugant amb els patrons en el carbon-cache.py, això ho especifiquem en el fitxer storage-aggregations.conf.<br/>
&#8211; Per sobre del carbon-cache.py hi posem un altre python script carbon-aggregator.py on anirà agregant les dades rebudes del collectors i les enviarà al carbon-cache.</p>
<p>Ara ja estem en condicions d&#8217;entendre el seguent resum:<br/>
<a href="https://marc.cortinasval.cat/blog/wp-content/uploads/2014/04/summary1.png"><img src="https://marc.cortinasval.cat/blog/wp-content/uploads/2014/04/summary1.png" alt="summary" width="603" height="644" class="alignleft size-full wp-image-484"/></a></p>
<p>El segon escenari, duplicarem el numero de nodes i afegirem el carbon-relay.py en cadascun d&#8217;ells. En aquest hi definirem un factor de replicació de 2 i enviarem les dades el corresponent carbon-cache.py i al carbon-relay de l&#8217;altre node. Obtindrem el següent escenari:<br/>
<a href="https://marc.cortinasval.cat/blog/wp-content/uploads/2014/04/HAcreuat.png"><img src="https://marc.cortinasval.cat/blog/wp-content/uploads/2014/04/HAcreuat.png" alt="HAcreuat" width="590" height="470" class="alignleft size-full wp-image-486"/></a></p>
<p>En la següent captura teniu els dos webapps on veiem que grafiquen dades dels 2 collectors:<br/>
<a href="https://marc.cortinasval.cat/blog/wp-content/uploads/2014/04/Captura-de-pantalla-2014-04-26-a-les-10.35.46.png"><img src="https://marc.cortinasval.cat/blog/wp-content/uploads/2014/04/Captura-de-pantalla-2014-04-26-a-les-10.35.46.png" alt="Captura de pantalla 2014-04-26 a les 10.35.46" width="2454" height="1180" class="alignleft size-full wp-image-487"/></a></p>
<p>Finalment, l&#8217;ultime escenari que tenim es afegir un 3 node on únicament hi montarem un carbon-relay.py i serà ell qui rebi tot el trafic d&#8217;entrada i qui apliqui un factor de replicació 2, on passarà el trafic als carbon-relay.py que hi tenim en cada node. A més, duplicarem en cada node el numero de carbon-cache.py. En el fitxer relay-rules.conf definirem quines dades enviarem a cadascun del cabon-caches.py de cada node.</p>
<p><a href="https://marc.cortinasval.cat/blog/wp-content/uploads/2014/04/hafull.png"><img src="https://marc.cortinasval.cat/blog/wp-content/uploads/2014/04/hafull.png" alt="hafull" width="590" height="595" class="alignleft size-full wp-image-489"/></a> </p>
<p>Per concluir, us paso el fitxer de Vagrant on teniu definides les 3 VMs per si algú el vol aprofitar.</p>
<pre class="brush: plain; title: ; notranslate" title="">
❯ cat Vagrantfile
Vagrant::Config.run do |config|
    config.vm.define :graphiterelay do |graphiterelay_config|
        graphiterelay_config.vm.box = &quot;graphiterelay&quot;
        graphiterelay_config.vm.box_url = &quot;package.box&quot;
        graphiterelay_config.vm.forward_port 80,8000
        graphiterelay_config.vm.forward_port 8888,8888
        graphiterelay_config.vm.forward_port 443,44300
        graphiterelay_config.vm.network :hostonly, &quot;192.168.50.2&quot;, :netmask =&gt; &quot;255.255.255.0&quot;
    end
    config.vm.define :graphite do |graphite_config|
	graphite_config.vm.box = &quot;graphite&quot;
	graphite_config.vm.box_url = &quot;/Users/mcortinas/Boxes/ubuntu-precise12042-x64-vbox43.box&quot;
        graphite_config.vm.forward_port 80,8001
        graphite_config.vm.forward_port 443,44301
	graphite_config.vm.forward_port 8888,18888
	graphite_config.vm.network :hostonly, &quot;192.168.50.4&quot;, :netmask =&gt; &quot;255.255.255.0&quot;
    end
    config.vm.define :graphite2 do |graphite2_config|
        graphite2_config.vm.box = &quot;graphite2&quot;
        graphite2_config.vm.box_url = &quot;package.box&quot;
        graphite2_config.vm.forward_port 80,8002
	graphite2_config.vm.forward_port 8888,28888
        graphite2_config.vm.forward_port 443,44302
	graphite2_config.vm.network :hostonly, &quot;192.168.50.5&quot;, :netmask =&gt; &quot;255.255.255.0&quot;
    end
end
</pre>
<div class="post-meta clearfix post-meta-list">
<p class="author-date">
<span class="glyphicon glyphicon-user"></span> mcortinas
<span class="glyphicon glyphicon-calendar"></span> Abril 29, 2014
</p>
<p class="post-tags"><span class="glyphicon glyphicon-tags"></span><a href="https://marc.cortinasval.cat/blog/tag/carbon/">carbon</a> <span class="slash"> / </span><a href="https://marc.cortinasval.cat/blog/tag/graphite/">graphite</a> <span class="slash"> / </span><a href="https://marc.cortinasval.cat/blog/tag/monitor/">monitor</a> <span class="slash"> / </span><a href="https://marc.cortinasval.cat/blog/tag/systems/">systems</a> <span class="slash"> / </span><a href="https://marc.cortinasval.cat/blog/tag/whisper/">whisper</a> <span class="slash"> / </span></p>
</div>
</article>
<hr class="post-divider"><article id="post-303" class="post-303 post type-post status-publish format-standard hentry category-sysadmin tag-akamai tag-amazon tag-aws tag-cloudfront tag-elasticserch tag-kibana tag-logstasgh tag-waf">
<h3 class="post-title"><a href="https://marc.cortinasval.cat/blog/2014/03/05/kibana-ens-ajuda-amb-els-logs-de-aws-cloudfront-i-waf-akamai/" rel="bookmark">Kibana ens ajuda amb els logs de AWS Cloudfront i WAF Akamai</a></h3><p>L&#8217;anàlisis dels logs en qualsevol plataforma és molt important ja que ens permet veure quin és el comportament de cadascun dels components, alhora, ens permet des de corregir error, preveure averies a millorar el producte. De totes les solucions que he tingut la sort de probar, Splunk és la que més m&#8217;ha agradat. L&#8217;unic inconvenient d&#8217;utilitzar l&#8217;Splunk és el seu preu.</p>
<p>Degut al alt cost de l&#8217;Splunk i aprofitant que l&#8217;empresa on treballo necessita analitzar els logs de les CDNs de AWS Cloudfront i Akamai, vaig aprofitar per probar Kibana+Elastcisearch+Logstash. L&#8217;objectiu d&#8217;aquest post és mostrar el potencial d&#8217;aquesta combinació, una solució més econòmica que el gran tot poderos Splunk.</p>
<p>Comencem amb els logs de Akmaai, aquí us paso el format de log que volem analitzar, extret de la documentació oficial:</p>
<p><a href="https://marc.cortinasval.cat/blog/wp-content/uploads/2014/03/waf_logformat.png"><img src="https://marc.cortinasval.cat/blog/wp-content/uploads/2014/03/waf_logformat.png" alt="waf_logformat" width="1354" height="288" class="alignleft size-full wp-image-431"/></a></p>
<p><a href="https://marc.cortinasval.cat/blog/wp-content/uploads/2014/03/apache_logformat.png"><img src="https://marc.cortinasval.cat/blog/wp-content/uploads/2014/03/apache_logformat.png" alt="apache_logformat" width="1164" height="578" class="alignleft size-full wp-image-430"/></a></p>
<p>El filtre de logstash que he implementat és :</p>
<pre class="brush: plain; title: ; notranslate" title="">
filter {
    grok {
      type =&gt; &quot;esw3c_waf&quot;
      match =&gt; { &quot;message&quot; =&gt; &quot;%{IPORHOST:clientip} %{USER:ident} %{USER:auth} \[%{HTTPDATE:timestamp}\] (?:%{WORD:verb} %{NOTSPACE:request}(?: HTTP/%{NUMBER:httpversion})?|%{DATA:rawrequest}) %{NUMBER:response} (?:%{NUMBER:bytes}|-) %{QS:referrer} %{QS:agent} %{QS:cookies} \&quot;%{WORD:WafPolicy}\|%{DATA:WafAlertRules}\|%{DATA:WafDenyRules}\&quot;&quot; }
    }

    date {
      type =&gt; &quot;esw3c_waf&quot;
      match =&gt; [ &quot;timestamp&quot;, &quot;dd/MMM/yyyy:HH:mm:ss Z&quot; ]
      locale =&gt; &quot;en&quot;
    }

}
</pre>
<p>Pel que fa als logs de AWS Cloudfront, el format del log esta documentat en aquest <a href="http://docs.aws.amazon.com/AmazonCloudFront/latest/DeveloperGuide/AccessLogs.html#BasicDistributionFileFormat" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','http://docs.aws.amazon.com']);" title="http://docs.aws.amazon.com/AmazonCloudFront/latest/DeveloperGuide/AccessLogs.html#BasicDistributionFileFormat" target="_blank"></a>, però basicament és:</p>
<pre class="brush: plain; title: ; notranslate" title="">
#Fields: date time x-edge-location sc-bytes c-ip cs-method cs(Host) cs-uri-stem sc-status cs(Referer) cs(User-Agent) cs-uri-query cs(Cookie) x-edge-result-type x-edge-request-id x-host-header cs-protocol cs-bytes 
07/01/2012 01:13:11 FRA2 182 192.0.2.10 GET d111111abcdef8.cloudfront.net /view/my/file.html 200 www.displaymyfiles.com Mozilla/4.0%20(compatible;%20MSIE%205.0b1;%20Mac_PowerPC) - zip=98101 RefreshHit MRVMF7KydIvxMWfJIglgwHQwZsbG2IhRJ07sn9AkKUFSHS9EXAMPLE== d111111abcdef8.cloudfront.net http -
</pre>
<p>A més, logstash té implementat un input contra S3, ideal per a aquest cas.<br/>
Per la part del filtre, l&#8217;expressió és la seguent: </p>
<pre class="brush: plain; title: ; notranslate" title="">
filter {
    grok {
    type =&gt; &quot;aws&quot;
    pattern =&gt; &quot;%{DATE_EU:date}\t%{TIME:time}\t%{WORD:x-edge-location}\t(?:%{NUMBER:sc-bytes}|-)\t%{IPORHOST:c-ip}\t%{WORD:cs-method}\t%{HOSTNAME:cs-host}\t%{NOTSPACE:cs-uri-stem}\t%{NUMBER:sc-status}\t%{GREEDYDATA:referrer}\t%{GREEDYDATA:User-Agent}\t%{GREEDYDATA:cs-uri-stem}\t%{GREEDYDATA:cookies}\t%{WORD:x-edge-result-type}\t%{NOTSPACE:x-edge-request-id}\t%{HOSTNAME:x-host-header}\t%{URIPROTO:cs-protocol}\t%{INT:cs-bytes}&quot;
}
mutate {
    type =&gt; &quot;aws&quot;
        add_field =&gt; [ &quot;listener_timestamp&quot;, &quot;%{date} %{time}&quot; ]
    }
date {
      type =&gt; &quot;aws&quot;
      match =&gt; [ &quot;listener_timestamp&quot;, &quot;yy-MM-dd HH:mm:ss&quot; ]
    }
}
</pre>
<p>Per cert, recomenar-vos activar el <a href="http://docs.aws.amazon.com/AmazonS3/latest/dev/object-lifecycle-mgmt.html" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','http://docs.aws.amazon.com']);" title="Object Lifecycle" target="_blank">LifeCycle</a> en el Bucket de S3 per a configurar un purgat de logs, creix ràpid (evidentment, el creixement també depen del vostre tràfic).</p>
<p>Un cop definit com farem la importació passem a comentar on guardarem les dades, ho farem en el <a href="http://www.elasticsearch.org/overview/elasticsearch/" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','http://www.elasticsearch.org']);" title="Elasticsearch" target="_blank">Elasticsearch 1.0</a> aprofitant que ha sortit recentment. Vull destarcar 2 pluguins que als sysadmins els agradara conèixer, el pluguin <a href="http://www.elasticsearch.org/guide/en/elasticsearch/reference/current/modules-plugins.html" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','http://www.elasticsearch.org']);">HEAD</a> i <a href="http://www.elasticsearch.org/overview/marvel/" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','http://www.elasticsearch.org']);" title="Marvel" target="_blank">MARVEL</a>.</p>
<p>Captura de pantalla del pluguin HEAD, on hem fet un index per dia/cdn<br/>
<a href="https://marc.cortinasval.cat/blog/wp-content/uploads/2014/03/ElasticHead.png"><img src="https://marc.cortinasval.cat/blog/wp-content/uploads/2014/03/ElasticHead.png" alt="ElasticHead" width="2498" height="1250" class="alignleft size-full wp-image-445"/></a></p>
<p>Captura de pantalla del pluguin MARVEL<br/>
<a href="https://marc.cortinasval.cat/blog/wp-content/uploads/2014/03/Marvel.png"><img src="https://marc.cortinasval.cat/blog/wp-content/uploads/2014/03/Marvel.png" alt="Marvel" width="2372" height="1464" class="alignleft size-full wp-image-446"/></a></p>
<p>Abans de pasar a la part de pintar les dades, us paso dos links amb les GROKS disponibles i una eina per a contruir-les<br/>
&#8211; <a href="https://github.com/logstash/logstash/tree/v1.3.3/patterns." onclick="javascript:_gaq.push(['_trackEvent','outbound-article','http://github.com']);" title="Llista de patrons GROK disponibles " target="_blank">Llista de patrons GROK disponibles</a><br/>
&#8211; <a href="http://grokdebug.herokuapp.com" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','http://grokdebug.herokuapp.com']);" title="Eina per construir les configuracions" target="_blank">Eina per construir les configuracions</a></p>
<p>Per acabar, per a pintar totes aquestes dades utilitzarem la aplicació de <a href="http://www.elasticsearch.org/overview/kibana/" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','http://www.elasticsearch.org']);" title="Kibana" target="_blank">Kibana</a>, una aplicació javascript que utilitza les dades del elaticsearch per a poder crear informes, gràfiques i filtres acurats.</p>
<p>Per començar he fet 2 dashboards molt simples, per una banda el de WAF de Akamai i per una altra el de Cloudfront.</p>
<p>Dashboard de Cloudfront:<br/>
<a href="https://marc.cortinasval.cat/blog/wp-content/uploads/2014/03/CloudfrontDashboard.png"><img src="https://marc.cortinasval.cat/blog/wp-content/uploads/2014/03/CloudfrontDashboard.png" alt="CloudfrontDashboard" width="2498" height="1200" class="alignleft size-full wp-image-448"/></a></p>
<p>Dashboard de Akamai:<br/>
<a href="https://marc.cortinasval.cat/blog/wp-content/uploads/2014/03/AkamaiDashboard.png"><img src="https://marc.cortinasval.cat/blog/wp-content/uploads/2014/03/AkamaiDashboard.png" alt="AkamaiDashboard" width="2554" height="1600" class="alignleft size-full wp-image-450"/></a></p>
<div class="post-meta clearfix post-meta-list">
<p class="author-date">
<span class="glyphicon glyphicon-user"></span> mcortinas
<span class="glyphicon glyphicon-calendar"></span> Març 5, 2014
</p>
<p class="post-tags"><span class="glyphicon glyphicon-tags"></span><a href="https://marc.cortinasval.cat/blog/tag/akamai/">akamai</a> <span class="slash"> / </span><a href="https://marc.cortinasval.cat/blog/tag/amazon/">amazon</a> <span class="slash"> / </span><a href="https://marc.cortinasval.cat/blog/tag/aws/">aws</a> <span class="slash"> / </span><a href="https://marc.cortinasval.cat/blog/tag/cloudfront/">cloudfront</a> <span class="slash"> / </span><a href="https://marc.cortinasval.cat/blog/tag/elasticserch/">elasticserch</a> <span class="slash"> / </span><a href="https://marc.cortinasval.cat/blog/tag/kibana/">kibana</a> <span class="slash"> / </span><a href="https://marc.cortinasval.cat/blog/tag/logstasgh/">logstasgh</a> <span class="slash"> / </span><a href="https://marc.cortinasval.cat/blog/tag/waf/">waf</a> <span class="slash"> / </span></p>
</div>
</article>
<hr class="post-divider"><article id="post-84" class="post-84 post type-post status-publish format-standard hentry category-sysadmin category-tecno tag-cache tag-http tag-varnish tag-web">
<h3 class="post-title"><a href="https://marc.cortinasval.cat/blog/2013/12/17/varnish-cache-un-molt-bon-aliat-per-a-la-web/" rel="bookmark">varnish-cache, un molt bon aliat per a la web</a></h3><p>Ja fa un parell d&#8217;anys que faig servir el varnish cache i és un molt bon aliat de qualsevol plataforma web per descarregar als servidors http (apache, nginx, lighthttpd, etc&#8230; ) i al backend, ja sigui per aplicacions amb poc tràfic com per aplicacions/plataformes d&#8217;alt rendiment, on pot ser un CLAU aliat. </p>
<p>Per això, en aquest post enumenarem les raons principals d&#8217;implantar el varnish, citarem els processos i posarem 4 exemples de configuracions amb diferents proposits.</p>
<p>Bueno, començaré enumerant les 3 funcionalitats principals:<br/>
&#8211; Accelerador de continguts web, minimitzant considerablement els temps mitjans de resposta dels continguts dinamics d&#8217;un site.<br/>
&#8211; Alliberar de càrrega el backend, des dels servidors web i sobretot a les bases de dades, sql i nosql.<br/>
&#8211; Permetre servir continguts &#8220;caducats&#8221; en cas que la plataforma tingui problemes de rendiment.</p>
<p>Altres funcionalitats més avançades que podem fer amb Varnish es,<br/>
&#8211; Si treballeu amb CDNs pot fer el paper d&#8217;amortidor en moments de canvis bruscos de tràfic, per exemple, un campanya amb molt èxit, una noticia important, etc&#8230;<br/>
&#8211; Securitzar el website, per segons quines parts de la web podem exigir que les peticions haguin de complir uns determinats requeriments. Això també ho pot fer el apache, però aixi el podem alliberar d&#8217;aquestes tasques.<br/>
&#8211; En plataformes d&#8217;alt rendiment, si treballeu amb CDNs, per bloquejar l&#8217;accés a determinades parts de les webs que no es puguin processar per averia en el sistema.</p>
<p>Segur que podeu trobar altres funcionalitats, aquestes són les que he utilitzat.</p>
<p>La filosofia del Varnish es emmagatzemar a memòria volàtil tots els cantinguts &#8220;cachejables&#8221; i estalviar de cicles de proces i cicles d&#8217;espera d&#8217;entrada i sortida, es a dir, l&#8217;equiliri IO-CPU-RAM es veurà afectat així: disminuim IO, disminuim us de CPU, increment ús de memoria, on és molt important dimensionar bé la memòria que utilitzarem.</p>
<p>Un dels principals inconvenients dels Varnish és el HTTPS, encara que té el sentit. Varnish és un accelerador de continguts HTTP que vol disminuir el temps de resposta, el httpS és el contrari, requereix de temps de proces per a tal d&#8217;assegurar la seguretat. Conclusió, Varnish no es capaç i no ho serà mai de servir contignut per HTTPS. Només el podrem fer servir per aquelles parts del website que no siguin segures. <a href=http://marc.cortinasval.cat/blog/2013/12/01/balancejador-https-economic-nginxhaproxypacemaker/>També ho podeu utilitzar en parts de la web segures si poseu un nginx per davant, en aquest altre post teniu explicat millor aquesta solució.</a></p>
<p>D&#8217;altra banda, la corba d&#8217;aprenentatge del varnish es considerable, de fet, un graph em va ajudar a entendre totes les transicions possibles, es a dir, és el tipic aliat que si el compliquem molt es pot tornar en enemic. <a href=https://www.varnish-software.com/static/book/Tuning.html>De fet, el varnish són 2 procesos un pare i un fill (fork), on el pare fa el paper de gestió i compila les configuracion escrites amb llenguatge VCL i el fill és qui realment fa realment les funcions descrites en la configuracio VCL. En aquest link ho explica detalladament.</a></p>
<p><a href=https://www.varnish-cache.org/docs/3.0/tutorial/vcl.html#>Es a dir, la clau del varnish, és escriure un VCL amb allò que realment necessitem que faci. Aqui us deixo un graph que vaig decidir fer un cop vaig llegir la documentació oficial del varnish d&#8217;aquest link.</a><br/>
<a href="https://marc.cortinasval.cat/blog/wp-content/uploads/2013/12/Varnish_subroutines_Graph.png"><img src="https://marc.cortinasval.cat/blog/wp-content/uploads/2013/12/Varnish_subroutines_Graph.png" alt="Varnish_subroutines_Graph" width="1302" height="768" class="aligncenter size-full wp-image-347"/></a></p>
<p>Seguidament posarem 3 exemples de fitxers basics de VCL i comentarem la seva finalitat:</p>
<p><strong>Exemple 1</strong></p>
<pre class="brush: plain; title: ; notranslate" title="">
backend default {
  .host = &quot;127.0.0.1&quot;;
  .port = &quot;8080&quot;;
  .max_connections = 40;
  .first_byte_timeout = 180s;
  .between_bytes_timeout = 180s;
}

sub vcl_recv {
      return(pass);
}
</pre>
<p>Aquesta configuració l&#8217;únic que voliem és limitar la quantitat de connexions(max_connections) que li passarem al un apache en local, en aquest cap no cachejem res.</p>
<p><strong>Exemple 2</strong></p>
<pre class="brush: plain; title: ; notranslate" title="">
backend default {
  .host = &quot;127.0.0.1&quot;;
  .port = &quot;8080&quot;;
  .max_connections = 200;
  .connect_timeout = 180s;
  .first_byte_timeout = 180s;
  .between_bytes_timeout = 180s;
  .probe = {
    .url = &quot;/healthcheck.php&quot;;
    .timeout = 100 ms;
    .interval = 1s;
    .window = 10;
    .threshold = 8;
  }
}

sub vcl_recv {
  if (req.http.Host == &quot;setup.domain.com&quot;)
  {
    set req.grace = 30s;
    return(lookup);
  }
  else
  {
   return(pass);
  }
}

sub vcl_fetch {
  set beresp.grace = 1h;
}
</pre>
<p>En aquest exemple només cachejem les peticions del domini &#8220;setup.domain.com&#8221;, domini intern de la plataforma que serveix les configuracions de l&#8217;aplicació. Ademés, volem que si el backend no respon, seguiran sen vàlids durant 1 hora. Això ho conseguim en les tres últimes linies de codi. <a href=http://www.tomas.cat/blog/ca/configuració-bàsica-de-varnish-amb-http-cache-i-stale-while>El meu company Tomas té un article on exemplifica molt bé aquest comportament. Una de les coses més interessants del article de Tomàs es diferenciar les dues situacions en les que aquest parametre es important.</a><br/>
- No hi ha cap backend disponible, per tant servim contingut antic.<br/>
- Hi ha backends disponibles, i un fil ja ha demanat nou contingut. Mentre aquest nou contingut arriba des del backend, el varnish continua servint l&#8217;antic a la resta de fils.</p>
<p><strong>Exemple 3</strong></p>
<pre class="brush: plain; title: ; notranslate" title="">
sub vcl_recv {
…
        if (req.url ~ &quot;.*remindmethepassword.*&quot; &amp;&amp; !req.http.User-Agent) {
            error 403 &quot;Forbidden&quot;;
        }
…
        return(pass);
}
</pre>
<p>En el exemple anterior, podem aferir-hi regles que augmentent la seguretat, per exemple, en les peticions que tinguin remindmethepassword en la URL necessitaran tenir el User-Agent, sino retornem un 403.</p>
<p><strong>Exemple 4</strong></p>
<pre class="brush: plain; title: ; notranslate" title="">
backend default {
  .host = &quot;127.0.0.1&quot;;
  .port = &quot;8080&quot;;
  .max_connections = 200;
  .connect_timeout = 180s;
  .first_byte_timeout = 180s;
  .between_bytes_timeout = 180s;
  .probe = {
    .url = &quot;/healthcheck.php&quot;;
    .timeout = 10 ms;
    .interval = 5s;
    .window = 5;
    .threshold = 3;
  }
}

sub vcl_error {
}

sub vcl_recv {
     if (req.restarts == 0) {
       if (req.http.x-forwarded-for) {
           set req.http.X-Forwarded-For =
               req.http.X-Forwarded-For + &quot;, &quot; + client.ip;
       } else {
           set req.http.X-Forwarded-For = client.ip;
       }
     }
     if (req.request != &quot;GET&quot; &amp;&amp;
       req.request != &quot;HEAD&quot; &amp;&amp;
       req.request != &quot;PUT&quot; &amp;&amp;
       req.request != &quot;POST&quot; &amp;&amp;
       req.request != &quot;TRACE&quot; &amp;&amp;
       req.request != &quot;OPTIONS&quot; &amp;&amp;
       req.request != &quot;DELETE&quot;) {
         /* Non-RFC2616 or CONNECT which is weird. */
         return (pipe);
     }
     if (req.request != &quot;GET&quot; &amp;&amp; req.request != &quot;HEAD&quot; &amp;&amp; req.request != &quot;POST&quot; ) {
         /* We only deal with GET and HEAD by default */
         return (pass);
     }
   set req.grace = 30s;
    return(lookup);
}

sub vcl_fetch {
     if (beresp.ttl &lt;= 0s ||
         beresp.http.Vary == &quot;*&quot;) {
               return (hit_for_pass);
     }
 if(beresp.ttl &gt; 0s){  unset beresp.http.Set-Cookie;}

  set beresp.grace = 1h;
  return(deliver);
}
</pre>
<p>En aquest exemple ja comença a ser més complert:<br/>
&#8211; limitat a 200 connexions, a més peticions, retornem 503.<br/>
&#8211; accepted petitions GET, HEAD, PUT, POST, TRACE, OPTIONS, DELETE.<br/>
&#8211; cachejem GET, POST, HEAD segons les capceleres HTTP que emet el backend<br/>
&#8211; en el moment en que anem a buscar un objecte en la cache, eliminem les capçeleres Set-Cookie<br/>
&#8211; tindrem 1 hora els elements en la cache, en cas que el backend estigui caigut o no respongui</p>
<p>Finalment, el ideal seria tenir ben segmentada la plana web amb les diferents seccions i tenir identificades les url&#8217;s de cadascuna d&#8217;elles facilitant així:<br/>
&#8211; La propia aplicació generi les capçeleres HTTP adecuades especificant quant de temps serà vàlid el contingut, segons quines seccións o accions tindrem uns temps de caducitat diferents<br/>
&#8211; La propia aplicació permite caducar/invalidar el contingut en el varnish en les situacions que ho necessitin.<br/>
&#8211; Securitzar les parts de la web que ho requereixin jugant amb les capçeleres</p>
<div class="post-meta clearfix post-meta-list">
<p class="author-date">
<span class="glyphicon glyphicon-user"></span> mcortinas
<span class="glyphicon glyphicon-calendar"></span> Desembre 17, 2013
</p>
<p class="post-tags"><span class="glyphicon glyphicon-tags"></span><a href="https://marc.cortinasval.cat/blog/tag/cache/">cache</a> <span class="slash"> / </span><a href="https://marc.cortinasval.cat/blog/tag/http/">http</a> <span class="slash"> / </span><a href="https://marc.cortinasval.cat/blog/tag/varnish/">varnish</a> <span class="slash"> / </span><a href="https://marc.cortinasval.cat/blog/tag/web/">web</a> <span class="slash"> / </span></p>
</div>
</article>
<hr class="post-divider"><article id="post-373" class="post-373 post type-post status-publish format-standard hentry category-varis tag-catalunya tag-historia">
<h3 class="post-title"><a href="https://marc.cortinasval.cat/blog/2013/12/15/breu-resum-de-la-nostra-historia/" rel="bookmark">breu resum de la nostra història</a></h3><p>la &#8220;Història de Catalunya&#8221; ha estat un breu, molt breu llibre que el meu avi em va recomenar llegir, un llibre d&#8217;escola de l&#8217;any 1933 que recopila molts dels més importants esdeveniments de la història de la nostra terra, Catalunya. </p>
<p><a href="https://marc.cortinasval.cat/blog/wp-content/uploads/2013/12/la-foto.jpg"><img class="alignleft  wp-image-382" alt="la foto" src="https://marc.cortinasval.cat/blog/wp-content/uploads/2013/12/la-foto.jpg" width="734" height="979"/></a></p>
<p>Degut a la meva mala memòria i aprofitant la gran sintesi realitzada en aquest llibre, m&#8217;he vist obligat de fer la seguent taula per tal de reordenar-me tots els esdeveniments, la qual cosa m&#8217;ha agradat.</p>
<div class="table-responsive"><table style="width:100%; " class="easy-table easy-table-default " border="0">
<thead>
<tr><th>Epoca</th>
<th>Títol Capítol</th>
<th> Resum d'Esdeveniment</th>
<th>Personatges Importants</th>
<th> Recursos literaris</th>
</tr>
</thead>
<tbody>
<tr><td>-</td>
<td>Caçadors i Artistes</td>
<td> Celtes i Ibers viuen de la caça i primeres pintures rupestres</td>
<td>-</td>
<td>-</td>
</tr>
<tr><td>-</td>
<td>Caçadors i Artistes</td>
<td> Primers pagesos i comerciants</td>
<td>-</td>
<td>-</td>
</tr>
<tr><td>500 ac</td>
<td>Els grecs a Catalunya</td>
<td> Grecs s'assenten a Empuries (emporion és mercat en grec)</td>
<td>-</td>
<td>-</td>
</tr>
<tr><td>200 ac</td>
<td>Indíbil i Mandoni</td>
<td> Ibers lluiten contra els cartaginesos i romans sense èxit. Romans ens ensenyen arquitectura i el llatí. Sorgeix el primer ús del Català fruit de la mescla del llatí importat pels romans i les llengues autòctones.</td>
<td>Indíbil i Mandoni</td>
<td>-</td>
</tr>
<tr><td>100 ac</td>
<td>La predicación del cristianismo</td>
<td> Primers predicadors del cristianisme. La fe del poble guanyen als romans. </td>
<td> Sant Pau Sant Feliu Sant Cugat</td>
<td>-</td>
</tr>
<tr><td>600 dc</td>
<td> La revolta de Paulus</td>
<td> poble germanic (visigots) invaeix la peninsula destronant als romans. Toledo és la capital.Sorgeix una revolta del poble on Paulus es coronat rei de Narbona (prop del Roselló). Finalemnt els visigots destronen a Paulus </td>
<td> Paulus Ranosind Hilderic</td>
<td>-</td>
</tr>
<tr><td>800 dc</td>
<td>Sarrains i Francs</td>
<td> Els sarrains provinents del nord d'Africa i Àrabia s'apoderen de tota la peninsula (exceptuant els Pirineus). Els francs entren pels pirineus i arribaran a invair Girona i Vic. Arribaran a Barcelona on faran un setge i guanyaran a Zaid</td>
<td> Lluís el Piadós (fill de Carlemany) i Zaid</td>
<td>-</td>
</tr>
<tr><td>-</td>
<td>Lluita contra els francs</td>
<td> Guifré amb l'ajut de patriotes catalans van vencer al compte franc Salomó recuperant les terres.(Urgell Cerdanya Girona Besalú Barcelon)</td>
<td>Salomó de Cerdanya i Guifré el Pilós</td>
<td><a href=http://ca.wikipedia.org/wiki/Gesta_Comitum_Barchinonensium>Gesta Comitum Barchinonensium</a></td>
</tr>
<tr><td>-</td>
<td>La légenda de les quatre barres</td>
<td>Guifré ajuda a l'emperador frances Carles el Calb a lluitar contra els normands on cau ferit. Carles es qui pinta sobre l'escut de Guifré les 4 barres amb la sang del ferit. Neix la nostra bandera </td>
<td>Guifré el Pilós Carles el Calb</td>
<td>-</td>
</tr>
<tr><td>-</td>
<td>Lluita amb els sarraïns</td>
<td>Guifré consegueix guanyar territori als sarraïns posant-hi monestirs.(Ripolles-Plana de Vic-Monstserrat). Gruifre mor a Lleida lluitant contra els sarraïns i es enterrat a Ripoll</td>
<td>Guifré el Pilós</td>
<td>-</td>
</tr>
<tr><td>900 dc</td>
<td>L'abat que amava els pelegrinatges</td>
<td>L'abat Guarí va viatjar per moltes terres (França-Italia-Terra Sant). El duc Venecia Pere Urseol li obre el seucor de bat a bat. Duc Venecia emigra de Venecia amb Guari en silenci.</td>
<td>Guarí abat de Sant Miquel de Cuixà &#8211; Pere Urseol (duc de Venecia)</td>
<td>-</td>
</tr>
<tr><td>1000 dc</td>
<td>L'abat que amava les ciències</td>
<td> L'abat Oliva consegueix arreplegar al monestir de Ripoll els homes més savis</td>
<td>Oliva abat de Ripoll</td>
<td>-</td>
</tr>
<tr><td>-</td>
<td>Catalunya i Provença</td>
<td> S'uneixen els territoris de Provença i Catalunya amb el matrimoni del compte i Dolça. Després els francs dels "Anjou" ens arrebatarien Provença</td>
<td>Ramon Berenguer i la princesa Dolça</td>
<td>-</td>
</tr>
<tr><td>1100 dc</td>
<td>Catalunya i Aragó</td>
<td> El rei Ramir II d'Aragó va casar la seva filla Peronella amb el compte de Barcelona. Ramon va recuperar Lleida i Tortosa als sarrains. L'hereu va ser el fill de Ramon (Alfons el Cast). </td>
<td>Ramon Berenguer IV &#8211; Peronella d'Arago &#8211; Ramir II &#8211; Alfons I el Cast</td>
<td>-</td>
</tr>
<tr><td>1200 dc</td>
<td>La batalla de Muret</td>
<td> Alfons I conquereix Provença i el Llenguadoc. Pere el Catolic (fill d'Alfons I) es qui defendra les terres del llenguadoc(Tolosa-Foix-Comenge-Carcassona-Beziers) del compte franc Simo de Montfort qui amb un pretext religios en deien Croades. Pere mor en els camps de Muret(prop de Tolosa)</td>
<td> Pere el Catolic-Simo de Montfort</td>
<td>-</td>
</tr>
<tr><td>-</td>
<td>La infantesa de Jaume I</td>
<td> El fill del Pere es Jaume I. La mare de Jaume I mor a Roma al visitar el papa Innocent III(subdit de Simo de Montfort). El catalans reclamen a Jaume I al papa Innocent III qui el lliure i esdevingue rei amb 5 anys. Va creixer en el castell de Montço. Als 13 anys es casa amb Elionor de Castella. Els primers combats van ser contra nobles com Pere d'Ahonés.</td>
<td>Jaume I Innocent III Elionor de Castella Pere d'ahonés</td>
<td><a href="http://ca.wikipedia.org/wiki/Llibre_dels_fets" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','http://ca.wikipedia.org']);">Llibre dels fets</a></td>
</tr>
<tr><td>-</td>
<td>La conquesta de Mallorca</td>
<td> Jaume va conquerir Penyiscola i Terol als sarraïns. Als 20 va conquerir Mallorca</td>
<td>Jaume I</td>
<td>-</td>
</tr>
<tr><td>-</td>
<td>El rei Jaume I i l'oreneta</td>
<td>Jaume I cami de Valencia salva la vida a les orenetes que havien posat el niu a sobre la seva tenda. Aquest va ser un acte de grandesa i generositat en mig de camps de batalla</td>
<td>Jaume I</td>
<td>-</td>
</tr>
<tr><td>-</td>
<td>El setge de València</td>
<td>Jaume va interceptar els ajuts del rei de Tunis va enviar als sarrains de Valencia. Jaume fos ferit per un ballester sarrai. El casc li salva la vida. </td>
<td>Jaume I </td>
<td>-</td>
</tr>
<tr><td>-</td>
<td>La conquesta de València</td>
<td> Jaume I conquereix Valencia i besa la terra valenciana en acte simbolic. Neix el catala a les terres valencianes</td>
<td>Jaume I</td>
<td>-</td>
</tr>
<tr><td>-</td>
<td>L'alliberació de Sicília</td>
<td> Els sicilians patien els excessos dels soldats francs dels Anjou. Constança de Sicilia es casa amb el fill de Jaume I. Pere II allibera Sicilia dels francs.</td>
<td>Pere II el Gran. Constança de Sicilia. Carles d'Anjou</td>
<td>-</td>
</tr>
<tr><td>-</td>
<td>El desafiament de Pere el Gran amb Carles d'Anjou</td>
<td> Carles d'Anjou i Pere el Gran es desafien en un combat a Bordeus. Pere el Gran amb 4 caballers van a contrarellotge des de Navarra a Burdeos d'amagatotis. El senescal de Burdeos no pot garantir la seguretat a Pere. Un notari certifica la seva presencia </td>
<td> Pere el Gran i Carles d'Anjou</td>
<td>-</td>
</tr>
<tr><td>-</td>
<td>Una resposta de Pere el Gran</td>
<td> el papa Marti IV(amic de Carles d'Anjou) proclama una Croada com si Pere fos un rei moro(enemic del cristianisme). Pere els barra el pas en el Coll de Panissars. Despres de varies negociacions els deixen passar pero son vençuts vora els murs de Girona</td>
<td>Pere el Gran. papa Marti IV. Ferran III rei de França</td>
<td>-</td>
</tr>
<tr><td>1200 dc</td>
<td>El gran Almirall</td>
<td> Roger de Lluria va ser gran almirall que va vençer amb 12 galeres les 20 galeres franceses de Carles d'Anjou. Va fer presoner Carles de Salern(fill de Carles d'Anjou).</td>
<td>Roger de Lluria(almirall de Pere el Gran)</td>
<td><a href="http://ca.wikipedia.org/wiki/Llibre_del_Consolat_de_Mar" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','http://ca.wikipedia.org']);">Llibre del consolat de la mar.</a></td>
</tr>
<tr><td>1300 dc</td>
<td>Ramon Llull</td>
<td>Home de ciencies. Promulgava als moros i jueus el cristianisme. Neix a Barcelona i recorres molts territoris. (Bolonya Paris Montpellier Genova Napols Xipre Rodes Malta Bugia Tunis..). Mort a Mallorca.</td>
<td>Ramon Llull</td>
<td>-</td>
</tr>
<tr><td>-</td>
<td>Els Catalans a Orient</td>
<td> Roger de Flor ers un gran capitost que un cop signada la pau de Sicilia amb els francs va anar a ajudar Constantinoble dels turcs. En deien els almogabers. Magnats grecs maten a traició els almogabers en un banquet. Les restes de la companyia van ferse forts a Gal·lípoli. La majoria de dones dels almogabers morts defenen la ciutat dels atacs genovesos amb Ramon Muntaner al capdavant aconseguint pararlos. Després aconsegueixen conquerir Atenes i Neopàtria. </td>
<td>Roger de Flor. Ramon Muntaner</td>
<td><a href="http://ca.wikipedia.org/wiki/Crònica_de_Ramon_Muntaner" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','http://ca.wikipedia.org']);">Cronica de Ramon Muntaner</a></td>
</tr>
<tr><td>-</td>
<td>La bandera Invencible</td>
<td> Jaume II i despres el seu fill Alfons reinen a Serdenya. Avui encara tenim l'Alguer on es parla català</td>
<td>Jaume II i el seu fill Alfons</td>
<td>-</td>
</tr>
<tr><td>-</td>
<td>La reina de Pedralbes</td>
<td> Elisenda va viure en el monestir de Pedralbes on va repartir la seva riquesa i generositat amb els poble català</td>
<td>Elisenda de Montcada(muller de Jaume II)</td>
<td>-</td>
</tr>
<tr><td>-</td>
<td>El nostre poble és lliure&#8230;</td>
<td> El rei Alfons II es assessorat pels seus consellers i escolta al seu poble a diferencia de les corts castellanes </td>
<td>Alfons el Benigne(fill de Jaume II)</td>
<td>-</td>
</tr>
<tr><td>-</td>
<td>Terra Beneïda</td>
<td> Pere beneix les terres de Praga al tornar de Saragossa arribant a Catalunya</td>
<td>Pere el Cerimoniós(fill de Alfons el Benigne)</td>
<td>-</td>
</tr>
<tr><td>1300 dc</td>
<td>L'amador de la gentilesa</td>
<td>Va viure a Barcelona on va omplir la cort de gentilesa. Va voler omplir la cort de d'art.</td>
<td>Joan I(fill de Pere el Cerimonios)</td>
<td>-</td>
</tr>
<tr><td>1400 dc</td>
<td>Coses glorioses son dites de tu Catalunya</td>
<td>Martí va aplegar les Corts Catalanes a Perpinya. Va ajudar a molts pobles veins. Va morir a Sardenya. Marti el jove va ser el seu unic fill que va morir de petit. Martí l'Huma va ser el ultim descendent directe de Guifré el Pilos </td>
<td> Marti l'Humà(fill de Joan I)</td>
<td>-</td>
</tr>
<tr><td>-</td>
<td>Jaume el dissortat</td>
<td> La corona pertocava a Jaume d'Urgell. Tenia molts enemics. La corona havia de ser estriada per 9 compromisaris que van estriar un rei castellà Ferran d'Antequera en comptes de Jaume. Jaume va ser emmenat a Xàtiva. </td>
<td>Jaume d'Urgell. Ferran d'Antequera</td>
<td>-</td>
</tr>
<tr><td>-</td>
<td>Fiveller</td>
<td> Conseller Barceloni va discrepar la autoritat de Ferran defensant un impost pel poble català on Ferran va cedir. Sort vem tindre que Ferran va morir pel còlera a Igualada. </td>
<td>Ferran d'Antequera. Joan Fiveller</td>
<td>-</td>
</tr>
<tr><td>-</td>
<td>La conquesta de Nàpols</td>
<td>Alfons IV va conquerir Napols on s'hi va quedar per a viure a pesar que la seva dona el reclamés.</td>
<td>Alfons IV(fill de Ferran)</td>
<td>-</td>
</tr>
<tr><td>-</td>
<td>El príncep de Viana</td>
<td>Joan II es casa amb la reina Blanca de Navarra i tenen el seu fill Carles. Joan II es casa despres amb Joana Enriquez i te el seu segon fill Ferran despres de la mort de Blanca. Joan II demanar empressonar el seu fill Carles. El poble catala es rebela apojant a Carles i Joan recapassita. Carles torna a Barcelona com a princep de Viana on mort al poc temps. </td>
<td>Joan II(fill de Alfons IV)</td>
<td>-</td>
</tr>
<tr><td>1400 dc</td>
<td>El gran descobridor a Barcelona</td>
<td>Cristòfor Colom descobreix el nou món ajudat per galeres de la corona castella. Després del descobriment va a Barcelona a lliurar les terres a la corona. Alguns historiadors diuen que Cristòfor era català i no genovés. </td>
<td>Cristòfor Colom. Ferran(fill de Joan II)</td>
<td>-</td>
</tr>
<tr><td>1600 dc</td>
<td>Pau Clarís</td>
<td> Pau Clarís va ser qui va afrontar les lleis del rei castella Felip IV que volia pendre llibertats al poble catala. A mes dels excessos dels soldats de la corona d'Espanya feien sobre els catalans. Finalment els segadors catalans s'alçaren a les armes el dia de Corpus rebutjant la soldadescat i alliberant diputats i consellers. El compte d'Olivares va ser vençut en la batalla de Montjuic. Tot dirigit per canonge Pau Clarís. </td>
<td>Pau Clarís</td>
<td>-</td>
</tr>
<tr><td>1700 dc</td>
<td>L'11 de setembre de 1714</td>
<td>Carles II mor sense descendencia. Felip V el borbo reclama el tro pero els catalans prefereixen l'arxiduc Carles d'Austria. Carles renuncia a les pretencions i abandona al poble català qui es defendra del castellans i francesos en el setge de Barcelona al 1714. Finalment en Rafael Casanova es vençut en el baluard de Santa Clara. Felip V suprimirà les llibertats catalnes. </td>
<td>Felip V. Rafael Casanova. Ballester. Bach de Roda. </td>
<td><a href="http://ca.wikipedia.org/wiki/Victus" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','http://ca.wikipedia.org']);">Victus</a></td>
</tr>
<tr><td>1900 dc</td>
<td>Catalunya Immortal</td>
<td> Catalunya perd tots els icones de la seva identitat. Però més tart tot tornarà a nèixer no només a Catlunya sinò en totes les terres de parla catalana. Tindrem molts homes que contribuiran en aquest renaixement als diferents indrets de parla catalana. </td>
<td> Mossent Jacint Verdaguer. Angel Guimerà. Joan Maragall. Mossèn Costa i Llobera. Joan Alcover. Teodor Llorente. Enric Prat de la Riba</td>
<td> <a href="http://ca.wikipedia.org/wiki/La_nacionalitat_catalana" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','http://ca.wikipedia.org']);">La nacionalitat catalana.</a></td>
</tr>
</tbody></table></div>
<p>Finalment us deixo aquests enllaços interessants:</p>
<p><a href="http://ca.wikipedia.org/wiki/Cronologia_de_la_Història_de_Catalunya" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','http://ca.wikipedia.org']);">Com sempre, aquí teniu la viquipèdia que on podràs trobar més informació amb més detall. </a></p>
<p><a href="http://www.liveleak.com/view?i=14d_1348362692#391DmO3VqJ4om3Fg.01" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','http://www.liveleak.com']);">Video Mapa Politic Europeu des del 1000ac fins ara. </a></p>
<div class="post-meta clearfix post-meta-list">
<p class="author-date">
<span class="glyphicon glyphicon-user"></span> mcortinas
<span class="glyphicon glyphicon-calendar"></span> Desembre 15, 2013
</p>
<p class="post-tags"><span class="glyphicon glyphicon-tags"></span><a href="https://marc.cortinasval.cat/blog/tag/catalunya/">catalunya</a> <span class="slash"> / </span><a href="https://marc.cortinasval.cat/blog/tag/historia/">historia</a> <span class="slash"> / </span></p>
</div>
</article>
<hr class="post-divider"><article id="post-362" class="post-362 post type-post status-publish format-standard hentry category-sysadmin category-tecno tag-https tag-openssl tag-secure tag-startssl tag-thawte">
<h3 class="post-title"><a href="https://marc.cortinasval.cat/blog/2013/12/06/openssl-recopilem-comandes-i-eines-web-per-securitzar/" rel="bookmark">openSSL, recopilem comandes i eines web per securitzar</a></h3><p>Tots tart o d&#8217;hora ens trobem amb la necessitat d&#8217;haber de securitzar comunicacions, i moltes vegades no tens a má la comanda openssl per segons quins casos, és per això que m&#8217;he decidit per recopilar-les.</p>
<p>- Per crear petición de certificar (CSR) i clau no signada, demana info per command line:</p>
<pre class="brush: plain; title: ; notranslate" title="">
openssl req -nodes -new -keyout cortinasval.key.pem -out cortinasval.csr.pem
openssl req -nodes -new -keyout cortinasval.key.pem -out cortinasval.csr.pem rsa:2048 
</pre>
<p>- Per crear petición de certificar (CSR) a partir de clau, demana info per command line:</p>
<pre class="brush: plain; title: ; notranslate" title="">
openssl req -nodes -new -key cortinasval.key.pem -out cortinasval.csr.pem
</pre>
<p>- Mostra la clau fingerprint d&#8217;un clau:</p>
<pre class="brush: plain; title: ; notranslate" title="">
openssl x509 -subject -dates -fingerprint -in cortinasval.key.pem
</pre>
<p>- Generem clau de 4096 bits</p>
<pre class="brush: plain; title: ; notranslate" title="">
openssl genrsa -out cortinasval.key.pem 4096
</pre>
<p>- Mostrem informació d&#8217;una solicitud de firma (CSR)</p>
<pre class="brush: plain; title: ; notranslate" title="">
openssl req -text -noout -in cortinasval.csr.pem
</pre>
<p>- Mostrem informació d&#8217;un certificat generat</p>
<pre class="brush: plain; title: ; notranslate" title="">
openssl x509 -in cortinasval.crt.pem -noout -text
</pre>
<p>- Creant fitxers PEM per als servidors</p>
<pre class="brush: plain; title: ; notranslate" title="">
cat cortinasval.key.pem cortinasval.crt.pem cortinasval.dhp.pem &gt; cortinasval.pem
</pre>
<p>- Firmar e-mails</p>
<pre class="brush: plain; title: ; notranslate" title="">
openssl smine -sign -in msg.txt -text -out msg.encrypted -signer cortinasval.crt.pem -inkey cortinasval.key.pem
</pre>
<p>- Crear fitxer PKCS12 </p>
<pre class="brush: plain; title: ; notranslate" title="">
openssl pkcs12 -export -in cortinasval.crt.pem -inkey cortinasval.key.pem -out fitxer.p12 -name &quot;Marc Cortinas&quot;
</pre>
<p>- Mostrar certificats utilitzats en la comunicació a un socket</p>
<pre class="brush: plain; title: ; notranslate" title="">
openssl s_client -showcerts -connect marc.cortinasval.cat:443 -CApath /etc/pki/tls/certs
</pre>
<p>Si volem crear una entitat certificadora ens hem d&#8217;assegurar que existeixin els fitxers index.txt(buit) i el serial(posat a 01), a mes, crearem directoris private i network. Editem el fitxer openssl.cnf i configurem default_days_certificate i private_key, finalment posem la cantitat de bits que utilitzarem per a la key (1024..2048)</p>
<p>- Per crear certificat CA</p>
<pre class="brush: plain; title: ; notranslate" title="">
openssl req -new -x509 -days 3650 -keyout private/cortinasval-CA.key.pem -out ./cortinasval-CA.crt.pem 
</pre>
<p>- Exportar el certificat CA al format DER</p>
<pre class="brush: plain; title: ; notranslate" title="">
openssl x509 -in cortinasval-CA.crt.pem -outform der -out cortinasval-CA.crt
</pre>
<p>- Revokem un certificat</p>
<pre class="brush: plain; title: ; notranslate" title="">
openssl ca -revoke cortinasval.crt.pem
</pre>
<p>- Generem la llista de Revocacio de certificats</p>
<pre class="brush: plain; title: ; notranslate" title="">
openssl ca -gencrl -out crl/cortinaslval-CA.crl
</pre>
<p>- Firmem la petició de certificat (CSR)</p>
<pre class="brush: plain; title: ; notranslate" title="">
openssl ca -out cortinasval.crt.pem -in cortinaslval.req.pem
</pre>
<p>- Creem el parametre Diffie-Hoffman per l&#8217;actual CA</p>
<pre class="brush: plain; title: ; notranslate" title="">
openssl dhparam -out cortinasval-CA.dhp.pem 1536
</pre>
<p>- Creem certificat auto-signat a partir d&#8217;una clau</p>
<pre class="brush: plain; title: ; notranslate" title="">
openssl req -new -x509 -key cortinasval.key.pem -out cortinasval.crt.pem
</pre>
<p>- Encriptar un fitxer sencill</p>
<pre class="brush: plain; title: ; notranslate" title="">
openssl enc -bf -A -in fitxer_de_test.txt
</pre>
<p>- Desencriptar un fitxer sencill</p>
<pre class="brush: plain; title: ; notranslate" title="">
openssl enc -bf -d -A -in fitxer_de_test.txt
</pre>
<p>- Calcul de claus sha1</p>
<pre class="brush: plain; title: ; notranslate" title="">
 openssl speed sha1
</pre>
<p>Pels servidors Webs que volguem fer ús del httpS, cada proveidor d&#8217;entitats certificadores te el seu manual, deixo aquí els 2 que he hagut d&#8217;instalar:<br/>
&#8211; <a href=https://search.thawte.com/support/ssl-digital-certificates/index?page=content&#038;actp=CROSSLINK&#038;id=SO15464> Thawte </a><br/>
&#8211; <a href=http://www.startssl.com/?app=21> Startssl </a></p>
<p>Eines utils per obtener información del nivel de seguretat:<br/>
&#8211; <a href=https://ssltools.thawte.com/checker/views/certCheck.jsp> Thhwte tool </a><br/>
&#8211; <a href=https://www.ssllabs.com> SSL Labs </a></p>
<p>Quins conceptes hem de tenir clar?<br/>
&#8211; Tamany de Bits utilitzats a l&#8217;hora de crear el fitxers .pem<br/>
&#8211; SAN, noms de dominos acceptats pels certifictats, poden ser N noms, i tambe portar wildcard.</p>
<div class="post-meta clearfix post-meta-list">
<p class="author-date">
<span class="glyphicon glyphicon-user"></span> mcortinas
<span class="glyphicon glyphicon-calendar"></span> Desembre 6, 2013
</p>
<p class="post-tags"><span class="glyphicon glyphicon-tags"></span><a href="https://marc.cortinasval.cat/blog/tag/https/">https</a> <span class="slash"> / </span><a href="https://marc.cortinasval.cat/blog/tag/openssl/">openssl</a> <span class="slash"> / </span><a href="https://marc.cortinasval.cat/blog/tag/secure/">secure</a> <span class="slash"> / </span><a href="https://marc.cortinasval.cat/blog/tag/startssl/">startssl</a> <span class="slash"> / </span><a href="https://marc.cortinasval.cat/blog/tag/thawte/">thawte</a> <span class="slash"> / </span></p>
</div>
</article>
<hr class="post-divider"><article id="post-247" class="post-247 post type-post status-publish format-standard hentry category-sysadmin category-tecno tag-console tag-iterm tag-screen tag-ssh2 tag-terminal tag-terminator tag-tmux tag-tty tag-wemux">
<h3 class="post-title"><a href="https://marc.cortinasval.cat/blog/2013/11/29/tmux-ha-guanyat/" rel="bookmark">Tmux ha guanyat!</a></h3><p>Parlem de terminals de consola! Parlem de TMUX!!!<br/>
Fa ja uns mesos que estem treballant en el departament amb aquest multiplexor de terminals i estem tant contents amb ell que s&#8217;ha guanyat un post!</p>
<p>Encara recordo amb nostàlgia quant vem descobrir l&#8217;screen, eina que vem explotar en els servidors per </p>
<li>llençar processos que sabem que tenen una llarga durada, aqui tenim d&#8217;aliats el &#8220;&#038;>>&#8221; i el time ( /usr/bin/time &#8211;format=&#8221;%E %S %U %P&#8221; &#8211;output=&#8221;logfile&#8221;)</li>
<li>llençar processos crítics on volem minimitzar els riscos de deixar-ho a mitges per algun tall de llum en el nostre laptop</li>
<li>llençar processos de forma desatesa que volem que es comportin com un dimoni, util quan et demanen llençar script com si fos un dimoni a mode urgent.</li>
<li>llençar processos on puguin fer seguiment als companys, útil per el processos que duran varis torns d&#8217;operadors</li>
<p>però com va dir un colega, l&#8217;screen està &#8220;depre&#8221; ( de deprecated! està passat de moda! ), amb tota la raó del món! ja veureu&#8230;</li>
<p>D&#8217;una altra banda, <a href="https://launchpad.net/terminator/+download" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','http://launchpad.net']);" title="Terminator" target="_blank">Terminator(Linux)</a> i <a href="http://iterm.sourceforge.net" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','http://iterm.sourceforge.net']);" title="iTerm" target="_blank">iTerm(Mac)</a> han estat les consoles utilitzades per realitzar varies tasques a la vegades en diferents servidors, per fer desplegaments de codi, canvis de configuracions, apagar focs, etc&#8230; Mitjançant les pestanyes pots tindre varies consoles connectades a diferents entorns o grups de servidors diferents, a més, cadascuna de les pestanyes les pots dividir en panells i executar les mateixes commandes o scripts alhora, MOLT útil!!!</p>
<p>Doncs si aquestes funcionalitats del iTerm/Terminator ens han estat MOLT útils, imagineu-vos combinat amb el screen, i n&#8217;obtenim el TMUX!!. Ja fa uns quants caps de setmana que vaig passar una tarda per apendre les opcions i preparant-me la configuració a mida, i va ser MOLT productiu, ho recomano a qualsevol sysadmin. Haig de reconèixer que al principi vaig tenir una mica de reticiència però ara ho agraeixo.</p>
<p>Descric el que més valoro:</p>
<li>tenim pestanyes per agrupar per roles/entorns els servidor on estic connectat</li>
<li>cadascuna de les pestanyes les podem dividir en panells</li>
<li>podem enviar comandes a tots els panells alhora d&#8217;una mateixa pestanya</li>
<li>podem redimensionar els panells fàcilment</li>
<li>podem desplaçar-nos pels diferents panells i/o pestanyes amb comoditat</li>
<li>NO necessitem de les X11, impresionant!</li>
<li>pots definir el buffer de cadascun del panell, recomano perdre uns moments per definir un gran buffer, sempre ho acabem utilitzant en algun moment</li>
<li>podem fer ús de plantilles, definint les pestanyes i les mides que obrirem i inclus automatitzar-ho</li>
<li>podem personalitzar quins són la combinació de tecles utilitzades per a fer ús del tmux</li>
<p>Adjunto el meu perfil del tmux en aquest post, on recalcaré les que trobo més interessants.<br/>
Fitxer per descarregar: <a href="http://marc.cortinasval.cat/blog/wp-content/uploads/2013/11/tmux.conf_.txt">tmux.conf</a><br/>
Path: $HOME/.tmux.conf</p>
<pre class="brush: plain; title: ; notranslate" title="">
# Avisa on fa perpellugues el nom de la pestanya on algun dels seus panells ha tingut activitat
set -g visual-activity on
# Per a cada panell guardem 10000 linies de buffer
set -g buffer-limit 10000
# C^B+r per recarregar en el tmux canvis en aquestes configuracion (aixo per nota!)
unbind r
bind r source-file ~/.tmux.conf  \; display &quot;Reloaded!&quot;
#C^B+a <img src='https://marc.cortinasval.cat/blog/wp-includes/images/smilies/icon_sad.gif' alt=':(' class='wp-smiley'/> All) per escriure en tots els panells de la pestanya
unbind a
bind a setw synchronize-panes on
# C^B+o <img src='https://marc.cortinasval.cat/blog/wp-includes/images/smilies/icon_sad.gif' alt=':(' class='wp-smiley'/> One) per escriure nomes en panell seleccionat
unbind o
bind o setw synchronize-panes off
# Els indexos de panells i pestanyes comencen per 1, en comptes de 0 que és el per defecte
set -g base-index 1
setw -g pane-base-index 1
# Personalitzant la barra d'estat
# Powerline symbols: ⮂ ⮃ ⮀ ⮁ ⭤
set -g status-utf8 on
set -g status-left-length 32
set -g status-right-length 150
set -g status-interval 2

set -g status-left '#[fg=colour15,bg=colour238,bold] #S #[fg=colour238,bg=colour234,nobold]⮀'
set -g status-right '#[fg=colour245]⮃ %R ⮃ %d %b #[fg=colour254,bg=colour234,nobold]⮂#[fg=colour16,bg=colour254,bold] #h '
set -g window-status-format &quot;#[fg=white,bg=colour234] #I #W &quot;
set -g window-status-current-format &quot;#[fg=colour234,bg=colour39]⮀#[fg=colour16,bg=colour39,noreverse,bold] #I ⮁ #W #F #[fg=colour39,bg=colour234,nobold]⮀&quot;
</pre>
<p>Aqui defineixo una plantilla del tmux per facilitar l&#8217;ús, molt útil a l&#8217;hora d&#8217;apagar focs.<br/>
<a href="http://marc.cortinasval.cat/blog/wp-content/uploads/2013/11/tmux_magento.sh_.txt">tmux_magento.sh</a><br/>
El seguent gif mostra la execució de la plantilla que us he penjat, on hem connecto a tots els frontals d&#8217;un mateix role(magento), 8 frontals. La plantilla no deixa de ser un shell script on cada linia mofica el tmux on estem. De fet, per fer-lo funcionar, ÉS NECESSARI estar dins una pestanya del tmux i tenir els indexos dels panells configurats a 1, en comptes de 0 com té per defecte el tmux.</p>
<p><a href="https://marc.cortinasval.cat/blog/wp-content/uploads/2013/11/tmux_magento.gif"><img src="https://marc.cortinasval.cat/blog/wp-content/uploads/2013/11/tmux_magento.gif" alt="tmux_magento" width="620" height="538" class="aligncenter size-full wp-image-294"/></a></p>
<p>Com podeu veure en el gif anterior, jo estic acostumat a connectar-me des d&#8217;un tmux a moltes consoles tty de varis servidors per SSH2. Un altre forme de treballar seria connectar-me a instancies de tmux en cadascun dels servidors a través d&#8217;un fitxer socket, en comptes de connectar-me a la consola, ideal per a compartir sessions remotes alhora entre varis operadors.</p>
<p>Per finalitzar, les fonts consultades:<br/>
<a title="http://blog.sanctum.geek.nz/zooming-tmux-panes/" href="http://blog.sanctum.geek.nz/zooming-tmux-panes/" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','http://blog.sanctum.geek.nz']);" target="_blank">Zooming Tmux Panes</a><br/>
<a title="http://spin.atomicobject.com/2012/04/04/simple-remote-pairing-with-wemux/wemux/" href="http://spin.atomicobject.com/2012/04/04/simple-remote-pairing-with-wemux/wemux/" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','http://spin.atomicobject.com']);" target="_blank">Simple Remote Pairing with Wemux</a><br/>
<a title="http://lukaszwrobel.pl/blog/tmux-tutorial-split-terminal-windows-easily" href="http://lukaszwrobel.pl/blog/tmux-tutorial-split-terminal-windows-easily" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','http://lukaszwrobel.pl']);" target="_blank">Splitting terminal with tmux</a><br/>
<a title="http://www.openbsd.org/cgi-bin/man.cgi?query=tmux&amp;sektion=1" href="http://www.openbsd.org/cgi-bin/man.cgi?query=tmux&amp;sektion=1" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','http://www.openbsd.org']);" target="_blank">Manual del Tmux</a></p>
<p>Projects Links:<br/>
<a title="http://tmux.sourceforge.net" href="http://tmux.sourceforge.net" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','http://tmux.sourceforge.net']);" target="_blank">Tmux Project</a><br/>
<a title="https://github.com/zolrath/wemux" href="https://github.com/zolrath/wemux" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','http://github.com']);">Wemux Project</a></p>
<div class="post-meta clearfix post-meta-list">
<p class="author-date">
<span class="glyphicon glyphicon-user"></span> mcortinas
<span class="glyphicon glyphicon-calendar"></span> Novembre 29, 2013
</p>
<p class="post-tags"><span class="glyphicon glyphicon-tags"></span><a href="https://marc.cortinasval.cat/blog/tag/console/">console</a> <span class="slash"> / </span><a href="https://marc.cortinasval.cat/blog/tag/iterm/">iterm</a> <span class="slash"> / </span><a href="https://marc.cortinasval.cat/blog/tag/screen/">screen</a> <span class="slash"> / </span><a href="https://marc.cortinasval.cat/blog/tag/ssh2/">ssh2</a> <span class="slash"> / </span><a href="https://marc.cortinasval.cat/blog/tag/terminal/">terminal</a> <span class="slash"> / </span><a href="https://marc.cortinasval.cat/blog/tag/terminator/">terminator</a> <span class="slash"> / </span><a href="https://marc.cortinasval.cat/blog/tag/tmux/">tmux</a> <span class="slash"> / </span><a href="https://marc.cortinasval.cat/blog/tag/tty/">tty</a> <span class="slash"> / </span><a href="https://marc.cortinasval.cat/blog/tag/wemux/">wemux</a> <span class="slash"> / </span></p>
</div>
</article>
<hr class="post-divider"><article id="post-4" class="post-4 post type-post status-publish format-standard hentry category-sysadmin category-tecno tag-berryboot tag-mysql tag-nginx tag-php-fpm tag-pluguins tag-raspberrypi tag-raspbian tag-widgets tag-wordpress">
<h3 class="post-title"><a href="https://marc.cortinasval.cat/blog/2013/11/20/wordpress-en-raspberry-pi/" rel="bookmark">WordPress en Raspberry Pi</a></h3><p>Primer post del blog!! Tot just acabo de instalar el wordpress i vaig a recopilar tots els pasos.<br/>
En la RaspberryPi he instalat com a operatiu un debian amb els daemons nginx, php-fpm i mysql per a fer correr el wordpress. Enumero els pasos:</p>
<ul>
<ul>
<li><span style="line-height: 1.714285714; font-size: 1rem;">Instalo berryboot en la targeta SD, on instalo el debian en la raspberry, <a href="http://www.raspberrypi.org/phpBB3/viewtopic.php?t=12776" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','http://www.raspberrypi.org']);" target="_blank">aqui més info</a></span></li>
<li>Faig un &#8220;apt-get update&#8221; per actualitzar les fonts dels repositoris i instalo el meu editor preferit.</li>
<li>Instalo tots els dimonis:</li>
</ul>
</ul>
<pre class="brush: plain; title: ; notranslate" title="">
$sudo apt-get install nginx php5-fpm php5-cgi php5-cli php5-common php5-curl php5-gd php5-mcrypt php5-mysql mysql-server
</pre>
<ul>
<li><span style="line-height: 1.714285714; font-size: 1rem;">Configuro el php-fpm amb el nginx, per utilizarem un file unix per comunicar la interpretació del  php amb el nginx que el servirà, en conclusió, definirem el virtualhost de nginx i settejarem una variable del php</span></li>
</ul>
<p>File: /etc/nginx/sites-available/marc.cortinasval.cat</p>
<pre class="brush: plain; title: ; notranslate" title="">
server {
        listen   80; ## listen for ipv4; this line is default and implied
        root /usr/share/nginx/www;
        index index.php;
        server_name marc.cortinasval.cat;
        location / {
                rewrite  ^/?$  /blog/  redirect;
                try_files $uri $uri/ /index.php;
        }
        location /blog/ {
                try_files $uri $uri/ /blog/index.php?$args;
        }
        location ~ \.php$ {
                fastcgi_split_path_info ^(.+\.php)(/.+)$;
                fastcgi_pass unix:/var/run/php5-fpm.sock;
                fastcgi_index index.php;
                include fastcgi_params;
        }
        location = /favicon.ico {
                log_not_found off;
                access_log off;
        }
        location = /robots.txt {
                allow all;
                log_not_found off;
                access_log off;
        }
        location ~ /\.ht {
                deny all;
        }
        location ~* \.(js|css|png|jpg|jpeg|gif|ico)$ {
                expires max;
                log_not_found off;
        }
}
</pre>
<p>Ens asegurem que el socket unix definit en el fastcgi_pass del nginx correspon al del php-fpm</p>
<pre class="brush: plain; title: ; notranslate" title="">
$ grep listen /etc/php5/fpm/pool.d/www.conf
listen = /var/run/php5-fpm.sock
</pre>
<p>Finalment canviarem el parametre del cgi.fix_pathinfo a 0 en el file /etc/php5/fpm/php.ini</p>
<pre class="brush: plain; title: ; notranslate" title="">
$grep cgi.fix_pathinfo /etc/php5/fpm/php.ini
cgi.fix_pathinfo=0
</pre>
<ul>
<li><span style="line-height: 1.714285714; font-size: 1rem;">Instalo wordpress, per una banda els fitxers php de blog i per una altra preparem la base de dades de mysql que utilitzara i configurem la cadena de conexió de la aplicació.</span></li>
</ul>
<p>Baixem la aplicacio i la posem on toca</p>
<pre class="brush: plain; title: ; notranslate" title="">
$ cd /usr/share/nginx/www/
$ wget http://wordpress.org/latest.zip
$ unzip latest.zip
$ mv wordpress blog
$ rm latest.zip
</pre>
<p>Preparem la base de dades en mysql, des del client del mysql</p>
<pre class="brush: plain; title: ; notranslate" title="">
mysql&gt; CREATE DATABASE wordpress;
Query OK, 1 row affected (6.58 sec)
mysql&gt; GRANT ALL PRIVILEGES ON wordpress.* TO &quot;wordpress&quot;@&quot;localhost&quot;IDENTIFIED BY &quot;wordpress&quot;;
Query OK, 0 rows affected (0.01 sec)
mysql&gt; flush privileges;
Query OK, 0 rows affected (0.02 sec)
mysql&gt; exit;
Bye
</pre>
<p>Configurem la cadena de conexio de la aplicació</p>
<pre class="brush: plain; title: ; notranslate" title="">
cp wp-config-sample.php wp-config.php
vim wp-config.php
[\sourcecode]

File /usr/share/nginx/www/blog/wp-config.php

1
/** The name of the database for WordPress */
define('DB_NAME', 'wordpress');
/** MySQL database username */
define('DB_USER', 'wordpress');
/** MySQL database password */
define('DB_PASSWORD', 'wordpress');
/** MySQL hostname */
define('DB_HOST', 'localhost');
</pre>
<p>Corregim permisos i reiniciem dimonis</p>
<pre class="brush: plain; title: ; notranslate" title="">
$sudo chown -R www-data.www-data /usr/share/nginx/www/
$sudo service nginx restart 
$sudo service php5-fpm restart
</pre>
<p>Accedem via web on configurarem el nom del blog i el nom i password del usuari que administrarà el blog, en aquest pas serà quant es crearà la estructura de dades en el mysql.</p>
<p>Configuro el permanent link del wordpress, aixo serveix per a tenir url&#8217;s més amistoses, com per exemple:  http://marc.cortinasval.cat/blog/index.php/2013/03/wordpress-en-raspberry-pi<br/>
Per aconseguir-ho, primer ens asegurem que tenim les seguents linies en el virtualhost de nginx i després anem a settings&#8211;&gt;permalinks i configurem el format.<br/>
File: /etc/nginx/sites-available/marc.cortinasval.cat</p>
<pre class="brush: plain; title: ; notranslate" title="">
...
        location /blog/ {
                try_files $uri $uri/ /blog/index.php?$args;
        }
...
</pre>
<ul>
<li><span style="line-height: 1.714285714; font-size: 1rem;">Afegeixo i configuro els pluguins de wordpress, llisto aquí els que més m&#8217;han molat: </span></li>
</ul>
<p>SyntaxHighlighter Evolved<br/>
WP to Twitter<br/>
NextScripts: Social Networks Auto-Poster<br/>
Author Spotlight (Widget)<br/>
ExtraWatch Live Stats and Visitor Counter FREE<br/>
Google Analytics<br/>
Google Analytics for WordPress<br/>
Social Login for wordpress<br/>
User Photo</p>
<ul>
<li>Poso un minim de categories i creo un menu amb aquestes categories</li>
<li>Finalment em baixo un thema i poso el menu en el tema</li>
<li>Poso el witget de delicious</li>
</ul>
<p>Escric aquest primer post i ja tinc el blog preparat per a recopilar més info!!!!</p>
<div class="post-meta clearfix post-meta-list">
<p class="author-date">
<span class="glyphicon glyphicon-user"></span> mcortinas
<span class="glyphicon glyphicon-calendar"></span> Novembre 20, 2013
</p>
<p class="post-tags"><span class="glyphicon glyphicon-tags"></span><a href="https://marc.cortinasval.cat/blog/tag/berryboot/">berryboot</a> <span class="slash"> / </span><a href="https://marc.cortinasval.cat/blog/tag/mysql/">mysql</a> <span class="slash"> / </span><a href="https://marc.cortinasval.cat/blog/tag/nginx/">nginx</a> <span class="slash"> / </span><a href="https://marc.cortinasval.cat/blog/tag/php-fpm/">php-fpm</a> <span class="slash"> / </span><a href="https://marc.cortinasval.cat/blog/tag/pluguins/">pluguins</a> <span class="slash"> / </span><a href="https://marc.cortinasval.cat/blog/tag/raspberrypi/">raspberrypi</a> <span class="slash"> / </span><a href="https://marc.cortinasval.cat/blog/tag/raspbian/">raspbian</a> <span class="slash"> / </span><a href="https://marc.cortinasval.cat/blog/tag/widgets/">widgets</a> <span class="slash"> / </span><a href="https://marc.cortinasval.cat/blog/tag/wordpress/">wordpress</a> <span class="slash"> / </span></p>
</div>
</article>
<hr class="post-divider"><article id="post-151" class="post-151 post type-post status-publish format-standard hentry category-sysadmin tag-centos tag-nginx tag-reverse-proxy tag-rhel tag-tuning">
<h3 class="post-title"><a href="https://marc.cortinasval.cat/blog/2013/08/05/afinem-rhelcentos-per-a-lnginxhaproxy-en-entorns-de-produccio/" rel="bookmark">Afinem RHEL/CentOs per a l&#8217;NGINX+HAPROXY en entorns de producció</a></h3><p>Per una banda, l&#8217;Nginx es un servidor WEB molt lleuger capaç de gestionar gran quantitat de connexions concurrents amb una eficaç gestió dels recursos, jo l&#8217;he utilitzat com a servidor proxy on he balancejat el tràfic de diferents aplicacions, tan en entorns productius com en entorns de desenvolupament. </p>
<p>D&#8217;una altra banda utilitzarem el HAPROXY com a balancejador, ja que és un dels programaris més potents, lleugers i flexibles a l&#8217;hora de balancejar tràfic, poden implementar-ho com a balancejador HTTP o TCP, en el meu cas, HTTP amb balanceig enganxós. <a href="hhttp://code.google.com/p/haproxy-docs/wiki/PerformanceTuning/">Per a aquest dimoni només he hagut d&#8217;afinar valors com tune.bufsize i tune.maxrewrite</a></p>
<p>En un entorn productiu cal afinar la plataforma per a tindre&#8217;ls preparats per a que ens permeti un bon rendiment, l&#8217;objectiu del post es tenir ben recopilada tota la informació que he utilitzat. Per la xarxa hi han molta documentació sobre aquest propòsit, aquí únicament els recopilarem per a tenir-ho ben recol·lectat, al final del post hi llisto les fonts.</p>
<p>CentOs/RHEL es la plataforma on ho he muntat, on el nginx únicament fa la funció de &#8220;reverse proxy&#8221; de diferents sites, descartant les funcionalitats de balanceig i de cache, on les he implementat amb HAProxy i Varnish-cache que ja he explicat <a href="http://marc.cortinasval.cat/blog/2013/03/19/balancejador-https-economic-nginxhaproxypacemaker/">en un altre post</a>, aquí amb vull centrar en afinar-ho i llistar els petits problemes que m&#8217;he trobat/corregit.</p>
<p>Per tal d&#8217;afinar-ho, segmentem 3 configuracions diferents:</p>
<ul>
<li>Paràmetres del nucli del sistema operatiu</li>
</ul>
<ul>
<li>Límits del sistema Operatiu</li>
</ul>
<ul>
<li>Configuració del nginx</li>
</ul>
<p><strong>Paràmetres del nucli del sistema operatiu</strong></p>
<p>Valor per defecte i aplicat:</p>
<pre class="brush: plain; title: ; notranslate" title="">
sysctl -w net.ipv4.tcp_congestion_control = cubic
</pre>
<p>Algorisme de gestió dels trafic TCP, en el paràmetre net.ipv4.tcp_available_congestion_control podem saber quines opcions tenim carregades en el kernel de linux<br/>
En CentOs6 tenim aquestes opcions: cubic reno, en el següent enllaç ho explica<br/>
<a href="http://kaivanov.blogspot.com.es/2010/09/linux-tcp-tuning.html" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','http://kaivanov.blogspot.com.es']);">http://kaivanov.blogspot.com.es/2010/09/linux-tcp-tuning.html</a></p>
<ul>
<li>reno: Traditional TCP used by almost all other OSes. (default)</li>
<li>cubic: CUBIC-TCP (NOTE: There is a cubic bug in the Linux 2.6.18 kernel used by Redhat Enterprise Linux 5.3 and Scientific Linux 5.3. Use 2.6.18.2 or higher!)</li>
<li>bic: BIC-TCP</li>
<li>htcp: Hamilton TCP</li>
<li>vegas: TCP Vegas</li>
<li>westwood: optimized for lossy networks</li>
</ul>
<p>Valor per defecte i aplicat:</p>
<pre class="brush: plain; title: ; notranslate" title="">
sysctl -w net.ipv4.tcp_window_scaling = 1
</pre>
<p>Auto-escalat de la mida de la finestra de recepció TCP utilitzat, la finestra més gran pot ocupar 65,535 bytes. 1 ho activem i 0 ho desactivem.</p>
<p>Valor per defecte:</p>
<pre class="brush: plain; title: ; notranslate" title="">
sysctl -w net.ipv4.ip_local_port_range=&quot;32768 61000&quot;
</pre>
<p>Valor per aplicat:</p>
<pre class="brush: plain; title: ; notranslate" title="">
sysctl -w net.ipv4.ip_local_port_range=&quot;2000 65000&quot;
</pre>
<p>Defineix el conjunt de ports locals que fa servir el SO per connexions les connexions TCP i UDP</p>
<p>Valor per defecte:</p>
<pre class="brush: plain; title: ; notranslate" title="">
sysctl -w net.ipv4.tcp_max_syn_backlog=&quot;2048&quot;
</pre>
<p>Valor per aplicat:</p>
<pre class="brush: plain; title: ; notranslate" title="">
sysctl -w net.ipv4.tcp_max_syn_backlog=&quot;204800&quot;
</pre>
<p>Numero màxim de peticions per les connexions rebudes que encara no ha rebut el ACK del emissor, per defecte és 1024 i en sistemes de menys de 128Mb li assignem 128. Si el servidor pateix sobrecàrrega intenta incrementar aquest valor.</p>
<p>Valor per defecte:</p>
<pre class="brush: plain; title: ; notranslate" title="">
sysctl -w net.core.somaxconn=&quot;128&quot;&quot;
</pre>
<p>Valor per aplicat:</p>
<pre class="brush: plain; title: ; notranslate" title="">
sysctl -w net.core.somaxconn=&quot;12800&quot;
</pre>
<p>Numero màxim de connexions que estan passant de LISTEN a ESTABLISHED, si es supera aquest número de connexions establertes el sistema les rebutja.</p>
<p>Valor per defecte:</p>
<pre class="brush: plain; title: ; notranslate" title="">
sysctl -w net.ipv4.tcp_max_tw_buckets=&quot;262144&quot;
</pre>
<p>Valor per aplicat:</p>
<pre class="brush: plain; title: ; notranslate" title="">
sysctl -w net.ipv4.tcp_max_tw_buckets=&quot;524284&quot;
</pre>
<p>Numero màxim de connexions en estat TIME_WAIT, quant el superem, el sistema elimina els sockets i envia un avís. Aquest limit només s&#8217;utilitza per AVISAR de atacs DDOS. Aquest valor no s&#8217;acostuma a baixar sinó a incrementar proporcionalment amb la memòria, si les condicions de xarxa aixi ho requereixen.</p>
<p>Valor per defecte:</p>
<pre class="brush: plain; title: ; notranslate" title="">
sysctl -w net.core.rmem_default=&quot;229376&quot;
</pre>
<p>Valor per aplicat:</p>
<pre class="brush: plain; title: ; notranslate" title="">
sysctl -w net.core.rmem_default=&quot;262142&quot;
</pre>
<p>Mida de la memòria asignada per defecte en la recepció pels socket</p>
<p>Valor per defecte:</p>
<pre class="brush: plain; title: ; notranslate" title="">
sysctl -w net.core.rmem_max=&quot;131071&quot;
</pre>
<p>Valor per aplicat:</p>
<pre class="brush: plain; title: ; notranslate" title="">
sysctl -w net.core.rmem_max=&quot;524284&quot;
</pre>
<p>Mida màxima de memòria assignada per defecte en la recepció pels socket, <a href="https://access.redhat.com/site/documentation/en-US/Red_Hat_Enterprise_Linux/6/html/Performance_Tuning_Guide/s-network-dont-adjust-defaults.html" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','http://access.redhat.com']);">aquest valor ha de ser superior al net.core.rmem_default</a><br/>
Alerta! En RHEL compleix aquesta ultima recomanació però en CentOS6 no ho segueix</p>
<p>Valor per defecte:</p>
<pre class="brush: plain; title: ; notranslate" title="">
sysctl -w net.core.wmem_default=&quot;229376&quot;
</pre>
<p>Valor per aplicat:</p>
<pre class="brush: plain; title: ; notranslate" title="">
sysctl -w net.core.wmem_default=&quot;262142
</pre>
<p>Mida de memòria asignada per defecte en l&#8217;enviament pels socket</p>
<p>Valor per defecte:</p>
<pre class="brush: plain; title: ; notranslate" title="">
sysctl -w net.core.wmem_max=&quot;131071&quot;
</pre>
<p>Valor per aplicat:</p>
<pre class="brush: plain; title: ; notranslate" title="">
sysctl -w net.core.wmem_max=&quot;524284&quot;
</pre>
<p>Mida màxima de memòria assignada per defecte en la emissió pels socket, <a href="https://access.redhat.com/site/documentation/en-US/Red_Hat_Enterprise_Linux/6/html/Performance_Tuning_Guide/s-network-dont-adjust-defaults.html" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','http://access.redhat.com']);">aquest valor ha de ser superior al net.core.rmem_default</a><br/>
Alerta! En RHEL compleix aquesta ultima recomanació però en CentOS6 no ho segueix</p>
<p>Valor per defecte i aplicat:</p>
<pre class="brush: plain; title: ; notranslate" title="">
sysctl -w net.ipv4.tcp_rmem=&quot;4096 87380 4194304&quot;
</pre>
<p>Paràmetres de auto configuració TCP en la recepció de dades: El primer valor es la mida mínima de memòria utilitzat per a cada connexió TCP. El segon valor especifica la mida PER DEFECTE de buffer en la recepció per a cadascun dels socket. Aquest valor sobreescriu el /proc/sys/net/core/rmem_default utilitzat en altres protocols(!=TCP). El tercer i ultim valor especifica la mida màxima de memòria per la recepció de dades per a cadascun de les connexions TCP.</p>
<p>Valor per defecte i aplicat:</p>
<pre class="brush: plain; title: ; notranslate" title="">
sysctl -w net.ipv4.tcp_wmem=&quot;4096 65536 4194304&quot;
</pre>
<p>Parametres de auto configuració TCP en la emissió: Aquests tres valors indiquen quin es l&#8217;espai de memòria assignat a cada socket en l&#8217;enviament de dades. El primer es la mida mínima, el segon la mida per defecte i el tercer la mida màxim del buffer reservat per a l&#8217;enviament de dades.</p>
<p>Valor per defecte:</p>
<pre class="brush: plain; title: ; notranslate" title="">
sysctl -w net.ipv4.tcp_mem=&quot;753888 1005184 1507776&quot;
</pre>
<p>Valor per aplicat:</p>
<pre class="brush: plain; title: ; notranslate" title="">
sysctl -w net.ipv4.tcp_mem=&quot;753888 1005184 4194304&quot;
</pre>
<p>Paràmetres de auto configuració TCP: Defineix com el sistema operatiu gestion l&#8217;ús de la memòria per a les connexions TCP. El primer valor especifica el umbral mínim. Per sota d&#8217;aquest valor el SO no va cap canvi de gestió de la memòria pels diferents socket TCP. El segons valor indica la mida per defecte permès per a 1a connexió TCP, el tercer valor ens indica la mida màxima de memòria utilitzat per les connexions TCP, si el SO consumeix més memòria per a les connexions TCP comença a fer DROPS de les noves connexions.</p>
<p>Valor per defecte i aplicat:</p>
<pre class="brush: plain; title: ; notranslate" title="">
sysctl -w fs.file-max=&quot;793779&quot;
</pre>
<p>Defineix el número màxim de descriptors de fitxers que gestiona el SO (Recordem que tant els sockets com els fitxers son descriptors de fitxers en entorns Linux/Unix)</p>
<p>Valor per defecte:</p>
<pre class="brush: plain; title: ; notranslate" title="">
sysctl -w net.ipv4.tcp_tw_reuse=&quot;0&quot;
</pre>
<p>Valor per aplicat:</p>
<pre class="brush: plain; title: ; notranslate" title="">
sysctl -w net.ipv4.tcp_tw_reuse=&quot;1&quot;
</pre>
<p>Permetre reutilitzar els sockets que estan en TIME_WAIT quant es segur des del punt de vista del protocol. Non hauria de ser modificat sense la supervisió d&#8217;un expert <img src='https://marc.cortinasval.cat/blog/wp-includes/images/smilies/icon_wink.gif' alt=';)' class='wp-smiley'/> </p>
<p>Valor per defecte:</p>
<pre class="brush: plain; title: ; notranslate" title="">
sysctl -w net.ipv4.tcp_tw_recycle=&quot;0&quot;
</pre>
<p>Valor per aplicat:</p>
<pre class="brush: plain; title: ; notranslate" title="">
sysctl -w net.ipv4.tcp_tw_recycle=&quot;1&quot;
</pre>
<p>Permetre la rapida reutilització de sockets en TIME_WAIT. Activant aquesta opcio no es recomenada si estas fent NAT. En canvi amb el HAPROXY es molt recomenable per baixar CONSIDERABLEMENT el numero de connexions en TIME_WAIT. Adjunto una captura de graphite on podem veure el canvi només aplicant aquesta variable.<br/>
<a href="https://marc.cortinasval.cat/blog/wp-content/uploads/2013/08/haproxy.png"><img src="https://marc.cortinasval.cat/blog/wp-content/uploads/2013/08/haproxy.png" alt="haproxy" width="579" height="304" class="aligncenter size-full wp-image-204"/></a></p>
<p>Valor per defecte:</p>
<pre class="brush: plain; title: ; notranslate" title="">
sysctl -w net.ipv4.tcp_max_orphans=&quot;262144&quot;
</pre>
<p>Valor per aplicat:</p>
<pre class="brush: plain; title: ; notranslate" title="">
sysctl -w net.ipv4.tcp_max_orphans=&quot;30000&quot;
</pre>
<p>Número màxim de TCP sockets orfans que no estan connectats a cap proces. Quant aquest numero s&#8217;excedeix, les connexions orfanes es resetejant i es notifica amb una alerta. Aquest limit existeix nomes per prevenir atacs de denegament de servei. Decrementar aquest valor no es aconsellable. Les condicions de xarxa poden requerir que incrementis el numero de orfans permesos, cadascun dels orfans poden ocupar aproximadament 64k de memoria NO-SWAPEJABLE. El valor per defecte es igual que el parametre NR_FILE del kernel, en 262144 en RHEL6/CentOS6, ajustat a la memoria del sistema.</p>
<p>Valor per defecte:</p>
<pre class="brush: plain; title: ; notranslate" title="">
sysctl -w net.ipv4.tcp_synack_retries=&quot;5&quot;
</pre>
<p>Valor per aplicat:</p>
<pre class="brush: plain; title: ; notranslate" title="">
sysctl -w net.ipv4.tcp_synack_retries=&quot;3&quot;
</pre>
<p>Número màxim de vegades que un segment SYN/ACK per a una connexio TCP passiva sera retransmitit. Aquest numero no pot excedir de 255.</p>
<p><strong>Límits del sistema Operatiu</strong><br/>
Amb concordança amb el últim paràmetre explicat en l&#8217;apartat anterior, hem de ampliar el numero de descriptors de fitxers que permetem realitzar al usuari que instancia el nginx, afegint les línies següents al fitxer /etc/security/limits.conf</p>
<pre class="brush: plain; title: ; notranslate" title="">
nginx       soft    nofile   10000
nginx       hard    nofile   30000
</pre>
<p><strong>Configuració del nginx</strong><br/>
No menys important que les configuracions de sistema són la configuració del nginx. </p>
<p>Primerament cal dimensionar la memòria i la CPU del sistema. Cal dimensionar assignant els valors correctes de worker_processes i worker_connections tenint en compte la formula: max clients = worker_processes * worker_connections/4. En el meu cas tenim més de 1200 connexions concurrents on tinc una maquina amb 8 vCPUs i 8GB de RAM, on he assignat:</p>
<pre class="brush: plain; title: ; notranslate" title="">
worker_processes  8;
events {
    worker_connections  1024;
}
</pre>
<p>Seguidament segons el tipus d&#8217;aplicacions que estiguem balancejant amb l&#8217;nginx, tenint en compte el número i el tipus d&#8217;aplicacions, les connexions concurrents que requereixen, la mida tant de les capçaleres com del cos, tant de les peticions com de les respostes, caldrà afinar els següents paràmetres.</p>
<pre class="brush: plain; title: ; notranslate" title="">
## Size Limits
  client_body_buffer_size     128K;
  client_header_buffer_size   8k;
  client_max_body_size          1M;
  large_client_header_buffers 8 32k;
## Timeouts
  client_body_timeout   60;
  client_header_timeout 60;
  expires               24h;
  keepalive_timeout     60 60;
  send_timeout          60;
  proxy_connect_timeout 60s; 
  proxy_read_timeout 120s;
  proxy_send_timeout 120s
## TCP options
  tcp_nodelay on;
  tcp_nopush  on;
## Proxy options
  proxy_buffering           on;
  proxy_buffers 16 16k;
  proxy_buffer_size 32k;
##Fix header too big http://forum.nginx.org/read.php?2,188352
  fastcgi_buffers 16 16k;
  fastcgi_buffer_size 32k;
</pre>
<p>Aquests paràmetres els utilitzo per a publicar aplicacions PHP i contingut estàtic on es connecten tot tipus de navegadors tan estacions de treball, ordinadors portàtils, dispositius mòbils com tabletes des de diferents proveïdors ADSL, 2G, 3G, 4G, WiMax, FTH, etc&#8230;. Remarco que no utilitzo la funció de cache del nginx.<br/>
Seguidament faig esmena de 2 problemes que m&#8217;he trobat amb les nostres aplicacions.</p>
<p>Per part del Nginx, si volem augmentar les mides de la capçalera que reben del frontal a més de 16kb, també s&#8217;ha de parametritzar el parametres fastcgi_buffers i fastcgi_buffer_size tal com ho reporten en el foro <a href="http://forum.nginx.org/read.php?2,188352" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','http://forum.nginx.org']);">aquest link</a>, no li vaig trobar logica però va ser aplicar-ho i desapareixer.</p>
<p>Per part del Haproxy també hi han limitacions del tamany del buffsize, en Centos/RHEL els paquets compilats del repositori yum estan tots a 16kb, <a href="http://www.serverphorums.com/read.php?10,87343" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','http://www.serverphorums.com']);">en el foro de HAPROXY trobem com recompilar-ho</a><br/>
Molt útil per corregir aquest tipus de errors: </p>
<pre class="brush: plain; title: ; notranslate" title="">
echo show errors | socat stdio unix-connect:&lt;path-to-socket&gt;
</pre>
<p>Les principals fonts que he seguit són:</p>
<p><a href="http://linux.die.net/man/7/tcp" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','http://linux.die.net']);">http://linux.die.net/man/7/tcp</a><br/>
<a href="http://dak1n1.com/blog/12-nginx-performance-tuning" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','http://dak1n1.com']);">http://dak1n1.com/blog/12-nginx-performance-tuning</a><br/>
<a href="http://www.cyberciti.biz/faq/rhel-linux-install-nginx-as-reverse-proxy-load-balancer/" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','http://www.cyberciti.biz']);">http://www.cyberciti.biz/faq/rhel-linux-install-nginx-as-reverse-proxy-load-balancer/</a><br/>
<a href="http://www.cyberciti.biz/faq/linux-unix-nginx-too-many-open-files" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','http://www.cyberciti.biz']);">http://www.cyberciti.biz/faq/linux-unix-nginx-too-many-open-files</a><br/>
<a href="http://www.exceliance.fr/sites/default/files/biblio/art-2006-making_applications_scalable_with_lb.pdf" onclick="javascript:_gaq.push(['_trackEvent','download','http://www.exceliance.fr/sites/default/files/biblio/art-2006-making_applications_scalable_with_lb.pdf']);">http://www.exceliance.fr/sites/default/files/biblio/art-2006-making_applications_scalable_with_lb.pdf</a><br/>
<a href="http://comments.gmane.org/gmane.comp.web.haproxy/11145" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','http://comments.gmane.org']);">http://comments.gmane.org/gmane.comp.web.haproxy/11145</a></p>
<div class="post-meta clearfix post-meta-list">
<p class="author-date">
<span class="glyphicon glyphicon-user"></span> mcortinas
<span class="glyphicon glyphicon-calendar"></span> Agost 5, 2013
</p>
<p class="post-tags"><span class="glyphicon glyphicon-tags"></span><a href="https://marc.cortinasval.cat/blog/tag/centos/">centos</a> <span class="slash"> / </span><a href="https://marc.cortinasval.cat/blog/tag/nginx/">nginx</a> <span class="slash"> / </span><a href="https://marc.cortinasval.cat/blog/tag/reverse-proxy/">reverse proxy</a> <span class="slash"> / </span><a href="https://marc.cortinasval.cat/blog/tag/rhel/">rhel</a> <span class="slash"> / </span><a href="https://marc.cortinasval.cat/blog/tag/tuning/">tuning</a> <span class="slash"> / </span></p>
</div>
</article>
<hr class="post-divider">	<div class="page-links"><span class='page-numbers current'>1</span>
<a class='page-numbers' href='https://marc.cortinasval.cat/blog/ca/page/2/'>2</a></div>	</div>
<div id="primary-sidebar" class="col-md-4">
<aside id="gsc-widget-2" class="widget google custom search"><hr>	<div id="cse-search-form43" style="width: 100%;">Loading</div>
<script>google.load('search','1',{language:'ca'});google.setOnLoadCallback(function(){var customSearchControl=new google.search.CustomSearchControl('');customSearchControl.setResultSetSize(google.search.Search.FILTERED_CSE_RESULTSET);var options=new google.search.DrawOptions();options.setSearchFormRoot('cse-search-form43');options.setAutoComplete(true);customSearchControl.draw('dialog',options);customSearchControl.setSearchCompleteCallback(this,CallBackDisplayDialog);},true);function CallBackDisplayDialog(result){jQuery('#dialog').dialog('open');}</script>
<!-- open dialog. For debug purposes
        <p><a href="#" id="dialog_link" class="ui-state-default ui-corner-all"><span class="ui-icon ui-icon-newwin"></span>Open Dialog</a></p>
-->
<!-- ui-dialog -->
<div id="dialog" title="Resultat de la cerca">
<p></p>
</div>
</aside>	<aside id="recent-posts-2" class="widget widget_recent_entries"><hr>	<h4>Entrades recents</h4>	<ul>
<li>
<a href="https://marc.cortinasval.cat/blog/2015/01/12/elk-en-centos7/">ELK en CentOs7</a>
</li>
<li>
<a href="https://marc.cortinasval.cat/blog/2014/04/29/graphite-gran-recurs-per-graficar-sistemes/">Graphite: gran recurs per gràficar sistemes</a>
</li>
<li>
<a href="https://marc.cortinasval.cat/blog/2014/03/05/kibana-ens-ajuda-amb-els-logs-de-aws-cloudfront-i-waf-akamai/">Kibana ens ajuda amb els logs de AWS Cloudfront i WAF Akamai</a>
</li>
<li>
<a href="https://marc.cortinasval.cat/blog/2013/12/17/varnish-cache-un-molt-bon-aliat-per-a-la-web/">varnish-cache, un molt bon aliat per a la web</a>
</li>
<li>
<a href="https://marc.cortinasval.cat/blog/2013/12/15/breu-resum-de-la-nostra-historia/">breu resum de la nostra història</a>
</li>
</ul>
</aside><aside id="linkcat-0" class="widget widget_links"><hr><h4>Favorits</h4>
<ul class='xoxo blogroll'>
<li><a href="http://www.cloudadmins.org/" title="News about building cloud-ready infrastructures" target="" onclick="javascript:_gaq.push(['_trackEvent','outbound-blogroll','http://www.cloudadmins.org']);">Cloudadmins</a></li>
<li><a href="http://www.tomas.cat/blog/" target="" onclick="javascript:_gaq.push(['_trackEvent','outbound-blogroll','http://www.tomas.cat']);">El blog d&#039;en Tomas</a></li>
<li><a href="http://maauso.com/" target="" onclick="javascript:_gaq.push(['_trackEvent','outbound-blogroll','http://maauso.com']);">El blog de Miguel</a></li>
<li><a href="http://www.entredevyops.es/" target="" onclick="javascript:_gaq.push(['_trackEvent','outbound-blogroll','http://www.entredevyops.es']);">Entre Dev y Ops</a></li>
<li><a href="http://highscalability.com/" target="" onclick="javascript:_gaq.push(['_trackEvent','outbound-blogroll','http://highscalability.com']);">High Scability</a></li>
<li><a href="https://groups.google.com/forum/?hl=es#!forum/puppet-users-barcelona">Puppet Users BCN</a></li>
</ul>
</aside>
<aside id="meta-3" class="widget widget_meta"><hr><h4>Admin</h4>	<ul>
<li><a href="https://marc.cortinasval.cat/blog/wp-login.php">Log in</a></li>
<li><a href="https://marc.cortinasval.cat/blog/ca/feed/" title="Sindicar aquest lloc fent servir RSS 2.0"><abbr title="en anglès, Really Simple Syndication">RSS</abbr> de les entrades</a></li>
<li><a href="https://marc.cortinasval.cat/blog/ca/comments/feed/" title="Últims comentaris a totes les entrades en RSS"><abbr title="en inglés, Really Simple Syndication">RSS</abbr> dels comentaris</a></li>
<li><a href="http://wordpress.org/" title="Funcionant amb el WordPress, plataforma semàntica de publicació personal de primer ordre.">WordPress.org</a></li>	</ul>
</aside></div></div>
</div>
<footer>
<div id="footer-bottom">
<div class="container">
<div class="row">
<div id="footer-meta" class="col-md-9">
<p>&copy; <a id="footer-site" href="https://marc.cortinasval.cat/blog/ca" title="El blog d&#039;en Marc">El blog d&#039;en Marc</a></p>
</div>
<div id="footer-credit" class="col-md-3">
<p><a href="http://www.wpmultiverse.com/themes/franklin/" title="Franklin WordPress Theme">Franklin Theme</a></p>
</div>
</div>
</div>
</div>
</footer>
<script></script>
<script src='https://marc.cortinasval.cat/blog/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shCore.js?ver=3.0.9'></script>
<script src='https://marc.cortinasval.cat/blog/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushPlain.js?ver=3.0.9'></script>
<script>(function(){var corecss=document.createElement('link');var themecss=document.createElement('link');var corecssurl="https://marc.cortinasval.cat/blog/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/styles/shCore.css?ver=3.0.9";if(corecss.setAttribute){corecss.setAttribute("rel","stylesheet");corecss.setAttribute("type","text/css");corecss.setAttribute("href",corecssurl);}else{corecss.rel="stylesheet";corecss.href=corecssurl;}document.getElementsByTagName("head")[0].insertBefore(corecss,document.getElementById("syntaxhighlighteranchor"));var themecssurl="https://marc.cortinasval.cat/blog/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/styles/shThemeDefault.css?ver=3.0.9";if(themecss.setAttribute){themecss.setAttribute("rel","stylesheet");themecss.setAttribute("type","text/css");themecss.setAttribute("href",themecssurl);}else{themecss.rel="stylesheet";themecss.href=themecssurl;}document.getElementsByTagName("head")[0].insertBefore(themecss,document.getElementById("syntaxhighlighteranchor"));})();SyntaxHighlighter.config.strings.expandSource='+ expand source';SyntaxHighlighter.config.strings.help='?';SyntaxHighlighter.config.strings.alert='SyntaxHighlighter\n\n';SyntaxHighlighter.config.strings.noBrush='Can\'t find brush for: ';SyntaxHighlighter.config.strings.brushNotHtmlScript='Brush wasn\'t configured for html-script option: ';SyntaxHighlighter.defaults['pad-line-numbers']=false;SyntaxHighlighter.defaults['toolbar']=false;SyntaxHighlighter.all();</script>
<script src='https://marc.cortinasval.cat/blog/wp-includes/js/jquery/ui/jquery.ui.core.min.js?ver=1.10.3'></script>
<script src='https://marc.cortinasval.cat/blog/wp-includes/js/jquery/ui/jquery.ui.widget.min.js?ver=1.10.3'></script>
<script src='https://marc.cortinasval.cat/blog/wp-includes/js/jquery/ui/jquery.ui.mouse.min.js?ver=1.10.3'></script>
<script src='https://marc.cortinasval.cat/blog/wp-includes/js/jquery/ui/jquery.ui.resizable.min.js?ver=1.10.3'></script>
<script src='https://marc.cortinasval.cat/blog/wp-includes/js/jquery/ui/jquery.ui.draggable.min.js?ver=1.10.3'></script>
<script src='https://marc.cortinasval.cat/blog/wp-includes/js/jquery/ui/jquery.ui.button.min.js?ver=1.10.3'></script>
<script src='https://marc.cortinasval.cat/blog/wp-includes/js/jquery/ui/jquery.ui.position.min.js?ver=1.10.3'></script>
<script src='https://marc.cortinasval.cat/blog/wp-includes/js/jquery/ui/jquery.ui.dialog.min.js?ver=1.10.3'></script>
<script src='https://marc.cortinasval.cat/blog/wp-content/themes/franklin/assets/js/bootstrap.min.js?ver=3.1.1'></script>
<script src='https://marc.cortinasval.cat/blog/wp-content/themes/franklin/assets/js/franklin.js?ver=1.0'></script>
<script src='https://marc.cortinasval.cat/blog/wp-content/plugins/multi-column-tag-map/mctagmap.js?mctm_ver=12.0.4&#038;ver=1'></script>
<script>if(typeof console==='object'){console.log('[BEGIN WordPress HTTPS Debug Log]');console.log('Version: 3.3.6');console.log('HTTP URL: http://marc.cortinasval.cat/blog/');console.log('HTTPS URL: https://marc.cortinasval.cat/blog/');console.log('SSL: Yes');console.log('Diff Host: No');console.log('Subdomain: No');console.log('Proxy: Yes');console.log('Secure External URLs: [ http://lh5.googleusercontent.com/-TZkI5pIXMd8/AAAAAAAAAAI/AAAAAAAAAAA/zQRIcpCZBSQ/photo.jpg, https://fonts.googleapis.com/css?family=Open+Sans|Nixie+One, http://www.google.com/cse/style/look/minimalist.css, http://www.google.com/jsapi, https://www.google.com/jsapi, http://www.google.com/cse/style/look/minimalist.css?ver=3.7.1, http://cdn.gtln.us/img/nxs/noImgC.png, https://secure.gravatar.com/avatar/4c530e5935bc75173f11e16a1436a8a8?s=60&amp;d=https%3A%2F%2Fsecure.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D60&amp;r=G, https://secure.gravatar.com/avatar/7daa433fe1f92bda31f1abb86215d47e?s=60&amp;d=https%3A%2F%2Fsecure.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D60&amp;r=G, https://secure.gravatar.com/avatar/7012672c865b2b66504978966566c50f?s=60&amp;d=https%3A%2F%2Fsecure.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D60&amp;r=G, https://secure.gravatar.com/avatar/7012672c865b2b66504978966566c50f?s=50&amp;d=https%3A%2F%2Fsecure.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D50&amp;r=G, https://secure.gravatar.com/avatar/7daa433fe1f92bda31f1abb86215d47e?s=50&amp;d=https%3A%2F%2Fsecure.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D50&amp;r=G, https://secure.gravatar.com/avatar/4c530e5935bc75173f11e16a1436a8a8?s=50&amp;d=https%3A%2F%2Fsecure.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D50&amp;r=G, https://secure.gravatar.com/avatar/e5a41c613b2888def5bb9e8ca11706cd?s=60&amp;d=https%3A%2F%2Fsecure.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D60&amp;r=G, https://secure.gravatar.com/avatar/130e5b6ea5b7a37414f5cf937e068b31?s=60&amp;d=https%3A%2F%2Fsecure.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D60&amp;r=G, https://secure.gravatar.com/avatar/130e5b6ea5b7a37414f5cf937e068b31?s=50&amp;d=https%3A%2F%2Fsecure.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D50&amp;r=G, https://secure.gravatar.com/avatar/e5a41c613b2888def5bb9e8ca11706cd?s=50&amp;d=https%3A%2F%2Fsecure.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D50&amp;r=G, https://secure.gravatar.com/avatar/42273633a4b1808ae44b549f7302a810?s=64&amp;d=https%3A%2F%2Fsecure.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D64&amp;r=G, https://secure.gravatar.com/avatar/42273633a4b1808ae44b549f7302a810?s=16&amp;d=https%3A%2F%2Fsecure.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D16&amp;r=G, https://secure.gravatar.com/avatar/42273633a4b1808ae44b549f7302a810?s=96&amp;d=https%3A%2F%2Fsecure.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D96&amp;r=G, https://secure.gravatar.com/avatar/01654406729d24616b86abe3d6a2cf84?s=60&amp;d=https%3A%2F%2Fsecure.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D60&amp;r=G, https://secure.gravatar.com/avatar/448c871de7ea14ab611f00ffd8df840b?s=60&amp;d=https%3A%2F%2Fsecure.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D60&amp;r=G, https://secure.gravatar.com/avatar/d3f9f8d6c3db8ae45f2a3ee290482f5c?s=50&amp;d=https%3A%2F%2Fsecure.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D50&amp;r=G, https://secure.gravatar.com/avatar/448c871de7ea14ab611f00ffd8df840b?s=50&amp;d=https%3A%2F%2Fsecure.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D50&amp;r=G, https://secure.gravatar.com/avatar/01654406729d24616b86abe3d6a2cf84?s=50&amp;d=https%3A%2F%2Fsecure.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D50&amp;r=G, https://secure.gravatar.com/avatar/42273633a4b1808ae44b549f7302a810?s=24&amp;d=https%3A%2F%2Fsecure.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D24&amp;r=G, https://secure.gravatar.com/avatar/467090909d363f6b574ccad91a78d24b?s=60&amp;d=https%3A%2F%2Fsecure.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D60&amp;r=G, https://secure.gravatar.com/avatar/467090909d363f6b574ccad91a78d24b?s=50&amp;d=https%3A%2F%2Fsecure.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D50&amp;r=G, https://secure.gravatar.com/avatar/9cfe92c0706c2fe98b9a5447a48dc931?s=60&amp;d=https%3A%2F%2Fsecure.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D60&amp;r=G, https://secure.gravatar.com/avatar/9894d1cd95019732959f2b38f0a1037b?s=60&amp;d=https%3A%2F%2Fsecure.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D60&amp;r=G, https://secure.gravatar.com/avatar/42354fd812f48306b9c49764edb2f716?s=60&amp;d=https%3A%2F%2Fsecure.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D60&amp;r=G, https://secure.gravatar.com/avatar/42354fd812f48306b9c49764edb2f716?s=50&amp;d=https%3A%2F%2Fsecure.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D50&amp;r=G, https://secure.gravatar.com/avatar/9894d1cd95019732959f2b38f0a1037b?s=50&amp;d=https%3A%2F%2Fsecure.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D50&amp;r=G, https://secure.gravatar.com/avatar/9cfe92c0706c2fe98b9a5447a48dc931?s=50&amp;d=https%3A%2F%2Fsecure.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D50&amp;r=G, https://secure.gravatar.com/avatar/c33263c79ab4b946675139fce3b4ba76?s=60&amp;d=https%3A%2F%2Fsecure.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D60&amp;r=G, https://secure.gravatar.com/avatar/c33263c79ab4b946675139fce3b4ba76?s=50&amp;d=https%3A%2F%2Fsecure.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D50&amp;r=G, https://secure.gravatar.com/avatar/c33263c79ab4b946675139fce3b4ba76?s=32&amp;d=https%3A%2F%2Fsecure.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D32&amp;r=G, https://secure.gravatar.com/avatar/42354fd812f48306b9c49764edb2f716?s=32&amp;d=https%3A%2F%2Fsecure.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D32&amp;r=G, https://secure.gravatar.com/avatar/9894d1cd95019732959f2b38f0a1037b?s=32&amp;d=https%3A%2F%2Fsecure.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D32&amp;r=G, https://secure.gravatar.com/avatar/9cfe92c0706c2fe98b9a5447a48dc931?s=32&amp;d=https%3A%2F%2Fsecure.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D32&amp;r=G, https://secure.gravatar.com/avatar/467090909d363f6b574ccad91a78d24b?s=32&amp;d=https%3A%2F%2Fsecure.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D32&amp;r=G, https://secure.gravatar.com/avatar/d3f9f8d6c3db8ae45f2a3ee290482f5c?s=32&amp;d=https%3A%2F%2Fsecure.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D32&amp;r=G, https://secure.gravatar.com/avatar/448c871de7ea14ab611f00ffd8df840b?s=32&amp;d=https%3A%2F%2Fsecure.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D32&amp;r=G, https://secure.gravatar.com/avatar/01654406729d24616b86abe3d6a2cf84?s=32&amp;d=https%3A%2F%2Fsecure.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D32&amp;r=G, https://secure.gravatar.com/avatar/130e5b6ea5b7a37414f5cf937e068b31?s=32&amp;d=https%3A%2F%2Fsecure.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D32&amp;r=G, https://secure.gravatar.com/avatar/e5a41c613b2888def5bb9e8ca11706cd?s=32&amp;d=https%3A%2F%2Fsecure.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D32&amp;r=G, https://secure.gravatar.com/avatar/7012672c865b2b66504978966566c50f?s=32&amp;d=https%3A%2F%2Fsecure.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D32&amp;r=G, https://secure.gravatar.com/avatar/7daa433fe1f92bda31f1abb86215d47e?s=32&amp;d=https%3A%2F%2Fsecure.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D32&amp;r=G, https://secure.gravatar.com/avatar/4c530e5935bc75173f11e16a1436a8a8?s=32&amp;d=https%3A%2F%2Fsecure.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D32&amp;r=G, https://secure.gravatar.com/avatar/42273633a4b1808ae44b549f7302a810?s=32&amp;d=https%3A%2F%2Fsecure.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D32&amp;r=G, https://secure.gravatar.com/avatar/42273633a4b1808ae44b549f7302a810?s=60&amp;d=https%3A%2F%2Fsecure.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D60&amp;r=G, https://secure.gravatar.com/avatar/4e3515580a21c6ef14f1fa2313f6a9dc?s=60&amp;d=https%3A%2F%2Fsecure.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D60&amp;r=G, https://secure.gravatar.com/avatar/4e3515580a21c6ef14f1fa2313f6a9dc?s=32&amp;d=https%3A%2F%2Fsecure.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D32&amp;r=G, https://secure.gravatar.com/avatar/2e85adc3ccd80338d10a36dc660b12e5?s=60&amp;d=https%3A%2F%2Fsecure.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D60&amp;r=G, https://secure.gravatar.com/avatar/2e85adc3ccd80338d10a36dc660b12e5?s=50&amp;d=https%3A%2F%2Fsecure.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D50&amp;r=G, https://secure.gravatar.com/avatar/42273633a4b1808ae44b549f7302a810?s=50&amp;d=https%3A%2F%2Fsecure.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D50&amp;r=G, https://secure.gravatar.com/avatar/2e85adc3ccd80338d10a36dc660b12e5?s=32&amp;d=https%3A%2F%2Fsecure.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D32&amp;r=G, https://secure.gravatar.com/avatar/bd28049f9529a1c5825b72fd8c77eb57?s=60&amp;d=https%3A%2F%2Fsecure.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D60&amp;r=G, https://secure.gravatar.com/avatar/bd28049f9529a1c5825b72fd8c77eb57?s=50&amp;d=https%3A%2F%2Fsecure.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D50&amp;r=G, https://secure.gravatar.com/avatar/bd28049f9529a1c5825b72fd8c77eb57?s=32&amp;d=https%3A%2F%2Fsecure.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D32&amp;r=G, https://secure.gravatar.com/avatar/6d538e52fe0ed2b5df4e34dbf038426d?s=32&amp;d=https%3A%2F%2Fsecure.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D32&amp;r=G, https://secure.gravatar.com/avatar/bfc16e04484a17d4bf4523f3e5b264cc?s=32&amp;d=https%3A%2F%2Fsecure.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D32&amp;r=G, https://secure.gravatar.com/avatar/6d538e52fe0ed2b5df4e34dbf038426d?s=64&amp;d=https%3A%2F%2Fsecure.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D64&amp;r=G, https://secure.gravatar.com/avatar/6d538e52fe0ed2b5df4e34dbf038426d?s=16&amp;d=https%3A%2F%2Fsecure.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D16&amp;r=G, https://secure.gravatar.com/avatar/53f736302d54036804d2abf70b909d84?s=64&amp;d=https%3A%2F%2Fsecure.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D64&amp;r=G, https://secure.gravatar.com/avatar/53f736302d54036804d2abf70b909d84?s=16&amp;d=https%3A%2F%2Fsecure.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D16&amp;r=G, https://secure.gravatar.com/avatar/ea7dbb10aac09a108d5cbf5c6c9ea21a?s=60&amp;d=https%3A%2F%2Fsecure.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D60&amp;r=G, https://secure.gravatar.com/avatar/cefe753531c5e338249c8a983bdfcb71?s=50&amp;d=https%3A%2F%2Fsecure.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D50&amp;r=G, https://secure.gravatar.com/avatar/ea7dbb10aac09a108d5cbf5c6c9ea21a?s=50&amp;d=https%3A%2F%2Fsecure.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D50&amp;r=G, https://secure.gravatar.com/avatar/7a9f111abef4f5d138bf4b7c3fb6767f?s=50&amp;d=https%3A%2F%2Fsecure.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D50&amp;r=G, https://secure.gravatar.com/avatar/7a9f111abef4f5d138bf4b7c3fb6767f?s=32&amp;d=https%3A%2F%2Fsecure.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D32&amp;r=G, https://secure.gravatar.com/avatar/cefe753531c5e338249c8a983bdfcb71?s=32&amp;d=https%3A%2F%2Fsecure.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D32&amp;r=G, https://secure.gravatar.com/avatar/ea7dbb10aac09a108d5cbf5c6c9ea21a?s=32&amp;d=https%3A%2F%2Fsecure.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D32&amp;r=G, https://secure.gravatar.com/avatar/ea7dbb10aac09a108d5cbf5c6c9ea21a?s=40&amp;d=https%3A%2F%2Fsecure.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D40&amp;r=G, https://secure.gravatar.com/avatar/4c530e5935bc75173f11e16a1436a8a8?s=40&amp;d=https%3A%2F%2Fsecure.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D40&amp;r=G, https://secure.gravatar.com/avatar/42273633a4b1808ae44b549f7302a810?s=40&amp;d=https%3A%2F%2Fsecure.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D40&amp;r=G, https://secure.gravatar.com/avatar/4909f499264db2913a00ed2da7a5b429?s=50&amp;d=https%3A%2F%2Fsecure.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D50&amp;r=G, https://secure.gravatar.com/avatar/6c87e23e43690cda892bef9999094abf?s=50&amp;d=https%3A%2F%2Fsecure.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D50&amp;r=G, https://secure.gravatar.com/avatar/6c87e23e43690cda892bef9999094abf?s=40&amp;d=https%3A%2F%2Fsecure.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D40&amp;r=G ]');console.log('Unsecure External URLs: [ http://sanatalemi.net/images/cartier.html ]');console.log('[FIXED] Element: <a> - http://marc.cortinasval.cat/blog/wp-content/uploads/2013/03/fisicalLB.png => https://marc.cortinasval.cat/blog/wp-content/uploads/2013/03/fisicalLB.png');console.log('[FIXED] Element: <a> - http://marc.cortinasval.cat/blog/wp-content/uploads/2013/03/funcional.png => https://marc.cortinasval.cat/blog/wp-content/uploads/2013/03/funcional.png');console.log('[FIXED] Element: <a> - http://marc.cortinasval.cat/blog/wp-content/uploads/2014/03/ElasticHead.png => https://marc.cortinasval.cat/blog/wp-content/uploads/2014/03/ElasticHead.png');console.log('[FIXED] Element: <a> - http://marc.cortinasval.cat/blog/wp-content/uploads/2014/03/Marvel.png => https://marc.cortinasval.cat/blog/wp-content/uploads/2014/03/Marvel.png');console.log('[FIXED] Element: <a> - http://marc.cortinasval.cat/blog/wp-content/uploads/2014/03/CloudfrontDashboard.png => https://marc.cortinasval.cat/blog/wp-content/uploads/2014/03/CloudfrontDashboard.png');console.log('[FIXED] Element: <a> - http://marc.cortinasval.cat/blog/wp-content/uploads/2014/03/AkamaiDashboard.png => https://marc.cortinasval.cat/blog/wp-content/uploads/2014/03/AkamaiDashboard.png');console.log('[FIXED] Element: <a> - http://marc.cortinasval.cat/blog/wp-content/uploads/2013/12/Varnish_subroutines_Graph.png => https://marc.cortinasval.cat/blog/wp-content/uploads/2013/12/Varnish_subroutines_Graph.png');console.log('[FIXED] Element: <a> - http://marc.cortinasval.cat/blog/wp-content/uploads/2013/12/la-foto.jpg => https://marc.cortinasval.cat/blog/wp-content/uploads/2013/12/la-foto.jpg');console.log('[FIXED] Element: <a> - http://marc.cortinasval.cat/blog/wp-content/uploads/2013/11/tmux_magento.gif => https://marc.cortinasval.cat/blog/wp-content/uploads/2013/11/tmux_magento.gif');console.log('[FIXED] Element: <a> - http://marc.cortinasval.cat/blog/wp-content/uploads/2013/08/haproxy.png => https://marc.cortinasval.cat/blog/wp-content/uploads/2013/08/haproxy.png');console.log('[FIXED] Element: <img> http://marc.cortinasval.cat/blog/wp-content/uploads/2013/03/fisicalLB-300x203.png => https://marc.cortinasval.cat/blog/wp-content/uploads/2013/03/fisicalLB-300x203.png');console.log('[FIXED] Element: <img> http://marc.cortinasval.cat/blog/wp-content/uploads/2013/03/funcional-300x179.png => https://marc.cortinasval.cat/blog/wp-content/uploads/2013/03/funcional-300x179.png');console.log('[FIXED] Element: <img> http://marc.cortinasval.cat/blog/wp-content/uploads/2014/03/ElasticHead.png => https://marc.cortinasval.cat/blog/wp-content/uploads/2014/03/ElasticHead.png');console.log('[FIXED] Element: <img> http://marc.cortinasval.cat/blog/wp-content/uploads/2014/03/Marvel.png => https://marc.cortinasval.cat/blog/wp-content/uploads/2014/03/Marvel.png');console.log('[FIXED] Element: <img> http://marc.cortinasval.cat/blog/wp-content/uploads/2014/03/CloudfrontDashboard.png => https://marc.cortinasval.cat/blog/wp-content/uploads/2014/03/CloudfrontDashboard.png');console.log('[FIXED] Element: <img> http://marc.cortinasval.cat/blog/wp-content/uploads/2014/03/AkamaiDashboard.png => https://marc.cortinasval.cat/blog/wp-content/uploads/2014/03/AkamaiDashboard.png');console.log('[FIXED] Element: <img> http://marc.cortinasval.cat/blog/wp-content/uploads/2013/12/Varnish_subroutines_Graph.png => https://marc.cortinasval.cat/blog/wp-content/uploads/2013/12/Varnish_subroutines_Graph.png');console.log('[FIXED] Element: <img> http://marc.cortinasval.cat/blog/wp-content/uploads/2013/12/la-foto.jpg => https://marc.cortinasval.cat/blog/wp-content/uploads/2013/12/la-foto.jpg');console.log('[FIXED] Element: <img> http://marc.cortinasval.cat/blog/wp-content/uploads/2013/11/tmux_magento.gif => https://marc.cortinasval.cat/blog/wp-content/uploads/2013/11/tmux_magento.gif');console.log('[FIXED] Element: <img> http://marc.cortinasval.cat/blog/wp-content/uploads/2013/08/haproxy.png => https://marc.cortinasval.cat/blog/wp-content/uploads/2013/08/haproxy.png');console.log('[END WordPress HTTPS Debug Log]');}</script>
<script pagespeed_no_defer="">//<![CDATA[

pagespeed.addInstrumentationInit('/mod_pagespeed_beacon', 'load', '', 'http://marc.cortinasval.cat/blog/ca/');
//]]></script></body>
</html>	