<!DOCTYPE html>
<html lang="ca">
<head>
<title>http | El blog d&#039;en Marc</title>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script type='text/javascript'>window.mod_pagespeed_start = Number(new Date());</script><link rel="profile" href="http://gmpg.org/xfn/11"/>
<link rel="pingback" href="https://marc.cortinasval.cat/blog/xmlrpc.php"/>
<link rel="alternate" type="application/rss+xml" title="El blog d&#039;en Marc &raquo; Feed" href="https://marc.cortinasval.cat/blog/ca/feed/"/>
<link rel="alternate" type="application/rss+xml" title="El blog d&#039;en Marc &raquo; Comments Feed" href="https://marc.cortinasval.cat/blog/ca/comments/feed/"/>
<link rel="alternate" type="application/rss+xml" title="El blog d&#039;en Marc &raquo; http Tag Feed" href="https://marc.cortinasval.cat/blog/tag/http/feed/"/>
<link rel='stylesheet' id='gsc_style-css' href='https://marc.cortinasval.cat/blog/wp-content/plugins/google-custom-search/css/smoothness/jquery-ui.theme.min.css?ver=4.1.1' type='text/css' media='all'/>
<link rel='stylesheet' id='gsc_style_search_bar-css' href='https://www.google.com/cse/style/look/minimalist.css?ver=4.1.1' type='text/css' media='all'/>
<link rel='stylesheet' id='gsc_style_search_bar_more-css' href='https://marc.cortinasval.cat/blog/wp-content/plugins/google-custom-search/css/gsc.css?ver=4.1.1' type='text/css' media='all'/>
<link rel='stylesheet' id='franklin_source_sans-css' href='//fonts.googleapis.com/css?family=Source+Sans+Pro%3A400%2C700%2C900&#038;ver=4.1.1' type='text/css' media='all'/>
<link rel='stylesheet' id='franklin_open_sans-css' href='//fonts.googleapis.com/css?family=Open+Sans%3A400%2C600&#038;ver=4.1.1' type='text/css' media='all'/>
<link rel='stylesheet' id='franklin_bootstrap_css-css' href='https://marc.cortinasval.cat/blog/wp-content/themes/franklin/assets/css/bootstrap.min.css?ver=4.1.1' type='text/css' media='all'/>
<link rel='stylesheet' id='franklin_style-css' href='https://marc.cortinasval.cat/blog/wp-content/themes/franklin/style.css?ver=4.1.1' type='text/css' media='all'/>
<link rel='stylesheet' id='custom-style-css' href='https://marc.cortinasval.cat/blog/wp-content/themes/franklin/assets/css/custom.css?ver=4.1.1' type='text/css' media='all'/>
<style id='custom-style-inline-css'>header,.widget_tag_cloud a:hover,.sticky-img,#primary-menu li ul li{background-color:#20b2aa}a:hover,#primary-menu li:hover a{color:#20b2aa}</style>
<!-- This site uses the Google Analytics by Yoast plugin v5.3.3 - Universal enabled - https://yoast.com/wordpress/plugins/google-analytics/ -->
<script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','__gaTracker');__gaTracker('create','UA-26821552-3','auto');__gaTracker('set','forceSSL',true);__gaTracker('send','pageview');</script>
<!-- / Google Analytics by Yoast -->
<script src='https://marc.cortinasval.cat/blog/wp-includes/js/jquery/jquery.js?ver=1.11.1'></script>
<script src='https://marc.cortinasval.cat/blog/wp-includes/js/jquery/jquery-migrate.min.js?ver=1.2.1'></script>
<script src='https://marc.cortinasval.cat/blog/wp-content/plugins/google-custom-search/js/gsc.js?ver=4.1.1'></script>
<script src='https://www.google.com/jsapi?ver=4.1.1'></script>
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="https://marc.cortinasval.cat/blog/xmlrpc.php?rsd"/>
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="https://marc.cortinasval.cat/blog/wp-includes/wlwmanifest.xml"/>
<meta name="generator" content="WordPress 4.1.1"/>
<script>var _gaq=_gaq||[];_gaq.push(['_setAccount','UA-0000000-0']);_gaq.push(['_trackPageview']);(function(){var ga=document.createElement('script');ga.type='text/javascript';ga.async=true;ga.src=('https:'==document.location.protocol?'https://ssl':'http://www')+'.google-analytics.com/ga.js';var s=document.getElementsByTagName('script')[0];s.parentNode.insertBefore(ga,s);})();</script>
<link rel="stylesheet" href="https://marc.cortinasval.cat/blog/wp-content/plugins/multi-column-tag-map/mctagmap.css?mctm_ver=12.0.4" type="text/css" media="screen"/>
<!--[if lt IE 9]><script src="https://marc.cortinasval.cat/blog/wp-content/themes/franklin/assets/js/html5shiv.js"></script><![endif]--><style id="syntaxhighlighteranchor"></style>
<script pagespeed_no_defer="">//<![CDATA[
(function(){var c=encodeURIComponent,g=window,h="performance";g.pagespeed=g.pagespeed||{};var l=g.pagespeed,m=function(f,a,d,b){this.c=f;this.a=a;this.b=d;this.d=b};l.beaconUrl="";
var n=function(f){var a=f.c,d=g.mod_pagespeed_start,b=Number(new Date)-d,a=a+(-1==a.indexOf("?")?"?":"&"),a=a+"ets="+("load"==f.a?"load:":"unload:"),a=a+b;if("beforeunload"!=f.a||!g.mod_pagespeed_loaded){a+="&r"+f.a+"=";if(g[h]){var b=g[h].timing,e=b.navigationStart,k=b.requestStart,a=a+(b[f.a+"EventStart"]-e),a=a+("&nav="+(b.fetchStart-e)),a=a+("&dns="+(b.domainLookupEnd-b.domainLookupStart)),a=a+("&connect="+(b.connectEnd-b.connectStart)),a=a+("&req_start="+(k-e)),a=a+("&ttfb="+(b.responseStart-
k)),a=a+("&dwld="+(b.responseEnd-b.responseStart)),a=a+("&dom_c="+(b.domContentLoadedEventStart-e));g[h].navigation&&(a+="&nt="+g[h].navigation.type);e=-1;b.msFirstPaint?e=b.msFirstPaint:g.chrome&&g.chrome.loadTimes&&(e=Math.floor(1E3*g.chrome.loadTimes().firstPaintTime));e=e-k;0<=e&&(a+="&fp="+e)}else a+=b;l.getResourceTimingData&&g.parent==g&&(a+=l.getResourceTimingData());a+=g.parent!=g?"&ifr=1":"&ifr=0";"load"==f.a&&(g.mod_pagespeed_loaded=!0,(b=g.mod_pagespeed_num_resources_prefetched)&&(a+=
"&nrp="+b),(b=g.mod_pagespeed_prefetch_start)&&(a+="&htmlAt="+(d-b)));l.panelLoader&&(d=l.panelLoader.getCsiTimingsString(),""!=d&&(a+="&b_csi="+d));l.criticalCss&&(d=l.criticalCss,a+="&ccis="+d.total_critical_inlined_size+"&cces="+d.total_original_external_size+"&ccos="+d.total_overhead_size+"&ccrl="+d.num_replaced_links+"&ccul="+d.num_unreplaced_links);""!=f.b&&(a+=f.b);document.referrer&&(a+="&ref="+c(document.referrer));a+="&url="+c(f.d);l.beaconUrl=a;(new Image).src=a}};
l.e=function(f,a,d,b){var e=new m(f,a,d,b);g.addEventListener?g.addEventListener(a,function(){n(e)},!1):g.attachEvent("on"+a,function(){n(e)})};l.addInstrumentationInit=l.e;})();

pagespeed.addInstrumentationInit('/mod_pagespeed_beacon', 'beforeunload', '', 'http://marc.cortinasval.cat/blog/tag/http/');
//]]></script></head>
<body class="archive tag tag-http tag-22">
<header role="banner">
<div id="top-bar" role="navigation">
<div class="container">
<div class="row">
<div id="site-description" class="col-xs-12 col-sm-12 col-md-12 col-lg-6">
<p>Tal com raja&#8230;.</p>
</div>
<div class="col-sm-12 col-md-12 col-lg-6">
<form id="header-search" role="search" class="search-form form-inline" action="https://marc.cortinasval.cat/blog/ca/">
<input type="search" class="search-field" value="" name="s"/>
<button type="submit"><span class="glyphicon glyphicon-search"></span></button>
</form>
</div>
</div>
</div>
</div>
<div id="bot-bar" class="container">
<div class="row">
<div id="logo" class="col-md-12 col-lg-3">
<button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
<span class="sr-only">Toggle navigation</span>
<span class="icon-bar"></span>
<span class="icon-bar"></span>
<span class="icon-bar"></span>
</button>
<a href="https://marc.cortinasval.cat/blog/ca/" rel="home">El blog d&#039;en Marc</a>
</div>
<div id="primary-menu" class="col-md-12 col-lg-9" role="navigation">
<div class="collapse navbar-collapse">
<ul id="menu-principal" class="menu"><li id="menu-item-10" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-10"><a href="https://marc.cortinasval.cat/blog/category/sysadmin/">SysAdmin</a></li>
<li id="menu-item-11" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-11"><a href="https://marc.cortinasval.cat/blog/category/tecno/">Tecnologia</a></li>
<li id="menu-item-12" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-12"><a href="https://marc.cortinasval.cat/blog/category/varis/">Varis</a></li>
<li id="menu-item-239-en" class="lang-item lang-item-64 lang-item-en no-translation menu-item menu-item-type-custom menu-item-object-custom menu-item-239-en"><a href="https://marc.cortinasval.cat/blog/en/" hreflang="en"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAALCAIAAAD5gJpuAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAHzSURBVHjaYkxOP8IAB//+Mfz7w8Dwi4HhP5CcJb/n/7evb16/APL/gRFQDiAAw3JuAgAIBEDQ/iswEERjGzBQLEru97ll0g0+3HvqMn1SpqlqGsZMsZsIe0SICA5gt5a/AGIEarCPtFh+6N/ffwxA9OvP/7//QYwff/6fZahmePeB4dNHhi+fGb59Y4zyvHHmCEAAAW3YDzQYaJJ93a+vX79aVf58//69fvEPlpIfnz59+vDhw7t37968efP3b/SXL59OnjwIEEAsDP+YgY53b2b89++/awvLn98MDi2cVxl+/vl6mituCtBghi9f/v/48e/XL86krj9XzwEEEENy8g6gu22rfn78+NGs5Ofr16+ZC58+fvyYwX8rxOxXr169fPny+fPn1//93bJlBUAAsQADZMEBxj9/GBxb2P/9+S/R8u3vzxuyaX8ZHv3j8/YGms3w8ycQARmi2eE37t4ACCDGR4/uSkrKAS35B3TT////wADOgLOBIaXIyjBlwxKAAGKRXjCB0SOEaeu+/y9fMnz4AHQxCP348R/o+l+//sMZQBNLEvif3AcIIMZbty7Ly6t9ZmXl+fXj/38GoHH/UcGfP79//BBiYHjy9+8/oUkNAAHEwt1V/vI/KBY/QSISFqM/GBg+MzB8A6PfYC5EFiDAABqgW776MP0rAAAAAElFTkSuQmCC" title="English" alt="English"/>&nbsp;English</a></li>
</ul>	</div>
</div>
</div>
</div>
</header>
<div id="content" class="container"><div class="row" role="main">
<div class="col-md-8">
<article id="post-84" class="post-84 post type-post status-publish format-standard hentry category-sysadmin category-tecno tag-cache tag-http tag-varnish tag-web">
<h3 class="post-title"><a href="https://marc.cortinasval.cat/blog/2013/12/17/varnish-cache-un-molt-bon-aliat-per-a-la-web/" rel="bookmark">varnish-cache, un molt bon aliat per a la web</a></h3><p>Ja fa un parell d&#8217;anys que faig servir el varnish cache i Ã©s un molt bon aliat de qualsevol plataforma web per descarregar als servidors http (apache, nginx, lighthttpd, etc&#8230; ) i al backend, ja sigui per aplicacions amb poc trÃ fic com per aplicacions/plataformes d&#8217;alt rendiment, on pot ser un CLAU aliat. </p>
<p>Per aixÃ², en aquest post enumenarem les raons principals d&#8217;implantar el varnish, citarem els processos i posarem 4 exemples de configuracions amb diferents proposits.</p>
<p>Bueno, comenÃ§arÃ© enumerant les 3 funcionalitats principals:<br/>
&#8211; Accelerador de continguts web, minimitzant considerablement els temps mitjans de resposta dels continguts dinamics d&#8217;un site.<br/>
&#8211; Alliberar de cÃ rrega el backend, des dels servidors web i sobretot a les bases de dades, sql i nosql.<br/>
&#8211; Permetre servir continguts &#8220;caducats&#8221; en cas que la plataforma tingui problemes de rendiment.</p>
<p>Altres funcionalitats mÃ©s avanÃ§ades que podem fer amb Varnish es,<br/>
&#8211; Si treballeu amb CDNs pot fer el paper d&#8217;amortidor en moments de canvis bruscos de trÃ fic, per exemple, un campanya amb molt Ã¨xit, una noticia important, etc&#8230;<br/>
&#8211; Securitzar el website, per segons quines parts de la web podem exigir que les peticions haguin de complir uns determinats requeriments. AixÃ² tambÃ© ho pot fer el apache, perÃ² aixi el podem alliberar d&#8217;aquestes tasques.<br/>
&#8211; En plataformes d&#8217;alt rendiment, si treballeu amb CDNs, per bloquejar l&#8217;accÃ©s a determinades parts de les webs que no es puguin processar per averia en el sistema.</p>
<p>Segur que podeu trobar altres funcionalitats, aquestes sÃ³n les que he utilitzat.</p>
<p>La filosofia del Varnish es emmagatzemar a memÃ²ria volÃ til tots els cantinguts &#8220;cachejables&#8221; i estalviar de cicles de proces i cicles d&#8217;espera d&#8217;entrada i sortida, es a dir, l&#8217;equiliri IO-CPU-RAM es veurÃ  afectat aixÃ­: disminuim IO, disminuim us de CPU, increment Ãºs de memoria, on Ã©s molt important dimensionar bÃ© la memÃ²ria que utilitzarem.</p>
<p>Un dels principals inconvenients dels Varnish Ã©s el HTTPS, encara que tÃ© el sentit. Varnish Ã©s un accelerador de continguts HTTP que vol disminuir el temps de resposta, el httpS Ã©s el contrari, requereix de temps de proces per a tal d&#8217;assegurar la seguretat. ConclusiÃ³, Varnish no es capaÃ§ i no ho serÃ  mai de servir contignut per HTTPS. NomÃ©s el podrem fer servir per aquelles parts del website que no siguin segures. <a href=http://marc.cortinasval.cat/blog/2013/12/01/balancejador-https-economic-nginxhaproxypacemaker/>TambÃ© ho podeu utilitzar en parts de la web segures si poseu un nginx per davant, en aquest altre post teniu explicat millor aquesta soluciÃ³.</a></p>
<p>D&#8217;altra banda, la corba d&#8217;aprenentatge del varnish es considerable, de fet, un graph em va ajudar a entendre totes les transicions possibles, es a dir, Ã©s el tipic aliat que si el compliquem molt es pot tornar en enemic. <a href=https://www.varnish-software.com/static/book/Tuning.html>De fet, el varnish sÃ³n 2 procesos un pare i un fill (fork), on el pare fa el paper de gestiÃ³ i compila les configuracion escrites amb llenguatge VCL i el fill Ã©s qui realment fa realment les funcions descrites en la configuracio VCL. En aquest link ho explica detalladament.</a></p>
<p><a href=https://www.varnish-cache.org/docs/3.0/tutorial/vcl.html#>Es a dir, la clau del varnish, Ã©s escriure un VCL amb allÃ² que realment necessitem que faci. Aqui us deixo un graph que vaig decidir fer un cop vaig llegir la documentaciÃ³ oficial del varnish d&#8217;aquest link.</a><br/>
<a href="https://marc.cortinasval.cat/blog/wp-content/uploads/2013/12/Varnish_subroutines_Graph.png"><img src="https://marc.cortinasval.cat/blog/wp-content/uploads/2013/12/Varnish_subroutines_Graph.png" alt="Varnish_subroutines_Graph" width="1302" height="768" class="aligncenter size-full wp-image-347"/></a></p>
<p>Seguidament posarem 3 exemples de fitxers basics de VCL i comentarem la seva finalitat:</p>
<p><strong>Exemple 1</strong></p>
<pre class="brush: plain; title: ; notranslate" title="">
backend default {
  .host = &quot;127.0.0.1&quot;;
  .port = &quot;8080&quot;;
  .max_connections = 40;
  .first_byte_timeout = 180s;
  .between_bytes_timeout = 180s;
}

sub vcl_recv {
      return(pass);
}
</pre>
<p>Aquesta configuraciÃ³ l&#8217;Ãºnic que voliem Ã©s limitar la quantitat de connexions(max_connections) que li passarem al un apache en local, en aquest cap no cachejem res.</p>
<p><strong>Exemple 2</strong></p>
<pre class="brush: plain; title: ; notranslate" title="">
backend default {
  .host = &quot;127.0.0.1&quot;;
  .port = &quot;8080&quot;;
  .max_connections = 200;
  .connect_timeout = 180s;
  .first_byte_timeout = 180s;
  .between_bytes_timeout = 180s;
  .probe = {
    .url = &quot;/healthcheck.php&quot;;
    .timeout = 100 ms;
    .interval = 1s;
    .window = 10;
    .threshold = 8;
  }
}

sub vcl_recv {
  if (req.http.Host == &quot;setup.domain.com&quot;)
  {
    set req.grace = 30s;
    return(lookup);
  }
  else
  {
   return(pass);
  }
}

sub vcl_fetch {
  set beresp.grace = 1h;
}
</pre>
<p>En aquest exemple nomÃ©s cachejem les peticions del domini &#8220;setup.domain.com&#8221;, domini intern de la plataforma que serveix les configuracions de l&#8217;aplicaciÃ³. AdemÃ©s, volem que si el backend no respon, seguiran sen vÃ lids durant 1 hora. AixÃ² ho conseguim en les tres Ãºltimes linies de codi. <a href=http://www.tomas.cat/blog/ca/configuraciÃ³-bÃ sica-de-varnish-amb-http-cache-i-stale-while>El meu company Tomas tÃ© un article on exemplifica molt bÃ© aquest comportament. Una de les coses mÃ©s interessants del article de TomÃ s es diferenciar les dues situacions en les que aquest parametre es important.</a><br/>
&#8211; No hi ha cap backend disponible, per tant servim contingut antic.<br/>
&#8211; Hi ha backends disponibles, i un fil ja ha demanat nou contingut. Mentre aquest nou contingut arriba des del backend, el varnish continua servint l&#8217;antic a la resta de fils.</p>
<p><strong>Exemple 3</strong></p>
<pre class="brush: plain; title: ; notranslate" title="">
sub vcl_recv {
â¦
        if (req.url ~ &quot;.*remindmethepassword.*&quot; &amp;&amp; !req.http.User-Agent) {
            error 403 &quot;Forbidden&quot;;
        }
â¦
        return(pass);
}
</pre>
<p>En el exemple anterior, podem aferir-hi regles que augmentent la seguretat, per exemple, en les peticions que tinguin remindmethepassword en la URL necessitaran tenir el User-Agent, sino retornem un 403.</p>
<p><strong>Exemple 4</strong></p>
<pre class="brush: plain; title: ; notranslate" title="">
backend default {
  .host = &quot;127.0.0.1&quot;;
  .port = &quot;8080&quot;;
  .max_connections = 200;
  .connect_timeout = 180s;
  .first_byte_timeout = 180s;
  .between_bytes_timeout = 180s;
  .probe = {
    .url = &quot;/healthcheck.php&quot;;
    .timeout = 10 ms;
    .interval = 5s;
    .window = 5;
    .threshold = 3;
  }
}

sub vcl_error {
}

sub vcl_recv {
     if (req.restarts == 0) {
       if (req.http.x-forwarded-for) {
           set req.http.X-Forwarded-For =
               req.http.X-Forwarded-For + &quot;, &quot; + client.ip;
       } else {
           set req.http.X-Forwarded-For = client.ip;
       }
     }
     if (req.request != &quot;GET&quot; &amp;&amp;
       req.request != &quot;HEAD&quot; &amp;&amp;
       req.request != &quot;PUT&quot; &amp;&amp;
       req.request != &quot;POST&quot; &amp;&amp;
       req.request != &quot;TRACE&quot; &amp;&amp;
       req.request != &quot;OPTIONS&quot; &amp;&amp;
       req.request != &quot;DELETE&quot;) {
         /* Non-RFC2616 or CONNECT which is weird. */
         return (pipe);
     }
     if (req.request != &quot;GET&quot; &amp;&amp; req.request != &quot;HEAD&quot; &amp;&amp; req.request != &quot;POST&quot; ) {
         /* We only deal with GET and HEAD by default */
         return (pass);
     }
   set req.grace = 30s;
    return(lookup);
}

sub vcl_fetch {
     if (beresp.ttl &lt;= 0s ||
         beresp.http.Vary == &quot;*&quot;) {
               return (hit_for_pass);
     }
 if(beresp.ttl &gt; 0s){  unset beresp.http.Set-Cookie;}

  set beresp.grace = 1h;
  return(deliver);
}
</pre>
<p>En aquest exemple ja comenÃ§a a ser mÃ©s complert:<br/>
&#8211; limitat a 200 connexions, a mÃ©s peticions, retornem 503.<br/>
&#8211; accepted petitions GET, HEAD, PUT, POST, TRACE, OPTIONS, DELETE.<br/>
&#8211; cachejem GET, POST, HEAD segons les capceleres HTTP que emet el backend<br/>
&#8211; en el moment en que anem a buscar un objecte en la cache, eliminem les capÃ§eleres Set-Cookie<br/>
&#8211; tindrem 1 hora els elements en la cache, en cas que el backend estigui caigut o no respongui</p>
<p>Finalment, el ideal seria tenir ben segmentada la plana web amb les diferents seccions i tenir identificades les url&#8217;s de cadascuna d&#8217;elles facilitant aixÃ­:<br/>
&#8211; La propia aplicaciÃ³ generi les capÃ§eleres HTTP adecuades especificant quant de temps serÃ  vÃ lid el contingut, segons quines secciÃ³ns o accions tindrem uns temps de caducitat diferents<br/>
&#8211; La propia aplicaciÃ³ permite caducar/invalidar el contingut en el varnish en les situacions que ho necessitin.<br/>
&#8211; Securitzar les parts de la web que ho requereixin jugant amb les capÃ§eleres</p>
<div class="post-meta clearfix post-meta-list">
<p class="author-date">
<span class="glyphicon glyphicon-user"></span> mcortinas
<span class="glyphicon glyphicon-calendar"></span> Desembre 17, 2013
</p>
<p class="post-tags"><span class="glyphicon glyphicon-tags"></span><a href="https://marc.cortinasval.cat/blog/tag/cache/">cache</a> <span class="slash"> / </span><a href="https://marc.cortinasval.cat/blog/tag/http/">http</a> <span class="slash"> / </span><a href="https://marc.cortinasval.cat/blog/tag/varnish/">varnish</a> <span class="slash"> / </span><a href="https://marc.cortinasval.cat/blog/tag/web/">web</a> <span class="slash"> / </span></p>
</div>
</article>
<hr class="post-divider"><article id="post-25" class="post-25 post type-post status-publish format-standard hentry category-sysadmin category-tecno tag-balance tag-centos tag-corosync tag-ha tag-haproxy tag-http tag-https tag-nginx tag-pacemaker tag-vmware">
<div class="sticky-txt "><span class="glyphicon glyphicon-star"></span> Featured Post</div>
<h3 class="post-title"><a href="https://marc.cortinasval.cat/blog/2013/12/04/balancejador-https-economic-nginxhaproxypacemaker/" rel="bookmark">Balancejador HTTP/S econÃ²mic: Nginx+Haproxy+Pacemaker</a></h3><p>Seguidament us explicarÃ© com es pot montar un balancejador httpS molt econÃ²mic i molt eficient, el qual s&#8217;ha implementat tan en entorns productius com no productius, la motivaciÃ³ inicial del qual va ser centralitzar el balanceig dels diferents entorns d&#8217;integraciÃ³ continua d&#8217;una aplicaciÃ³ web. En entorns productius tambÃ© l&#8217;he implementat desprÃ©s de fer varies probes de rendiment amb el &#8220;ab&#8221; i el &#8220;siege&#8221; .</p>
<p>L&#8217;Ãºnic requeriment que hem d&#8217;asumir Ã©s allotjar tot trÃ fic dels diferents entorns en subdominis d&#8217;un domini (p.e.example.com), on podem tenir int01.example.com, int02.example.com, test01.example.com, test02.example.com, pre.example.com, etc..</p>
<p>AnÃ logament, en els entorns de producciÃ³, podem fer la mateixa discriminaciÃ³ diferenciant el trÃ fic pels paisos(es.example.com,fr.example.com), plataformes(m.example.com), tipus de contingut(static.example.com).</p>
<p>Els objectius que em vaig marcar van ser:</p>
<li>Baix cost econÃ²mic: utilitzarem programari de codi obert des dels operatius fins als dimonis: CentOS, Nginx, Haproxy, Pacemaker, Corosync.</li>
<li>Alta disponibilitat de maquinari i programari: a nivell de maquinari ho montarem en una infraestructura virtualitzada amb varis nodes fÃ­sics i implemtarem el pacemaker+corosync per a tenir alta disponibilitat en els dimonis.</li>
<li>Centralitzar la negociaciÃ³ SSL de tota la plataforma en un punt inicial i alliberar cÃ rrega SSL del reste de la plataforma.</li>
<li>Permetre mÃ©s flexibilitat i control en els balancejos de cadascÃºn dels entorns: haproxy permet fa possible controlar en un pool de balanceig si un frontal hi estÃ  activat segons el seu nivell de cÃ rrega o si te connexiÃ³ contra la base de dades, per exemple.</li>
<li>Tenir una plataforma securitzada, requeriment essencial sobretot en entorns productius.</li>
<p>Els dimonis que utilitzarem serÃ  Nginx, Haproxy, Pacemaker i Corosync, tot programari lliure on abarata el cost considerablement.</p>
<p>En el segÃ¼ent esquema es veu clarament l&#8217;arquitectura de tot el montatge.</p>
<p><a href="https://marc.cortinasval.cat/blog/wp-content/uploads/2013/03/fisicalLB.png"><img class="size-medium wp-image-64 aligncenter" alt="fisicalLB" src="https://marc.cortinasval.cat/blog/wp-content/uploads/2013/03/fisicalLB-300x203.png" width="300" height="203"/></a></p>
<p>El comento breument, no entrarÃ© en detall en tot, em centro en lo important d&#8217;aquest post. Els navegadors dels usuaris fan les peticions a les empreses que fan de CDN, desprÃ©s aquestes peticions van a parar en la nostra plataforma on filtrarem el trÃ fic amb un firewall. Un cop les peticions sÃ³n filtrades van a parar un nginx. La finalitat del nginx es discriminar el trÃ fic segons el entorn i centralitzar totes les negociacions SSL del trÃ fic HTTPS. Seguidament, les peticions passen a un haproxy on aquest balanceja entre els diferents frontals de cadascun dels entorns.</p>
<p>Per tal de securitzar-ho tot, definirem 3 VLAN&#8217;s, dmz, frontend i backend. Tot el trÃ fic Ã©s filtrat pel firewall, el trÃ fic sortint, el entrant i el trÃ fic entre zones. En la DMZ posarem 2 maquines virtuals CentOs on tindrem els serveis de Nginx i Haproxy en actiu-passiu utlitzant pacemaker-corosync. En el frontend tenim els frontals de cadascun dels entorns i en el backend tenim les dades, mysql, cassandras, mongos, nfs, cifs, etc&#8230;.</p>
<p>Per exemplificar-ho millor, ens centrarem nomÃ©s en un entorn, int01.example.com.</p>
<p>Primerament en la DMZ montarem una 2 mÃ quines virtuals on hi tindrem 2 ip flotants, una per el nginx i l&#8217;altre pel haproxy. Jo ho he implemetat en una infraestructura virtualitzada vmware perÃ² tambÃ© es poden montar solucions mÃ©s econÃ²miques com XenServer, KVM, etc&#8230; Evidentment, sigui quina sigui la soluciÃ³ de virtualitzaciÃ³, hem d&#8217;assegurar-nos que les mÃ quines virtuales sempre estÃ n corrent en mÃ quines fÃ­siques diferents.</p>
<p>Les peticions entraran en la ip flotant del nginx, el nginx tÃ© dues funcions, centralitzar la negociaciÃ³ SSL i discriminar el trÃ fic per entorns. En el trÃ fic HTTPS afegirem una capÃ§alera HTTP &#8220;X-forwarded-proto: https&#8221;, on l&#8217;apache la recollirÃ  i activarÃ  la variable HTTPS emmascarant-li a la aplicaciÃ³. El tipus de certificat que afegirem en el nginx serÃ  un certificat signat per una entitat certificadora oficial on el Common-Name que utilitzarem serÃ  de tipus wildcard, es a dir, per aquest exemple, &#8220;*.example.com&#8221;, aixÃ² ens facilitza molt la gestiÃ³ del certificats i ens dona molta facilitat de gestiÃ³. En entorns de producciÃ³ ho dimensionem assignant els valors correctes de <a href="http://wiki.nginx.org/CoreModule#worker_processes" onclick="__gaTracker('send', 'event', 'outbound-article', 'http://wiki.nginx.org/CoreModule#worker_processes', 'worker_processes');">worker_processes</a><strong>Â </strong>i <a href="http://wiki.nginx.org/EventsModule#worker_connections" onclick="__gaTracker('send', 'event', 'outbound-article', 'http://wiki.nginx.org/EventsModule#worker_connections', 'worker_connections');">worker_connections</a> tenint en compte la formula:Â max clients = worker_processes * worker_connections/4.</p>
<p>Seguidament les peticions passen al haproxy on aquest balanceja entre els diferents frontals de cadascun del entorn. El haproxy ens permet estriar l&#8217;algorisme de balanceig, jo acostumo a utilitzar Round Robin. A mÃ©s, podem prefixar els rangs de IPs dels frontals que hi hauran en cadascun dels entorns, aixÃ­ podem desplegar mÃ©s frontals en el cas que sigui necessari sense haber de reinicilitzar el dimoni.<br/>
Haproxy fara una peticiÃ³ a un php que hi ha en cadascun dels frontals on retorna un &#8220;OK&#8221; si no estÃ  swapejant, no tÃ© molta cÃ rrega i tÃ© conectivitat en les bases de dades. Cal remarcar que haproxy tambÃ© ens permet realitzar balancejos &#8220;sticky&#8221; tan en aplicacions JAVA com PHP, depenentment d&#8217;una capÃ§alara HTTP, habitualment les capÃ§aleres JSESSIONID i PHPSESSID respectivament. (en apps ASP teniem ASPSESSIONID). <a href="http://code.google.com/p/haproxy-docs/wiki/maxconn" onclick="__gaTracker('send', 'event', 'outbound-article', 'http://code.google.com/p/haproxy-docs/wiki/maxconn', 'En entorns de producciÃ³ fixarem la variable maxconn tenim en compte que cada peticiÃ³ consumeix 17kb.');">En entorns de producciÃ³ fixarem la variable maxconn tenim en compte que cada peticiÃ³ consumeix 17kb.</a></p>
<p>Finalment les peticions arriben als frontals on primerament passen pel varnish i les peticions que no siguin cachejables arribaran finalment al apache, crec que aquests dos dimonis es mereixen un post especial per ells dos, que ja tinc en el backlog del blog.</p>
<p>En el segÃ¼ent diagrama clarifica tota l&#8217;arquitectura:</p>
<div id="attachment_68" style="width: 310px" class="wp-caption aligncenter"><a href="https://marc.cortinasval.cat/blog/wp-content/uploads/2013/03/funcional.png" target="_blank"><img class="size-medium wp-image-68 " title="Diagrama LÃ²gic" alt="Diagrama LÃ²gic" src="https://marc.cortinasval.cat/blog/wp-content/uploads/2013/03/funcional-300x179.png" width="300" height="179"/></a><p class="wp-caption-text">Diagrama LÃ²gic</p></div>
<p>Seguidament posarÃ© les configuracions mÃ©s importants, Nginx, Haproxy, Pacemaker:</p>
<p>Parametres del Nginx</p>
<pre class="brush: plain; title: ; notranslate" title="">
....
upstream http-example-int01 {
    server lb2-vip.example.com:8080;
    keepalive 16;
}
server {
        listen lb1-vip.example.com:80;
    server_name int01.example.com ~^.*-int01\.example\.com$;

        location / {
                proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
                proxy_set_header Host $host;
                proxy_pass http://http-example-int01/;
                proxy_redirect off;
        }
}
server {
        listen lb1-vip.example.com:443 ssl;
    server_name int01.example.com ~^.*-int01\.example\.com$;

        ssl on;
        ssl_certificate /etc/nginx/ssl/crt/concat.pem;
        ssl_certificate_key /etc/nginx/ssl/key/example.key;

        location / {
                proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
                proxy_set_header X-Forwarded-Proto https;
                proxy_set_header Host $host;
                proxy_pass http://http-example-int01/;
                proxy_redirect off;
        }
}
....
</pre>
<p>Parametres del Haproxy</p>
<pre class="brush: plain; title: ; notranslate" title="">
...
frontend example-int01 lb2-vip.grpprod.com:8080
    default_backend example-int01
backend  example-int01
        option forwardfor
        option httpchk GET /healthcheck.php
        http-check expect string OK
        server  web01 x.y.z.w:80 check inter 2000 fall 3
        server  web02 x.y.z.w:80 check inter 2000 fall 3
        server  web03 x.y.z.w:80 check inter 2000 fall 3
        server  web04 x.y.z.w:80 check inter 2000 fall 3
        server  web05 x.y.z.w:80 check inter 2000 fall 3
...
</pre>
<p>Parametres del Apache</p>
<pre class="brush: plain; title: ; notranslate" title="">

 ServerName int01.example.com
    DocumentRoot &quot;/srv/www/example/fa-front/public&quot;

   &lt;Directory &quot;/srv/www/example/fa-front/public&quot;&gt;
      Options -Indexes FollowSymLinks
      AllowOverride None
      Allow from All
      Order Allow,Deny
      RewriteEngine On
      RewriteCond %{HTTP:X-Forwarded-Proto} https
      RewriteRule .* - [E=HTTPS:on]

      RewriteCond %{REQUEST_FILENAME} -s [OR]
      RewriteCond %{REQUEST_FILENAME} -l [OR]
      RewriteCond %{REQUEST_FILENAME} -d
      RewriteRule ^.*$ - [NC,L]
      RewriteRule ^.*$ index.php [NC,L]

   SetEnv APPLICATION_ENV int01
   DirectoryIndex index.php

   LogFormat &quot;%v %{Host}i %h %l %u %t \&quot;%r\&quot; %&gt;s %b %{User-agent}i&quot; marc.int01
   CustomLog /var/log/httpd/cloud-example-front.log example

</pre>
<p>Parametres del Pacemaker</p>
<pre class="brush: plain; title: ; notranslate" title="">
node balance01
node balance02
primitive nginx lsb:nginx \
        op monitor interval=&quot;1s&quot; \
        meta target-role=&quot;Started
primitive haproxy lsb:haproxy \
        op monitor interval=&quot;1s&quot; \
        meta target-role=&quot;Started&quot;
primitive lb1-vip ocf:heartbeat:IPaddr2 \
        params ip=&quot;x.x.x.x&quot; iflabel=&quot;nginx-vip&quot; cidr_netmask=&quot;32&quot; \
        op monitor interval=&quot;1s&quot;
primitive lb2-vip ocf:heartbeat:IPaddr2 \
        params ip=&quot;y.y.y.y&quot; iflabel=&quot;haproxy-vip&quot; cidr_netmask=&quot;32&quot; \
        op monitor interval=&quot;1s&quot;
group haproxy_cluster lb2-vip haproxy \
        meta target-role=&quot;Started&quot;
group nginx_cluster lb1-vip  nginx \
        meta target-role=&quot;Started&quot;
property $id=&quot;cib-bootstrap-options&quot; \
        dc-version=&quot;1.1.7-6.el6-148fccfd5985c5590cc601123c6c16e966b85d14&quot; \
        cluster-infrastructure=&quot;openais&quot; \
        expected-quorum-votes=&quot;2&quot; \
        stonith-enabled=&quot;false&quot; \
        last-lrm-refresh=&quot;1355137974&quot; \
        no-quorum-policy=&quot;ignore&quot;
rsc_defaults $id=&quot;rsc-options&quot; \
        resource-stickiness=&quot;100&quot;
</pre>
<div class="post-meta clearfix post-meta-list">
<p class="author-date">
<span class="glyphicon glyphicon-user"></span> mcortinas
<span class="glyphicon glyphicon-calendar"></span> Desembre 4, 2013
</p>
<p class="post-tags"><span class="glyphicon glyphicon-tags"></span><a href="https://marc.cortinasval.cat/blog/tag/balance/">balance</a> <span class="slash"> / </span><a href="https://marc.cortinasval.cat/blog/tag/centos/">centos</a> <span class="slash"> / </span><a href="https://marc.cortinasval.cat/blog/tag/corosync/">corosync</a> <span class="slash"> / </span><a href="https://marc.cortinasval.cat/blog/tag/ha/">ha</a> <span class="slash"> / </span><a href="https://marc.cortinasval.cat/blog/tag/haproxy/">haproxy</a> <span class="slash"> / </span><a href="https://marc.cortinasval.cat/blog/tag/http/">http</a> <span class="slash"> / </span><a href="https://marc.cortinasval.cat/blog/tag/https/">https</a> <span class="slash"> / </span><a href="https://marc.cortinasval.cat/blog/tag/nginx/">nginx</a> <span class="slash"> / </span><a href="https://marc.cortinasval.cat/blog/tag/pacemaker/">pacemaker</a> <span class="slash"> / </span><a href="https://marc.cortinasval.cat/blog/tag/vmware/">vmware</a> <span class="slash"> / </span></p>
</div>
</article>
<hr class="post-divider"><article id="post-122" class="post-122 post type-post status-publish format-standard hentry category-sysadmin category-tecno category-varis tag-amazon tag-apache tag-blog tag-cdn tag-cloud tag-cloudflare tag-dns tag-ec2 tag-google tag-gybo tag-http tag-httpd tag-https tag-mod_spdy tag-puntcat tag-s3 tag-spdy tag-wordpress">
<h3 class="post-title"><a href="https://marc.cortinasval.cat/blog/2013/07/21/blog-personal-amb-domini-cat-propi-distribucio-i-hospedatge-per-menys-de-7eany/" rel="bookmark">blog personal amb domini .CAT propi, distribuciÃ³ i hospedatge per menys de 7â¬/any</a></h3><p>Avui Ã©s un dia tristÂ professionalmentÂ parlant perquÃ¨ el passat divendres en Tomas NuÃ±ez, company de feina amb qui m&#8217;ho he passat molt bÃ© durant els darrers 2 anys, va finalitzar el contracte i ha marxat al Canada a comenÃ§ar una novaÂ experiÃ¨nciaÂ  aprofito el post per desitjar-li tota la bona sort en la seva nova aventura on estic convenÃ§ut que s&#8217;ho passarÃ  molt bÃ©!</p>
<p>A mÃ©s,Â tambÃ©Â cal remarcar que la motivaciÃ³ inicial deÂ trastejarÂ tot l&#8217;esmentat en aquest post vaÂ nÃ©ixerÂ sopant amb els ex-companys de la EGB, on un d&#8217;ells, l&#8217;Estanis Plantada, un geÃ²graf viatgerÂ apassionatÂ de la bicicleta vol fer montar-se un site per anar publicant les sevesÂ experiÃ¨ncies.</p>
<p>Dit aixÃ², vaig per feina, en aquest post us explicarÃ© com publicar un blog (en el meu cas el que tenia en la RaspberryPi) en el &#8220;cloud&#8221; (Amazon) on l&#8217;hiÂ trauremÂ un millor rendiment per menys de 8â¬ el primer any, no entrarÃ© molt en detall tÃ¨cnic, Ãºnicament el que Ã©s important Ã©s tenir recopilades TOTES les funcionalitats implementades amb un cost molt baix, alhora, recopilo els links de les diferents fonts que he anat coneixent i jugant. Per a cada punt teniu el link de les fonts consultades on he tret la informaciÃ³.</p>
<ul>
<ul>
<li><span style="font-size: 1rem; line-height: 1.714285714;">Registre de domini</span></li>
</ul>
</ul>
<p>En poc menys d&#8217;uns mesos els dominis .puntCAT han baixat molt el seu preu, vaig repassar els registradors i el mÃ©s econÃ²mic va ser <a href="https://www.cdmon.com/" onclick="__gaTracker('send', 'event', 'outbound-article', 'https://www.cdmon.com/', 'CDMON');" title="CDmon" target="_blank">CDMON</a> que per 6.95â¬. Els <a href="http://www.gybo.com/" onclick="__gaTracker('send', 'event', 'outbound-article', 'http://www.gybo.com/', 'amics de Google han llenÃ§at als EUA, Canada i ha algun paÃ­s mÃ©s el projecte GYBO');" target="_blank">amics de Google han llenÃ§at als EUA, Canada i ha algun paÃ­s mÃ©s el projecte GYBO</a>, on pots conseguir gratis el primer any el registre de un 1 domini amb TLD del tipus .ORG .COM .CA .IN, desprÃ©s val 5$/mes.</p>
<ul>
<ul>
<li>DistribuciÃ³ i securitzaciÃ³ del blog grÃ cies a la CDN de CloudFlare</li>
</ul>
</ul>
<p>Si volem minitzar el trafic entre el usuari final i el hosting que tindrem en Amazon, <a href="http://es.cloudflare.com/plans" onclick="__gaTracker('send', 'event', 'outbound-article', 'http://es.cloudflare.com/plans', 'podem activar gratuitament la funcionalitat de CDN de Cloudfare');" title="Cloudflare" target="_blank">podem activar gratuitament la funcionalitat de CDN de Cloudfare</a>, a mÃ©s, tambÃ© hi afegim un petit control de seguretat. L&#8217;unic inconvenient Ã©s que la versiÃ³ gratuita no soporta la distribuciÃ³ de continguts utilitzant el protocol segur HTTPS.</p>
<ul>
<ul>
<li>Â HostatgeÂ de la web en el &#8220;cloud&#8221; de <a href="http://aws.amazon.com/es/free/terms/" onclick="__gaTracker('send', 'event', 'outbound-article', 'http://aws.amazon.com/es/free/terms/', 'Amazon EC2 gratis el primer any, aquÃ­ tenim les condicions');" title="Amazon EC2 free first year" target="_blank">Amazon EC2 gratis el primer any, aquÃ­ tenim les condicions</a></li>
</ul>
</ul>
<p>MuntemÂ un node virtual en Amazon EC2 on hi posarem el blog (en el meu cas he migrat el blog de la RaspberryPi), aquÃ­ Ã©s on els tÃ¨cnics posem mÃ©s de la nostre part :). A mÃ©s, cal remarcar que tindrem control total d&#8217;una maquina virtual en 1 dels CPD&#8217;s, molt Ãºtil per qualsevol tÃ¨cnic que ho munti on ho aprofitarÃ  perÂ trastejar iÂ implementar altres eines (ja podeu estar segurs). A destacar! tenim gratis fins a un volum de 30GB en Amazon S3! (podemÂ muntarÂ un owncloud i ja tenim mÃ©s que GoogleDrive i Dropbox!)</p>
<ul>
<li>TrÃ fic segur i encriptat entre el navegador del usuari final i el servidor del blogÂ <a href="http://www.wpwhitesecurity.com/wordpress-security/generate-self-signed-ssl-certificated-apache-https/" onclick="__gaTracker('send', 'event', 'outbound-article', 'http://www.wpwhitesecurity.com/wordpress-security/generate-self-signed-ssl-certificated-apache-https/', 'amb un certificat SSL auto signat');" title="Self signed CA in Apache" target="_blank">amb un certificat SSL auto signat</a></li>
<li><a href="http://en.wikipedia.org/wiki/SPDY" onclick="__gaTracker('send', 'event', 'outbound-article', 'http://en.wikipedia.org/wiki/SPDY', 'Afegim en el mod_SPDY pels navegadors de Google Chrome');" title="SPDY en chrome, Â¿quant en IE? jajajajaj!" target="_blank">Afegim en el mod_SPDY pels navegadors de Google Chrome</a></li>
<li><a href="http://crlog.info/2011/09/10/install-and-configure-varnish-3-0-1-cache-with-wordpress/" onclick="__gaTracker('send', 'event', 'outbound-article', 'http://crlog.info/2011/09/10/install-and-configure-varnish-3-0-1-cache-with-wordpress/', 'Accelerem la entrega de contingut dinamic afegint el Varnish-Cache');" target="_blank">Accelerem la entrega de contingut dinamic afegint el Varnish-Cache</a></li>
<li><a href="http://www.trickytechs.com/how-to-increase-pagespeed-score-of-wordpress-blog/" onclick="__gaTracker('send', 'event', 'outbound-article', 'http://www.trickytechs.com/how-to-increase-pagespeed-score-of-wordpress-blog/', 'Optimitzem la entrega de fitxers del Blog, ja centrant-nos en el cas de WordPress, activant la compressiÃ³ de JS i el modul de wordpress W3 Total Cache.');" target="_blank">Optimitzem la entrega de fitxers del Blog, ja centrant-nos en el cas de WordPress, activant la compressiÃ³ de JS i el modul de wordpress W3 Total Cache.</a></li>
</ul>
<p>Doncs tot aixÃ² ho tenim muntat en poc mÃ©s d&#8217;unes hores on nomÃ©s hi hem invertit menys de 7â¬!</p>
<div class="post-meta clearfix post-meta-list">
<p class="author-date">
<span class="glyphicon glyphicon-user"></span> mcortinas
<span class="glyphicon glyphicon-calendar"></span> Juliol 21, 2013
</p>
<p class="post-tags"><span class="glyphicon glyphicon-tags"></span><a href="https://marc.cortinasval.cat/blog/tag/amazon/">amazon</a> <span class="slash"> / </span><a href="https://marc.cortinasval.cat/blog/tag/apache/">apache</a> <span class="slash"> / </span><a href="https://marc.cortinasval.cat/blog/tag/blog/">blog</a> <span class="slash"> / </span><a href="https://marc.cortinasval.cat/blog/tag/cdn/">cdn</a> <span class="slash"> / </span><a href="https://marc.cortinasval.cat/blog/tag/cloud/">cloud</a> <span class="slash"> / </span><a href="https://marc.cortinasval.cat/blog/tag/cloudflare/">cloudflare</a> <span class="slash"> / </span><a href="https://marc.cortinasval.cat/blog/tag/dns/">dns</a> <span class="slash"> / </span><a href="https://marc.cortinasval.cat/blog/tag/ec2/">ec2</a> <span class="slash"> / </span><a href="https://marc.cortinasval.cat/blog/tag/google/">google</a> <span class="slash"> / </span><a href="https://marc.cortinasval.cat/blog/tag/gybo/">gybo</a> <span class="slash"> / </span><a href="https://marc.cortinasval.cat/blog/tag/http/">http</a> <span class="slash"> / </span><a href="https://marc.cortinasval.cat/blog/tag/httpd/">httpd</a> <span class="slash"> / </span><a href="https://marc.cortinasval.cat/blog/tag/https/">https</a> <span class="slash"> / </span><a href="https://marc.cortinasval.cat/blog/tag/mod_spdy/">mod_SPDY</a> <span class="slash"> / </span><a href="https://marc.cortinasval.cat/blog/tag/puntcat/">puntCAT</a> <span class="slash"> / </span><a href="https://marc.cortinasval.cat/blog/tag/s3/">s3</a> <span class="slash"> / </span><a href="https://marc.cortinasval.cat/blog/tag/spdy/">SPDY</a> <span class="slash"> / </span><a href="https://marc.cortinasval.cat/blog/tag/wordpress/">wordpress</a> <span class="slash"> / </span></p>
</div>
</article>
<hr class="post-divider">	<div class="page-links"></div>	</div>
<div id="primary-sidebar" class="col-md-4">
<aside id="gsc-widget-2" class="widget google custom search"><hr> <div id="cse-search-form40" style="width: 100%;">Loading</div>
<script>google.load('search','1',{language:'ca'});google.setOnLoadCallback(function(){var customSearchControl=new google.search.CustomSearchControl('');customSearchControl.setResultSetSize(google.search.Search.FILTERED_CSE_RESULTSET);var options=new google.search.DrawOptions();options.setSearchFormRoot('cse-search-form40');options.setAutoComplete(true);customSearchControl.draw('dialog',options);customSearchControl.setSearchCompleteCallback(this,CallBackDisplayDialog);},true);function CallBackDisplayDialog(result){jQuery('#dialog').dialog('open');}</script>
<!-- open dialog. For debug purposes
                    <p><a href="#" id="dialog_link" class="ui-state-default ui-corner-all"><span class="ui-icon ui-icon-newwin"></span>Open Dialog</a></p>
            -->
<div id="dialog" title="Resultat de la cerca">
<p></p>
</div>
</aside>	<aside id="recent-posts-2" class="widget widget_recent_entries"><hr>	<h4>Entrades recents</h4>	<ul>
<li>
<a href="https://marc.cortinasval.cat/blog/2015/01/12/elk-en-centos7/">ELK en CentOs7</a>
</li>
<li>
<a href="https://marc.cortinasval.cat/blog/2014/04/29/graphite-gran-recurs-per-graficar-sistemes/">Graphite: gran recurs per grÃ ficar sistemes</a>
</li>
<li>
<a href="https://marc.cortinasval.cat/blog/2014/03/05/kibana-ens-ajuda-amb-els-logs-de-aws-cloudfront-i-waf-akamai/">Kibana ens ajuda amb els logs de AWS Cloudfront i WAF Akamai</a>
</li>
<li>
<a href="https://marc.cortinasval.cat/blog/2013/12/17/varnish-cache-un-molt-bon-aliat-per-a-la-web/">varnish-cache, un molt bon aliat per a la web</a>
</li>
<li>
<a href="https://marc.cortinasval.cat/blog/2013/12/15/breu-resum-de-la-nostra-historia/">breu resum de la nostra histÃ²ria</a>
</li>
</ul>
</aside><aside id="linkcat-0" class="widget widget_links"><hr><h4>Favorits</h4>
<ul class='xoxo blogroll'>
<li><a href="http://www.cloudadmins.org/" onclick="__gaTracker('send', 'event', 'outbound-widget', 'http://www.cloudadmins.org/', 'Cloudadmins');" title="News about building cloud-ready infrastructures">Cloudadmins</a></li>
<li><a href="http://www.tomas.cat/blog/" onclick="__gaTracker('send', 'event', 'outbound-widget', 'http://www.tomas.cat/blog/', 'El blog d&#039;en Tomas');">El blog d&#039;en Tomas</a></li>
<li><a href="http://maauso.com/" onclick="__gaTracker('send', 'event', 'outbound-widget', 'http://maauso.com/', 'El blog de Miguel');">El blog de Miguel</a></li>
<li><a href="http://www.entredevyops.es/" onclick="__gaTracker('send', 'event', 'outbound-widget', 'http://www.entredevyops.es/', 'Entre Dev y Ops');">Entre Dev y Ops</a></li>
<li><a href="http://highscalability.com/" onclick="__gaTracker('send', 'event', 'outbound-widget', 'http://highscalability.com/', 'High Scability');">High Scability</a></li>
<li><a href="https://groups.google.com/forum/?hl=es#!forum/puppet-users-barcelona" onclick="__gaTracker('send', 'event', 'outbound-widget', 'https://groups.google.com/forum/?hl=es#!forum/puppet-users-barcelona', 'Puppet Users BCN');">Puppet Users BCN</a></li>
</ul>
</aside>
<aside id="meta-3" class="widget widget_meta"><hr><h4>Admin</h4>	<ul>
<li><a href="https://marc.cortinasval.cat/blog/wp-login.php">Log in</a></li>
<li><a href="https://marc.cortinasval.cat/blog/ca/feed/"><abbr title="en anglÃ¨s, Really Simple Syndication">RSS</abbr> de les entrades</a></li>
<li><a href="https://marc.cortinasval.cat/blog/ca/comments/feed/"><abbr title="en inglÃ©s, Really Simple Syndication">RSS</abbr> dels comentaris</a></li>
<li><a href="https://wordpress.org/" title="Funcionant amb el WordPress, plataforma semÃ ntica de publicaciÃ³ personal de primer ordre.">WordPress.org</a></li>	</ul>
</aside></div></div>
</div>
<footer>
<div id="footer-bottom">
<div class="container">
<div class="row">
<div id="footer-meta" class="col-md-9">
<p>&copy; <a id="footer-site" href="https://marc.cortinasval.cat/blog/ca" title="El blog d&#039;en Marc">El blog d&#039;en Marc</a></p>
</div>
<div id="footer-credit" class="col-md-3">
<p><a href="http://www.wpmultiverse.com/themes/franklin/" title="Franklin WordPress Theme">Franklin Theme</a></p>
</div>
</div>
</div>
</div>
</footer>
<script src='https://marc.cortinasval.cat/blog/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shCore.js?ver=3.0.9b'></script>
<script src='https://marc.cortinasval.cat/blog/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushPlain.js?ver=3.0.9b'></script>
<script>(function(){var corecss=document.createElement('link');var themecss=document.createElement('link');var corecssurl="https://marc.cortinasval.cat/blog/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/styles/shCore.css?ver=3.0.9b";if(corecss.setAttribute){corecss.setAttribute("rel","stylesheet");corecss.setAttribute("type","text/css");corecss.setAttribute("href",corecssurl);}else{corecss.rel="stylesheet";corecss.href=corecssurl;}document.getElementsByTagName("head")[0].insertBefore(corecss,document.getElementById("syntaxhighlighteranchor"));var themecssurl="https://marc.cortinasval.cat/blog/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/styles/shThemeDefault.css?ver=3.0.9b";if(themecss.setAttribute){themecss.setAttribute("rel","stylesheet");themecss.setAttribute("type","text/css");themecss.setAttribute("href",themecssurl);}else{themecss.rel="stylesheet";themecss.href=themecssurl;}document.getElementsByTagName("head")[0].insertBefore(themecss,document.getElementById("syntaxhighlighteranchor"));})();SyntaxHighlighter.config.strings.expandSource='+ expand source';SyntaxHighlighter.config.strings.help='?';SyntaxHighlighter.config.strings.alert='SyntaxHighlighter\n\n';SyntaxHighlighter.config.strings.noBrush='Can\'t find brush for: ';SyntaxHighlighter.config.strings.brushNotHtmlScript='Brush wasn\'t configured for html-script option: ';SyntaxHighlighter.defaults['pad-line-numbers']=false;SyntaxHighlighter.defaults['toolbar']=false;SyntaxHighlighter.all();</script>
<script src='https://marc.cortinasval.cat/blog/wp-includes/js/jquery/ui/core.min.js?ver=1.11.2'></script>
<script src='https://marc.cortinasval.cat/blog/wp-includes/js/jquery/ui/widget.min.js?ver=1.11.2'></script>
<script src='https://marc.cortinasval.cat/blog/wp-includes/js/jquery/ui/mouse.min.js?ver=1.11.2'></script>
<script src='https://marc.cortinasval.cat/blog/wp-includes/js/jquery/ui/resizable.min.js?ver=1.11.2'></script>
<script src='https://marc.cortinasval.cat/blog/wp-includes/js/jquery/ui/draggable.min.js?ver=1.11.2'></script>
<script src='https://marc.cortinasval.cat/blog/wp-includes/js/jquery/ui/button.min.js?ver=1.11.2'></script>
<script src='https://marc.cortinasval.cat/blog/wp-includes/js/jquery/ui/position.min.js?ver=1.11.2'></script>
<script src='https://marc.cortinasval.cat/blog/wp-includes/js/jquery/ui/dialog.min.js?ver=1.11.2'></script>
<script src='https://marc.cortinasval.cat/blog/wp-content/themes/franklin/assets/js/bootstrap.min.js?ver=3.1.1'></script>
<script src='https://marc.cortinasval.cat/blog/wp-content/themes/franklin/assets/js/franklin.js?ver=1.0'></script>
<script src='https://marc.cortinasval.cat/blog/wp-content/plugins/multi-column-tag-map/mctagmap.js?mctm_ver=12.0.4&#038;ver=1'></script>
<script>if(typeof console==='object'){console.log('[BEGIN WordPress HTTPS Debug Log]');console.log('Version: 3.3.6');console.log('HTTP URL: http://marc.cortinasval.cat/blog/');console.log('HTTPS URL: https://marc.cortinasval.cat/blog/');console.log('SSL: Yes');console.log('Diff Host: No');console.log('Subdomain: Yes');console.log('Proxy: Yes');console.log('Secure External URLs: [ https://secure.gravatar.com/avatar/42273633a4b1808ae44b549f7302a810?s=64&amp;d=https%3A%2F%2Fsecure.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D64&amp;r=G, https://secure.gravatar.com/avatar/42273633a4b1808ae44b549f7302a810?s=26&amp;d=https%3A%2F%2Fsecure.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D26&amp;r=G, https://secure.gravatar.com/avatar/6c87e23e43690cda892bef9999094abf?s=50&amp;d=https%3A%2F%2Fsecure.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D50&amp;r=G, https://secure.gravatar.com/avatar/ea7dbb10aac09a108d5cbf5c6c9ea21a?s=50&amp;d=https%3A%2F%2Fsecure.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D50&amp;r=G, https://secure.gravatar.com/avatar/4c530e5935bc75173f11e16a1436a8a8?s=50&amp;d=https%3A%2F%2Fsecure.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D50&amp;r=G, https://secure.gravatar.com/avatar/42273633a4b1808ae44b549f7302a810?s=50&amp;d=https%3A%2F%2Fsecure.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D50&amp;r=G, http://lh5.googleusercontent.com/-TZkI5pIXMd8/AAAAAAAAAAI/AAAAAAAAAAA/zQRIcpCZBSQ/photo.jpg, http://cdn.gtln.us/img/nxs/noImgC.png, http://www.google.com/cse/style/look/minimalist.css, http://www.google.com/jsapi, https://secure.gravatar.com/avatar/4c530e5935bc75173f11e16a1436a8a8?s=40&amp;d=https%3A%2F%2Fsecure.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D40&amp;r=G, https://secure.gravatar.com/avatar/42273633a4b1808ae44b549f7302a810?s=96&amp;d=https%3A%2F%2Fsecure.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D96&amp;r=G, https://www.google.com/jsapi, https://secure.gravatar.com/avatar/ea7dbb10aac09a108d5cbf5c6c9ea21a?s=40&amp;d=https%3A%2F%2Fsecure.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D40&amp;r=G, https://secure.gravatar.com/avatar/6c87e23e43690cda892bef9999094abf?s=40&amp;d=https%3A%2F%2Fsecure.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D40&amp;r=G ]');console.log('Unsecure External URLs: [  ]');console.log('[FIXED] Element: <a> - http://marc.cortinasval.cat/blog/wp-content/uploads/2013/12/Varnish_subroutines_Graph.png => https://marc.cortinasval.cat/blog/wp-content/uploads/2013/12/Varnish_subroutines_Graph.png');console.log('[FIXED] Element: <a> - http://marc.cortinasval.cat/blog/wp-content/uploads/2013/03/fisicalLB.png => https://marc.cortinasval.cat/blog/wp-content/uploads/2013/03/fisicalLB.png');console.log('[FIXED] Element: <a> - http://marc.cortinasval.cat/blog/wp-content/uploads/2013/03/funcional.png => https://marc.cortinasval.cat/blog/wp-content/uploads/2013/03/funcional.png');console.log('[FIXED] Element: <img> http://marc.cortinasval.cat/blog/wp-content/uploads/2013/12/Varnish_subroutines_Graph.png => https://marc.cortinasval.cat/blog/wp-content/uploads/2013/12/Varnish_subroutines_Graph.png');console.log('[FIXED] Element: <img> http://marc.cortinasval.cat/blog/wp-content/uploads/2013/03/fisicalLB-300x203.png => https://marc.cortinasval.cat/blog/wp-content/uploads/2013/03/fisicalLB-300x203.png');console.log('[FIXED] Element: <img> http://marc.cortinasval.cat/blog/wp-content/uploads/2013/03/funcional-300x179.png => https://marc.cortinasval.cat/blog/wp-content/uploads/2013/03/funcional-300x179.png');console.log('[END WordPress HTTPS Debug Log]');}</script>
<script pagespeed_no_defer="">//<![CDATA[

pagespeed.addInstrumentationInit('/mod_pagespeed_beacon', 'load', '', 'http://marc.cortinasval.cat/blog/tag/http/');
//]]></script></body>
</html>	